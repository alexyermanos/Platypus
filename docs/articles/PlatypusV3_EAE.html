<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PlatypusV3 EAE • Platypus</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PlatypusV3 EAE">
<meta property="og:description" content="Platypus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Platypus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/PlatypusV3_agedCNS.html">Platypus V3 aged CNS</a>
    </li>
    <li>
      <a href="../articles/PlatypusV3_EAE.html">Platypus V3 EAE</a>
    </li>
    <li>
      <a href="../articles/PlatypusDB.html">PlatypusDB</a>
    </li>
    <li>
      <a href="../articles/Platypus_feature_barcodes.html">Platypus V3 Feature barcodes</a>
    </li>
    <li>
      <a href="../articles/ABForests.html">ABForests</a>
    </li>
    <li>
      <a href="../articles/Echidna.html">Echidna</a>
    </li>
  </ul>
</li>
<li>
  <a href="../PlatypusDB_index.html">PlatypusDB</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://immunesim.readthedocs.io/en/latest/" class="external-link">ImmuneSIM</a>
    </li>
  </ul>
</li>
<li>
  <a href="../cute_monotremes.html">Cute Monotremes</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/alexyermanos" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/KreineVic" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/alexyermanos/Platypus" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="PlatypusV3_EAE_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PlatypusV3 EAE</h1>
                        <h4 data-toc-skip class="author">Victor Kreiner, LSSI at D-BSSE</h4>
            
            <h4 data-toc-skip class="date">22 9 2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/alexyermanos/Platypus/tree/mastervignettes/PlatypusV3_EAE.Rmd" class="external-link"><code>vignettes/PlatypusV3_EAE.Rmd</code></a></small>
      <div class="hidden name"><code>PlatypusV3_EAE.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor" aria-hidden="true"></a>1. Introduction</h2>
<p>Adaptive immune phenotypes and repertoires in EAE - a full Platypus V3 walkthrough</p>
<p>This vignette demonstrates the functionality of the Platypus v3 analysis pipeline.</p>
<p>For any questions or suggestions, please reach out to myself (Victor Kreiner, <a href="mailto:vkreiner@campus.lmu.de" class="email">vkreiner@campus.lmu.de</a>) or Alexander Yermanos, <a href="mailto:ayermanos@gmail.com" class="email">ayermanos@gmail.com</a>)</p>
</div>
<div id="dataset-overview" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset-overview" class="anchor" aria-hidden="true"></a>2. Dataset overview</h2>
<p>Recent developments in single-cell immune repertoire sequencing have enabled the integration of lymphocyte’s transcriptional phenotypes and their adaptive immune receptors. This provides a systems-level view of an ongoing immune response. Here we performed paired single-cell RNA and immune repertoire receptor sequencing of T and B cells in the mouse model of experimental autoimmune encephalomyelitis (EAE). The aim was to explore the clonal selection experienced by lymphocytes and their immune receptors in this condition. B and T cells were isolated from the brains of B6 mice 14 days following induction of EAE with either rMOG protein (1-125) or peptide (35-55).</p>
</div>
<div id="introduction-to-the-analysis-pipeline" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-to-the-analysis-pipeline" class="anchor" aria-hidden="true"></a>3. Introduction to the analysis pipeline</h2>
<p>The majority of analyses in this vignette use Platypus v3, which revolves around the VDJ_GEX_matrix (VGM) data structure. This is used as input to the majority of downstream analysis functions.</p>
<p>Data will be read in locally, but an alternative read in command from PlatypusDB for all data is provided as well. Many lines are commented out for the purpose of vignette compilation (e.g. #ggsave() calls). The VDJ_GEX_matrix function will be run multiple times for the purpose of integration and filtering. We highly suggest to save the output objects as .rds via saveRDS() in order to avoid running this function each time when starting a new R session.</p>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor" aria-hidden="true"></a>4. Setup</h2>
<p>Loading in the needed packages. The pals and scales packages will be used for color paletts We further load the ggrepel package explicitly to shorten ggplot commands.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Platypus</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">utils</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kwstat.github.io/pals/" class="external-link">pals</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel" class="external-link">ggrepel</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org" class="external-link">igraph</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="import-and-vgm-runs" class="section level2">
<h2 class="hasAnchor">
<a href="#import-and-vgm-runs" class="anchor" aria-hidden="true"></a>Import and VGM runs</h2>
<p>Import locally</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VDJ.out.directory.list_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">VDJ.out.directory.list_T</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/tcell/S1"</span><span class="op">)</span> <span class="co">#rMOG_1 </span>
<span class="va">VDJ.out.directory.list_T</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/tcell/S2"</span><span class="op">)</span> <span class="co">#rMOG_2</span>
<span class="va">VDJ.out.directory.list_T</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/tcell/S3"</span><span class="op">)</span> <span class="co">#MOG35-55</span>

<span class="va">VDJ.out.directory.list_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">VDJ.out.directory.list_B</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S1"</span><span class="op">)</span> <span class="co">#rMOG_1 </span>
<span class="va">VDJ.out.directory.list_B</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S2"</span><span class="op">)</span> <span class="co">#rMOG_2</span>
<span class="va">VDJ.out.directory.list_B</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S3"</span><span class="op">)</span> <span class="co">#MOG35-55</span>

<span class="va">GEX.out.directory.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">GEX.out.directory.list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S1"</span><span class="op">)</span> <span class="co">#rMOG_1 </span>
<span class="va">GEX.out.directory.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S2"</span><span class="op">)</span> <span class="co">#rMOG_2</span>
<span class="va">GEX.out.directory.list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S3"</span><span class="op">)</span> <span class="co">#MOG35-55</span></code></pre></div>
<p>Import from PlatypusDB</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EAE_Tcells</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusDB_fetch.html">PlatypusDB_fetch</a></span><span class="op">(</span>
              PlatypusDB.links <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kreiner2021a/ALL/ALL"</span><span class="op">)</span>,
              save.to.disk <span class="op">=</span> <span class="cn">F</span>, 
              load.to.enviroment <span class="op">=</span> <span class="cn">F</span>, 
              load.to.list <span class="op">=</span> <span class="cn">T</span>, 
              combine.objects <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Input paths checked. Getting lookup table..."
## [1] "Got lookup table"
## [1] "For input array[1] 6 files were selected, with a total size of 34100000 bytes"
## [1] "2021-09-22 18:52:30: Starting download of kreiner2021a_s1_VDJ.RData..."
## [1] "2021-09-22 18:52:30: Starting download of kreiner2021a_s1_GEX.RData..."
## [1] "Done with kreiner2021a_s1_VDJGEXdata!"
## [1] "2021-09-22 18:52:31: Starting download of kreiner2021a_s2_VDJ.RData..."
## [1] "2021-09-22 18:52:31: Starting download of kreiner2021a_s2_GEX.RData..."
## [1] "Done with kreiner2021a_s2_VDJGEXdata!"
## [1] "2021-09-22 18:52:32: Starting download of kreiner2021a_s3_VDJ.RData..."
## [1] "2021-09-22 18:52:32: Starting download of kreiner2021a_s3_GEX.RData..."
## [1] "Done with kreiner2021a_s3_VDJGEXdata!"
## [1] "2021-09-22 18:52:32: Done"
## [1] "Returning list of loaded objects"</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EAE_Bcells</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusDB_fetch.html">PlatypusDB_fetch</a></span><span class="op">(</span>
              PlatypusDB.links <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kreiner2021b/ALL/ALL"</span><span class="op">)</span>,
              save.to.disk <span class="op">=</span> <span class="cn">F</span>, 
              load.to.enviroment <span class="op">=</span> <span class="cn">F</span>, 
              load.to.list <span class="op">=</span> <span class="cn">T</span>, 
              combine.objects <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Input paths checked. Getting lookup table..."
## [1] "Got lookup table"
## [1] "For input array[1] 6 files were selected, with a total size of 35600002 bytes"
## [1] "2021-09-22 18:52:32: Starting download of kreiner2021b_s1_VDJ.RData..."
## [1] "2021-09-22 18:52:33: Starting download of kreiner2021b_s1_GEX.RData..."
## [1] "Done with kreiner2021b_s1_VDJGEXdata!"
## [1] "2021-09-22 18:52:34: Starting download of kreiner2021b_s2_VDJ.RData..."
## [1] "2021-09-22 18:52:34: Starting download of kreiner2021b_s2_GEX.RData..."
## [1] "Done with kreiner2021b_s2_VDJGEXdata!"
## [1] "2021-09-22 18:52:34: Starting download of kreiner2021b_s3_VDJ.RData..."
## [1] "2021-09-22 18:52:35: Starting download of kreiner2021b_s3_GEX.RData..."
## [1] "Done with kreiner2021b_s3_VDJGEXdata!"
## [1] "2021-09-22 18:52:35: Done"
## [1] "Returning list of loaded objects"</code></pre>
</div>
<div id="run-vgm" class="section level1">
<h1 class="hasAnchor">
<a href="#run-vgm" class="anchor" aria-hidden="true"></a>Run VGM</h1>
<p>From local data</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#No GEX filter =&gt; ALL GEX + T cell repertoire</span>
<span class="va">vgm_allgex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_GEX_matrix.html">VDJ_GEX_matrix</a></span><span class="op">(</span>VDJ.out.directory.list <span class="op">=</span> <span class="va">VDJ.out.directory.list_T</span>,                         
                           GEX.out.directory.list <span class="op">=</span> <span class="va">GEX.out.directory.list</span>,
                           exclude.on.cell.state.markers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no filtering"</span><span class="op">)</span>, 
                           group.id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>,<span class="st">"rMOG"</span>,<span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">vgm_allgex</span>,<span class="st">"EAE_vgm_allgex.rds"</span><span class="op">)</span>

<span class="co">#T cell GEX + T cell VDJ</span>
<span class="va">vgm_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_GEX_matrix.html">VDJ_GEX_matrix</a></span><span class="op">(</span>VDJ.out.directory.list <span class="op">=</span> <span class="va">VDJ.out.directory.list_T</span>,                         
                           GEX.out.directory.list <span class="op">=</span> <span class="va">GEX.out.directory.list</span>,
                           exclude.on.cell.state.markers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD19+"</span>, <span class="st">"CD3E-"</span>, <span class="st">"EBF1+"</span><span class="op">)</span>, 
                           group.id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>,<span class="st">"rMOG"</span>,<span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">vgm_t</span>,<span class="st">"EAE_vgm_t.rds"</span><span class="op">)</span>

<span class="co">#B cell GEX and B cell VDJ</span>
<span class="va">vgm_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_GEX_matrix.html">VDJ_GEX_matrix</a></span><span class="op">(</span>VDJ.out.directory.list <span class="op">=</span> <span class="va">VDJ.out.directory.list_B</span>,                         
                           GEX.out.directory.list <span class="op">=</span> <span class="va">GEX.out.directory.list</span>,
                           exclude.on.cell.state.markers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD3G+"</span>, <span class="st">"CD3E+"</span>, <span class="st">"CD4+"</span>, <span class="st">"CD8A+"</span>,<span class="st">"CD8B1+"</span>,<span class="st">"C1QA+"</span>,<span class="st">"C1QB+"</span>,<span class="st">"RORA+"</span>,<span class="st">"NKG7+"</span><span class="op">)</span>, <span class="co">#Strict filtering to achieve best possible clustering of B cells</span>
                           group.id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>,<span class="st">"rMOG"</span>,<span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">vgm_b</span>,<span class="st">"EAE_vgm_b.rds"</span><span class="op">)</span>

<span class="co">#Data architecture and sample counts</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co">#VDJ</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">)</span> <span class="co">#GEX</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span> <span class="co">#Nr of cells per sample</span></code></pre></div>
<p>From downloaded data</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#No GEX filter =&gt; ALL GEX + T cell repertoire</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>vgm_allgex <span class="ot">&lt;-</span> <span class="fu">VDJ_GEX_matrix</span>(<span class="at">Data.in =</span> EAE_Tcells,                         </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">exclude.on.cell.state.markers =</span> <span class="fu">c</span>(<span class="st">"no filtering"</span>), </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">group.id =</span> <span class="fu">c</span>(<span class="st">"rMOG"</span>,<span class="st">"rMOG"</span>,<span class="st">"MOG35-55"</span>)) </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(vgm_allgex,<span class="st">"EAE_vgm_allgex.rds"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">#T cell GEX + T cell VDJ</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>vgm_t <span class="ot">&lt;-</span> <span class="fu">VDJ_GEX_matrix</span>(<span class="at">Data.in =</span> EAE_Tcells</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">exclude.on.cell.state.markers =</span> <span class="fu">c</span>(<span class="st">"CD19+"</span>, <span class="st">"CD3E-"</span>, <span class="st">"EBF1+"</span>), </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">group.id =</span> <span class="fu">c</span>(<span class="st">"rMOG"</span>,<span class="st">"rMOG"</span>,<span class="st">"MOG35-55"</span>)) </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(vgm_t,<span class="st">"EAE_vgm_t.rds"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">#B cell GEX and B cell VDJ</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>vgm_b <span class="ot">&lt;-</span> <span class="fu">VDJ_GEX_matrix</span>(<span class="at">Data.in =</span> EAE_Bcells</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">exclude.on.cell.state.markers =</span> <span class="fu">c</span>(<span class="st">"CD3G+"</span>, <span class="st">"CD3E+"</span>, <span class="st">"CD4+"</span>, <span class="st">"CD8A+"</span>,<span class="st">"CD8B1+"</span>,<span class="st">"C1QA+"</span>,<span class="st">"C1QB+"</span>,<span class="st">"RORA+"</span>,<span class="st">"NKG7+"</span>), <span class="co">#Strict filtering to achieve best possible clustering of B cells</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group.id =</span> <span class="fu">c</span>(<span class="st">"rMOG"</span>,<span class="st">"rMOG"</span>,<span class="st">"MOG35-55"</span>)) </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(vgm_b,<span class="st">"EAE_vgm_b.rds"</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Data architecture and sample counts</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vgm_allgex[[<span class="dv">1</span>]]) <span class="co">#VDJ</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(vgm_allgex[[<span class="dv">2</span>]]<span class="sc">@</span>meta.data) <span class="co">#GEX</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(vgm_allgex[[<span class="dv">1</span>]]<span class="sc">$</span>sample_id) <span class="co">#Nr of cells per sample</span></span></code></pre></div>
<p>Setting correct sample names and colors for downstream processing and plotting</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>,<span class="st">"s2"</span>,<span class="st">"s3"</span><span class="op">)</span>
<span class="va">short_replace_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG_1"</span>,<span class="st">"rMOG_2"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span>

<span class="co">#FOR ALL 3 VGMs generated above</span>
<span class="co">#in VDJ</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>
  <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">short_replace_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
  <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">short_replace_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
  <span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">short_replace_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>
<span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>

<span class="co">#in GEX</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>
  <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">short_replace_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
  <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">short_replace_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
  <span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">short_replace_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>
<span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>

<span class="co">#Sample colors were choosen via coolors.co (highly recommended!)</span>
<span class="va">samples_color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#EE8C2F"</span>,<span class="st">"#F4B67C"</span>,<span class="st">"#1B9AAA"</span><span class="op">)</span>

<span class="co">#Make a quick dataframe and plot these sample colors for visual reference</span>
<span class="va">short_replace_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">short_replace_ids</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>
<span class="va">test_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="va">samples_color</span>, nam <span class="op">=</span> <span class="va">short_replace_ids</span> , val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">8</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">test_col</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nam</span>, y <span class="op">=</span> <span class="va">val</span>, fill<span class="op">=</span> <span class="va">nam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span>

<span class="co">#Group colors rMOG and MOG35-55</span>
<span class="va">groups_color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#F1A155"</span>,<span class="st">"#1B9AAA"</span><span class="op">)</span>

<span class="co">#also order group_id variable</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span>
<span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span>

<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span>
<span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span>

<span class="va">short_replace_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">short_replace_ids</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>
<span class="va">test_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="va">groups_color</span>, nam <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span> , val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">8</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">test_col</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nam</span>, y <span class="op">=</span> <span class="va">val</span>, fill<span class="op">=</span> <span class="va">nam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">groups_color</span><span class="op">)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-8-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-8-2.png" width="576"></p>
<div id="gex-overview" class="section level2">
<h2 class="hasAnchor">
<a href="#gex-overview" class="anchor" aria-hidden="true"></a>GEX overview</h2>
<p>We first want an overview of all cells in this dataset and their expression of immune receptors. The dataset we are using for this vignette contains both B and T cells (included in the same 10x capture) - we therefore will integrate B cell VDJ info into the vgm_allgex object which already contains T cell VDJ info and use common Seurat plotting functions.</p>
<p>In the case that either only T cells or only B cells are present, this extra integration step would not be needed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">meta_allgex</span> <span class="op">&lt;-</span> <span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span> <span class="co">#getting metadata of allgex object</span>
<span class="va">meta_b</span> <span class="op">&lt;-</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">meta_allgex</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#converting to character for safety</span>
  <span class="va">meta_allgex</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">meta_allgex</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>
  <span class="va">meta_b</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">meta_b</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">meta_allgex</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#Going through rows, if a cell barcode (rownames) matches one in the vgm of B cells, this information is copied over</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta_allgex</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta_b</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">meta_allgex</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">meta_b</span><span class="op">[</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta_b</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">meta_allgex</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,<span class="op">]</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span> <span class="op">&lt;-</span> <span class="va">meta_allgex</span> <span class="co">#updating the metadata object</span>
<span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>


<span class="co">#Now we add a new column concerning AIR expression, for which we use the VGM celltype column</span>
<span class="co">#By checking the first letter of the VJ_cgene, we make sure that only those cells are labeled for which we do have VDJ information</span>
<span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">AIR</span> <span class="op">&lt;-</span> <span class="st">"VDJ not available"</span>
<span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">AIR</span><span class="op">[</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">celltype</span> <span class="op">==</span> <span class="st">"T cell"</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VJ_cgene</span>, <span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">==</span> <span class="st">"T"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"TCR"</span>
<span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">AIR</span><span class="op">[</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">celltype</span> <span class="op">==</span> <span class="st">"B cell"</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VJ_cgene</span>, <span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">==</span> <span class="st">"I"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"BCR"</span>

<span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">AIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">AIR</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TCR"</span>, <span class="st">"BCR"</span>, <span class="st">"VDJ not available"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#the shuffel = T paramerer in DimPlot is useful for all colored groups to be visible well. As of writing this, there are issues with this and setting split.by. This issue is reported on Github and expected to be fixed. </span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"AIR"</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"brown4"</span>,<span class="st">"dodgerblue4"</span>,<span class="st">"grey80"</span><span class="op">)</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"top"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"AIR expression"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">1</span>,byrow<span class="op">=</span><span class="cn">TRUE</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#adjusting legend rowcount and size of dots</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot = plot_out , filename = "allgex_umap_AIR.svg", dpi = 700, width = 6, height = 6.5) </span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"sample_id"</span>, cols <span class="op">=</span> <span class="va">samples_color</span>, shuffle <span class="op">=</span> <span class="cn">T</span>, label <span class="op">=</span> <span class="cn">F</span>, repel <span class="op">=</span> <span class="cn">T</span>, label.size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Sample"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span>  <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot = plot_out, filename = "allgex_umap_sample.svg", dpi = 700, width = 6.5, height = 5)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-9-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-9-2.png" width="576"></p>
<p>As part of the data overview, we can also explore metrics relating to sequencing quality</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#set plot size for all for convenience</span>
<span class="va">wdth</span> <span class="op">&lt;-</span> <span class="fl">4.5</span>
<span class="va">hght</span> <span class="op">&lt;-</span> <span class="fl">6</span>

<span class="co">#cells per sample</span>
<span class="va">metadat</span> <span class="op">&lt;-</span> <span class="va">vgm_allgex</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span>
<span class="va">metadat</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">metadat</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>
<span class="va">metasum</span> <span class="op">&lt;-</span> <span class="va">metadat</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">metasum</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">metasum</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metasum</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_id</span>, y <span class="op">=</span> <span class="va">n</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, alpha <span class="op">=</span> <span class="fl">1</span>, stat <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">24</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span>,legend.direction <span class="op">=</span> <span class="st">"vertical"</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">38</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Recovered cell barcodes"</span>, subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">11</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">8600</span><span class="op">)</span><span class="op">)</span> 

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Cells_per_sample.svg", dpi = 600, width = wdth, height = hght)</span>

<span class="co">#violin number of counts per cell</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metadat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_id</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">nCount_RNA</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">24</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span>,legend.direction <span class="op">=</span> <span class="st">"vertical"</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">38</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Countes per cell"</span>, subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Counts_per_sample.svg", dpi = 600, width = wdth, height = hght)</span>

<span class="co">#violin number of genes per cell</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metadat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_id</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">nFeature_RNA</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">24</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span>,legend.direction <span class="op">=</span> <span class="st">"vertical"</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">38</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Genes per cell"</span>, subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "genes_per_sample.svg", dpi = 600, width = wdth, height = hght)</span>

<span class="co">#violin % mitochondira </span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">metadat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sample_id</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">percent.mt</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html" class="external-link">geom_violin</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">24</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span>,legend.direction <span class="op">=</span> <span class="st">"vertical"</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">38</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"% of MT genes reads"</span>, subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span> 
<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "MTreads_per_sample.svg", dpi = 600, width = wdth, height = hght)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-10-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-10-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-10-3.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-10-4.png" width="576"></p>
</div>
<div id="exploring-gex-of-t-cells-by-cluster" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-gex-of-t-cells-by-cluster" class="anchor" aria-hidden="true"></a>Exploring GEX of T cells by cluster</h2>
<p>The following code explores the transcriptional phenotypes of T cells in this dataset. We will start with some overview UMAPs and work towards cluster classification</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#By sample </span>
<span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"sample_id"</span>, cols <span class="op">=</span> <span class="va">samples_color</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Sample"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> 

<span class="co">#ggsave(plot = last_plot(), filename = "Tcs_umap_sample.svg", dpi = 700, width = 6.5, height = 5)</span>

<span class="co">#By group</span>
<span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"group_id"</span>, cols <span class="op">=</span> <span class="va">groups_color</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Sample"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> 

<span class="co">#ggsave(plot = last_plot(), filename = "Tcs_umap_group.svg", dpi = 700, width = 6.5, height = 5)</span>

<span class="co">#By cluster</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kwstat.github.io/pals/" class="external-link">pals</a></span><span class="op">)</span> <span class="co">#the pals package offers some great varities of palettes, especially for applications were rColorBrewer palettes contain too few distinct colors</span>

<span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"seurat_clusters"</span>, cols <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span><span class="op">)</span><span class="op">]</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Cluster"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> 

<span class="co">#ggsave(plot = last_plot(), filename = "Tcs_umap_clusters.svg", dpi = 700, width = 6.5, height = 5)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-12-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-12-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-12-3.png" width="576"></p>
<p>We see clear overlap between samples. Almost all clusters are composed of cells of all samples and groups. We can visualize proportions using stacked barplots.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_members</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_proportions_barplot.html">GEX_proportions_barplot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,source.group <span class="op">=</span> <span class="st">"sample_id"</span>, target.group <span class="op">=</span> <span class="st">"seurat_clusters"</span>, stacked.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span>, labels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">33</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">33</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"% of cells of cluster"</span>, fill <span class="op">=</span> <span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ordering based on existing source group factor levels"
##  [1] rMOG_1   rMOG_1   rMOG_1   rMOG_1   rMOG_1   rMOG_1   rMOG_1   rMOG_1  
##  [9] rMOG_1   rMOG_1   rMOG_1   rMOG_2   rMOG_2   rMOG_2   rMOG_2   rMOG_2  
## [17] rMOG_2   rMOG_2   rMOG_2   rMOG_2   rMOG_2   rMOG_2   MOG35-55 MOG35-55
## [25] MOG35-55 MOG35-55 MOG35-55 MOG35-55 MOG35-55 MOG35-55 MOG35-55 MOG35-55
## [33] MOG35-55
## Levels: rMOG_1 &lt; rMOG_2 &lt; MOG35-55
## [1] "Ordering based on existing target group factor levels"
## [1] "Returning stacked barplot with y axis = % of cells of target group"</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_members</span> 

<span class="co">#ggsave(last_plot(), filename = "Tc_cluster_membership_sample_new.svg", dpi = 400, width = 10, height = 8)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<p>Now we can start investigating what the clusters actually represent: Step 1: Project common markers to get a basic idea</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span>

<span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html" class="external-link">FeaturePlot</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD3G"</span>,<span class="st">"CD4"</span>,<span class="st">"CD8A"</span>,<span class="st">"FOXP3"</span><span class="op">)</span>, reduction <span class="op">=</span> <span class="st">"umap"</span>, label <span class="op">=</span> <span class="cn">F</span>, repel <span class="op">=</span> <span class="cn">F</span>, pt.size <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.1</span><span class="op">)</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">27</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey80"</span>, mid <span class="op">=</span> <span class="st">"grey80"</span>, high <span class="op">=</span> <span class="st">"#DD513AFF"</span>, oob <span class="op">=</span> <span class="va">squish_infinite</span><span class="op">)</span> <span class="co">#We position the legend inside the plot using legend.position, to save some space. Further we use the "squish_infinite" function of the scales package to easily reppresent outlier values without compromising overall color scales.  </span></code></pre></div>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.
## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.
## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.
## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = last_plot(), filename = "Tcs_umap_Tcell_basic.svg", dpi = 400, width = 10, height = 10)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
<p>For a more in depth look at marker expression, we use the dottile function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Check what genes are available with this searchable dataframe view (at least in R studio)</span>
<span class="co">#View(as.data.frame(rownames(vgm_t)))</span>

<span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>,<span class="st">"CD8A"</span>,<span class="st">"CD28"</span>,<span class="st">"ICOS"</span>,<span class="st">"CD40LG"</span>,<span class="st">"CTLA4"</span>,<span class="st">"PDCD1"</span>,<span class="st">"LAG3"</span>,<span class="st">"S1PR1"</span>,<span class="st">"PTPRC"</span>,<span class="st">"SELL"</span>,<span class="st">"TBX21"</span>,<span class="st">"GATA3"</span>,<span class="st">"SPI1"</span>,<span class="st">"IRF4"</span>,<span class="st">"BCL6"</span>,<span class="st">"STAT4"</span>,<span class="st">"STAT6"</span>,<span class="st">"FOXP3"</span>,<span class="st">"IKZF2"</span>, <span class="st">"MKI67"</span>,<span class="st">"TCF7"</span>,<span class="st">"TOX"</span>, <span class="st">"GZMB"</span>,<span class="st">"TNF"</span>,<span class="st">"IFNG"</span>,<span class="st">"TGFB1"</span>,<span class="st">"IL10"</span>,<span class="st">"IL17A"</span>,<span class="st">"CSF2"</span>,<span class="st">"IL2RA"</span>,<span class="st">"IL4RA"</span>,<span class="st">"IL12RB1"</span>,<span class="st">"CXCR3"</span>,<span class="st">"CCR5"</span>,<span class="st">"CCR8"</span>, <span class="st">"SOX4"</span>,<span class="st">"RORA"</span>,<span class="st">"RORC"</span>,<span class="st">"RUNX3"</span>,<span class="st">"HIF1A"</span><span class="op">)</span>

<span class="va">linesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">genes_to_plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="co">#these lines are for easier viewing of the plot</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, genes <span class="op">=</span> <span class="va">genes_to_plot</span>, group.by <span class="op">=</span> <span class="st">"seurat_clusters"</span>, threshold.to.plot <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"% positive"</span>, color <span class="op">=</span> <span class="st">"Expression"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">29</span>, angle <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>,vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">linesh</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="co">#we end the viridis palette at .85 specifically, to avoid bright yellow spots that can be hard to view when printed</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#For vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 93 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = plot_out, filename = "Tc_dottile.svg", dpi = 400, width = 10, height = 15)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
<p>We can now find cluster specific genes by DEG analysis. Here we use the GEX_cluster_genes to find genes that are deferentially expressed in one cluster relative to all other cells. This function is based on the Seurat::FindAllMarkers function but allows the user to filter out mitochondrial and ribosomal proteins from the list and can further be used as input to other plotting functions.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Warning: running this function will take a while</span>
<span class="co">#gene_expression_cluster &lt;- GEX_cluster_genes(vgm_t[[2]],min.pct = 0.25) </span>
<span class="co">#saveRDS(gene_expression_cluster, file = "Tcs_gene_expression_clusters.rds")</span>

<span class="va">gene_expression_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"C:/Dokumente usw/Master/Reddy Lab/1_thesis/3_code/4_DB project/EAE website vignette/Tcs_gene_expression_clusters.rds"</span><span class="op">)</span>
<span class="co">#Recommended to get an overview of the output format</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gene_expression_cluster</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "p_val"     "avg_logFC" "pct.1"     "pct.2"     "p_val_adj" "SYMBOL"   
## [7] "cluster"</code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#View(gene_expression_cluster[[1]])</span></code></pre></div>
<p>We can visualize these cluster defining genes both as a heatmap, a dotmap, and as volcano plots</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#heatmap</span>
<span class="va">EAE_heatmap_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_cluster_genes_heatmap.html">GEX_cluster_genes_heatmap</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, GEX_cluster_genes.output <span class="op">=</span> <span class="va">gene_expression_cluster</span>, n.genes.per.cluster <span class="op">=</span> <span class="fl">5</span>,max.cell <span class="op">=</span> <span class="fl">30</span>, metric <span class="op">=</span> <span class="st">"top_logFC"</span>, group.colors <span class="op">=</span> <span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>,<span class="st">"grey80"</span>,<span class="st">"darkorchid3"</span><span class="op">)</span>, oob <span class="op">=</span> <span class="va">squish_infinite</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="co">#here we picked top genes by P value. We recommend to also check top genes by p value for consistency</span></code></pre></div>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EAE_heatmap_clusters</span>

<span class="co">#ggsave(plot = last_plot(), filename = "Tc_cluster_heatmap_top5_logFC.svg", dpi = 400, width = 10, height = 10)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
<p>The dottile function can be run directly from the gene selection that made by the heatmap function</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cldef</span> <span class="op">&lt;-</span> <span class="va">EAE_heatmap_clusters</span><span class="op">$</span><span class="va">data</span> <span class="co">#getting the source data table of the heatmap from above</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cldef</span><span class="op">$</span><span class="va">Feature</span><span class="op">)</span><span class="op">)</span> <span class="co">#how many genes were selected</span></code></pre></div>
<pre><code>## [1] 52</code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cldef</span><span class="op">$</span><span class="va">Feature</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">58</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, genes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">genes_to_plot</span><span class="op">)</span>, group.by <span class="op">=</span> <span class="st">"seurat_clusters"</span>, threshold.to.plot <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"% positive"</span>, color <span class="op">=</span> <span class="st">"Expression"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">29</span>, angle <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>,vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">lines</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>reverse<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#For vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 100 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = plot_out, filename = "Tc_cluster_dottile_top5_logFC.svg", dpi = 400, width = 10, height = 22)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
<p>And some more DEG analysis between clusters: What are differences between cluster 0 and 1.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel" class="external-link">ggrepel</a></span><span class="op">)</span>
<span class="co">#Here we return a volcano plot where the top 40 genes are labelled by geom_text_repel. Further the genes CD28 and ICOS are labelled independently of their p.value</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, grouping.column <span class="op">=</span> <span class="st">"seurat_clusters"</span>, group1 <span class="op">=</span> <span class="st">"0"</span>, group2 <span class="op">=</span> <span class="st">"1"</span>, return.plot <span class="op">=</span> <span class="st">"volcano"</span>, logFC <span class="op">=</span> <span class="cn">FALSE</span>, label.n.top.genes <span class="op">=</span> <span class="fl">40</span>, genes.to.label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD28"</span>, <span class="st">"ICOS"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#plot_out[[1]] #For source table</span>
<span class="va">plot_out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="co">#For plot</span></code></pre></div>
<p>With additional ggplot coding we can produce summary volcano plots with the defining genes of each cluster. We use the gtable package to recolor the facet wrap bars to match cluster colors</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#extracting top 15 genes per cluster by fold change</span>
<span class="va">top_genes_per_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_topN_DE_genes_per_cluster.html">GEX_topN_DE_genes_per_cluster</a></span><span class="op">(</span>GEX_cluster_genes.output <span class="op">=</span> <span class="va">gene_expression_cluster</span>, n.genes <span class="op">=</span> <span class="fl">15</span>, by_FC <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="co">#for the later recoloring of bars in the facet wrap plot, we need an even number of facets in the plot i.e. clusters</span>
<span class="co">#Here we add an empty one to match this</span>
<span class="va">extr_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">top_genes_per_cluster</span>, <span class="va">cluster</span> <span class="op">==</span> <span class="st">"0"</span><span class="op">)</span>
<span class="va">extr_cluster</span><span class="op">$</span><span class="va">SYMBOL</span> <span class="op">&lt;-</span> <span class="st">"none"</span>
<span class="va">extr_cluster</span><span class="op">$</span><span class="va">cluster</span> <span class="op">&lt;-</span> <span class="fl">11</span>
<span class="va">top_genes_per_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">top_genes_per_cluster</span>, <span class="va">extr_cluster</span><span class="op">)</span>

<span class="co">#Some of these genes have an adj p value of 0, which results in strange positions when plotting. Here we set them to an low but non-0 value</span>
<span class="va">top_genes_per_cluster</span><span class="op">$</span><span class="va">p_val_adj</span><span class="op">[</span><span class="va">top_genes_per_cluster</span><span class="op">$</span><span class="va">p_val_adj</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1e-299</span>

<span class="co">#generating a large facet plot </span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">top_genes_per_cluster</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="va">pct.1</span><span class="op">*</span><span class="fl">100</span>, col <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">T</span>, size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">21</span><span class="op">)</span>,plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="st">"cm"</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>, legend.key.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.2</span>, <span class="st">"cm"</span><span class="op">)</span>, strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"white"</span>, fill <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>, strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"white"</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">28</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">21</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(FC)"</span>, y <span class="op">=</span> <span class="st">"% of expressing cells in cluster"</span>, col <span class="op">=</span> <span class="st">"-log10(adj p value)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">SYMBOL</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">6</span>, nudge_x <span class="op">=</span> <span class="fl">0</span>, nudge_y <span class="op">=</span> <span class="fl">0</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">14</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">cluster</span>,ncol <span class="op">=</span> <span class="fl">6</span>,scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">1.5</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> 

<span class="co">#recoloring the facet bars (code snippet from Stackoverflow) !!! For this to work, the facet wrap must contain only full rows (i.e. in this case with two rows, plot numbers must be even) !!!</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/gtable" class="external-link">gtable</a></span><span class="op">)</span>

<span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="co">#colors</span>
<span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_gtable.html" class="external-link">ggplot_gtable</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot_build.html" class="external-link">ggplot_build</a></span><span class="op">(</span><span class="va">plot_out</span><span class="op">)</span><span class="op">)</span>
<span class="va">stripr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'strip'</span>, <span class="va">g</span><span class="op">$</span><span class="va">layout</span><span class="op">$</span><span class="va">name</span><span class="op">)</span><span class="op">)</span>
<span class="va">stripr</span></code></pre></div>
<pre><code>##  [1] 62 63 64 65 66 67 68 69 70 71 72 73</code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fills</span> <span class="op">&lt;-</span> <span class="va">cols</span>
<span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">stripr</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">'rect'</span>, <span class="va">g</span><span class="op">$</span><span class="va">grobs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">grobs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">childrenOrder</span><span class="op">)</span><span class="op">)</span>
  <span class="va">g</span><span class="op">$</span><span class="va">grobs</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">grobs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">children</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">gp</span><span class="op">$</span><span class="va">fill</span> <span class="op">&lt;-</span> <span class="va">fills</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>
  <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span><span class="op">+</span><span class="fl">1</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> </code></pre></div>
<pre><code>## Warning: ggrepel: 10 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<pre><code>## Warning: ggrepel: 8 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<pre><code>## Warning: ggrepel: 3 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<pre><code>## Warning: ggrepel: 1 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<pre><code>## Warning: ggrepel: 10 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps

## Warning: ggrepel: 10 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(g, filename = "Tcs_degbycluster_wrap.svg", dpi = 700, width = 24, height = 14.5)</span>
<span class="va">g</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-20-1.png" width="576"></p>
<p>Now to examine coexpression of selected genes across different populations of T cells:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Cluster 0 =&gt; show association of active memory leaning phenotype with Tgfb1 expression</span>

<span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>,<span class="st">"CD28"</span>,<span class="st">"S1PR1"</span>,<span class="st">"PTPRC"</span>,<span class="st">"IL2RA"</span>,<span class="st">"TBX21"</span>,<span class="st">"GATA3"</span>,<span class="st">"STAT4"</span>,<span class="st">"TCF7"</span>,<span class="st">"NKG7"</span>,<span class="st">"TGFB1"</span>,<span class="st">"IFNG"</span><span class="op">)</span>

<span class="va">cur_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">seurat_clusters</span> <span class="op">==</span> <span class="st">"0"</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_coexpression_coefficient.html">GEX_coexpression_coefficient</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">cur_c</span>, genes <span class="op">=</span> <span class="va">genes_to_plot</span>, subsample.n <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>  <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">18</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"% double \n  positive"</span>, size <span class="op">=</span> <span class="st">"% positive"</span>, title <span class="op">=</span> <span class="st">"Cluster 0"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Calculating coexpression for 12 genes with 1612 cells"</code></pre>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = paste0("Tcs_selected_coex_cluster_0.svg"), dpi = 400, width = 10.7, height = 9)</span>

<span class="co">#Cluster 8 Examine FOXP3 Tregs</span>

<span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>,<span class="st">"CD28"</span>,<span class="st">"PTPRC"</span>,<span class="st">"CTLA4"</span>,<span class="st">"IL2RA"</span>,<span class="st">"FOXP3"</span>,<span class="st">"TOX"</span>,<span class="st">"IKZF2"</span>,<span class="st">"GZMB"</span>,<span class="st">"IL10"</span>,<span class="st">"TGFB1"</span>,<span class="st">"IFNG"</span><span class="op">)</span>

<span class="va">cur_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">seurat_clusters</span> <span class="op">==</span> <span class="st">"8"</span><span class="op">)</span>
  
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_coexpression_coefficient.html">GEX_coexpression_coefficient</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">cur_c</span>, genes <span class="op">=</span> <span class="va">genes_to_plot</span>, subsample.n <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span>  <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">18</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"% double \n positive"</span>, size <span class="op">=</span> <span class="st">"% positive"</span>, title <span class="op">=</span> <span class="st">"Cluster 8"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Calculating coexpression for 12 genes with 227 cells"</code></pre>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.
## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = paste0("Tcs_selected_coex_cluster_8.svg"), dpi = 400, width = 10.7, height = 9)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-21-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-21-2.png" width="576"></p>
<p>We also explore coexpression for specifc gene pairs</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#FIRST CD40LG vs. BCL6 to examine the presence of Tfh cells</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/GEX_scatter_coexpression.html">GEX_scatter_coexpression</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, gene.1 <span class="op">=</span> <span class="st">"CD40LG"</span>, gene.2 <span class="op">=</span> <span class="st">"BCL6"</span>, color.theme <span class="op">=</span> <span class="st">"dodgerblue4"</span><span class="op">)</span>

<span class="co">#ggsave(plot = plot_out, filename = "Tc_scatter_CD40LGBCL6dp.svg", dpi = 400, width = 10, height = 10)</span>

<span class="co">#Using the GEX_DE_genes function we can view the full transcriptional profile of such double positive cells </span>
<span class="co">#add a column</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tfh</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
<span class="va">tfh_markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FetchData.html" class="external-link">FetchData</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD40LG"</span>, <span class="st">"BCL6"</span><span class="op">)</span><span class="op">)</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tfh</span><span class="op">[</span><span class="va">tfh_markers</span><span class="op">$</span><span class="va">CD40LG</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">tfh_markers</span><span class="op">$</span><span class="va">BCL6</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, grouping.column <span class="op">=</span> <span class="st">"Tfh"</span>, group1 <span class="op">=</span> <span class="st">"TRUE"</span>, group2 <span class="op">=</span> <span class="st">"FALSE"</span>, return.plot <span class="op">=</span> <span class="st">"volcano"</span>, logFC <span class="op">=</span> <span class="cn">FALSE</span>, label.n.top.genes <span class="op">=</span> <span class="fl">15</span>, genes.to.label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD28"</span>, <span class="st">"ICOS"</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>

<span class="co">#Also validating IFNG &amp; TGFB1 coexpression</span>
 
<span class="va">plot_out</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/GEX_scatter_coexpression.html">GEX_scatter_coexpression</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, gene.1 <span class="op">=</span> <span class="st">"IFNG"</span>, gene.2 <span class="op">=</span> <span class="st">"TGFB1"</span>, color.theme <span class="op">=</span> <span class="st">"dodgerblue4"</span><span class="op">)</span>

<span class="co">#ggsave(plot = plot_out, filename = "Tc_scatter_IFNGTGFB1dp.svg", dpi = 400, width = 10, height = 10)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-22-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-22-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-22-3.png" width="576"></p>
</div>
<div id="comparing-gex-of-t-cells-by-group" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-gex-of-t-cells-by-group" class="anchor" aria-hidden="true"></a>Comparing GEX of T cells by group</h2>
<p>A key goal of this study is the comparison between T cells in EAE initiated by two different autoantigens: rMOG and MOG35-55 Here we explicitly compare the T cells from the two conditions.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#first a membership barplot to check if T cells from either immunizations cluster differently</span>
<span class="va">cl_members</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_proportions_barplot.html">GEX_proportions_barplot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,source.group <span class="op">=</span> <span class="st">"group_id"</span>, target.group <span class="op">=</span> <span class="st">"seurat_clusters"</span>, stacked.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">groups_color</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>,<span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">33</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">33</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"% of cells of cluster"</span>, fill <span class="op">=</span> <span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ordering based on existing source group factor levels"
##  [1] rMOG     rMOG     rMOG     rMOG     rMOG     rMOG     rMOG     rMOG    
##  [9] rMOG     rMOG     rMOG     MOG35-55 MOG35-55 MOG35-55 MOG35-55 MOG35-55
## [17] MOG35-55 MOG35-55 MOG35-55 MOG35-55 MOG35-55 MOG35-55
## Levels: rMOG &lt; MOG35-55
## [1] "Ordering based on existing target group factor levels"
## [1] "Returning stacked barplot with y axis = % of cells of target group"</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_members</span> 

<span class="co">#ggsave(last_plot(), filename = "Tc_cluster_membership_group.svg", dpi = 400, width = 10, height = 8)</span>

<span class="co">#Get DEGs </span>
<span class="va">exp_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, grouping.column <span class="op">=</span> <span class="st">"group_id"</span>, group1 <span class="op">=</span> <span class="st">"rMOG"</span>, group2 <span class="op">=</span> <span class="st">"MOG35-55"</span>, return.plot <span class="op">=</span> <span class="st">"none"</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co">#here we separate the function call from the ggplot for more flexibility. output[[1]] of the GEX_DEgenes is a dataframe with DEGs</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(adj p)"</span>,title <span class="op">=</span> <span class="st">"rMOG vs. MOG33-55"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">0.00001</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">7</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">plot_out</span></code></pre></div>
<pre><code>## Warning: ggrepel: 3 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot_out, filename = "Tc_volc_bygroup.svg", dpi = 400, width = 13, height = 11)</span>

<span class="co">#DEGs after p correction</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">p_val_adj</span><span class="op">[</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 57</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-23-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-23-2.png" width="576"></p>
<p>For some more insight into these genes we run Gene ontology analysis This outputs plots as PDFs, which are not displayed in this vignette</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ontology_EAE &lt;- GEX_GOterm(GEX.cluster.genes.output = list(exp_DEGs[[1]]), topNgenes = 40, go.plots = T)</span></code></pre></div>
<p>Given that cluster 4 and 7 are almost exclusive to rMOG, we test whether the DEGs calculated above remain stable even if these two clusters are excluded</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Subsetting the GEX object</span>
<span class="va">cells_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">seurat_clusters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span>
<span class="va">for_deg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, cells <span class="op">=</span> <span class="va">cells_to_keep</span><span class="op">)</span> <span class="co">#subset using Seurat parameters</span>

<span class="co">#plot umap to verify that exclusion was successfull</span>
<span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">for_deg</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"seurat_clusters"</span>, cols <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span><span class="op">)</span><span class="op">]</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Cluster"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> 

<span class="va">exp_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">for_deg</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, grouping.column <span class="op">=</span> <span class="st">"group_id"</span>, group1 <span class="op">=</span> <span class="st">"rMOG"</span>, group2 <span class="op">=</span> <span class="st">"MOG35-55"</span>, return.plot <span class="op">=</span> <span class="st">"none"</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co">#here we separate the function call from the ggplot for more flexibility. output[[1]] of the GEX_DEgenes is a dataframe with DEGs</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(adj p)"</span>,title <span class="op">=</span> <span class="st">"rMOG vs. MOG33-55 ex cluster 4 &amp; 7"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">0.00001</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">7</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Tc_volc_bysample_excl47.svg", dpi = 400, width = 10, height = 15)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-25-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-25-2.png" width="576"></p>
<p>For completeness we also plot a dotmap of selected genes across groups</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>,<span class="st">"CD8A"</span>,<span class="st">"CD69"</span>,<span class="st">"CD28"</span>,<span class="st">"PDCD1"</span>,<span class="st">"LAG3"</span>,<span class="st">"S1PR1"</span>,<span class="st">"IL2RA"</span>,<span class="st">"FOXP3"</span>,<span class="st">"TCF7"</span>,<span class="st">"TOX"</span>, <span class="st">"GZMB"</span>,<span class="st">"IFNG"</span>,<span class="st">"TGFB1"</span><span class="op">)</span>

<span class="va">linesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">genes_to_plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, genes <span class="op">=</span> <span class="va">genes_to_plot</span>, group.by <span class="op">=</span> <span class="st">"group_id"</span>, threshold.to.plot <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"% positive"</span>, color <span class="op">=</span> <span class="st">"Expression"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">29</span>, angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>,vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.title.x.bottom <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">12</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">linesh</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#For vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>

<span class="co">#ggsave(plot = plot_out, filename = "Tc_dottile_group.svg", dpi = 400, width = 5.5, height = 7)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-26-1.png" width="576"></p>
</div>
<div id="t-cells-integration-with-aged-cns-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#t-cells-integration-with-aged-cns-dataset" class="anchor" aria-hidden="true"></a>T cells integration with aged CNS dataset</h2>
<p>As part of an earlier study, our group examined phenotypes of T cells in the CNS of aged mice. They found increased numbers of lymphocytes and increased clonal expansion, especially of CD8+ T cells in aged vs. young animals.</p>
<p>(Yermanos, A. et al. Single-cell immune repertoire and transcriptome sequencing reveals that clonally expanded and transcriptionally distinct lymphocytes populate the aged central nervous system in mice. Proc. R. Soc. B Biol. Sci. 288, (2021).)</p>
<p>We wondered how different cells of EAE and aged CNS are transcriptionally.</p>
<p>First we run a new VGM to integrate these datasets. While we show the case where the data is on the user’s local PC, please check out the PlatypusDB vignette to see how this could have been done directly from the database.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VDJ.out.directory.list_T</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">VDJ.out.directory.list_T</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/tcell/S1"</span><span class="op">)</span> <span class="co">#rMOG_1 </span>
<span class="va">VDJ.out.directory.list_T</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/tcell/S1"</span><span class="op">)</span> <span class="co">#rMOG_2</span>
<span class="va">VDJ.out.directory.list_T</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/tcell/S1"</span><span class="op">)</span> <span class="co">#MOG35-55</span>
<span class="va">VDJ.out.directory.list_T</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S1"</span><span class="op">)</span> <span class="co"># 3 Months pool</span>
<span class="va">VDJ.out.directory.list_T</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S2"</span><span class="op">)</span> <span class="co"># 12 months pool</span>
<span class="va">VDJ.out.directory.list_T</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S3"</span><span class="op">)</span> <span class="co"># 18 months pool</span>
<span class="va">VDJ.out.directory.list_T</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S4"</span><span class="op">)</span> <span class="co"># 18 months alone</span>

<span class="va">GEX.out.directory.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">GEX.out.directory.list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/gex/S1"</span><span class="op">)</span> <span class="co">#rMOG_1</span>
<span class="va">GEX.out.directory.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/gex/S1"</span><span class="op">)</span> <span class="co">#rMOG_2</span>
<span class="va">GEX.out.directory.list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/gex/S1"</span><span class="op">)</span> <span class="co">#MOG35-55</span>
<span class="va">GEX.out.directory.list</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/gex/S1"</span><span class="op">)</span> <span class="co">#3 months old pooled</span>
<span class="va">GEX.out.directory.list</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/gex/S2"</span><span class="op">)</span> <span class="co">#12 months old pooled</span>
<span class="va">GEX.out.directory.list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/gex/S3"</span><span class="op">)</span> <span class="co">#18 months old pooled</span>
<span class="va">GEX.out.directory.list</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/gex/S4"</span><span class="op">)</span> <span class="co">#18 months old single</span></code></pre></div>
<p>Run VGM including both the EAE and the aged CNS dataset</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#vgm_EAEaged &lt;- VDJ_GEX_matrix(VDJ.out.directory.list = VDJ.out.directory.list_T,</span>
<span class="co">#                             GEX.out.directory.list = GEX.out.directory.list,</span>
<span class="co">#                             exclude.on.cell.state.markers = c("CD19+", "CD3E-", "EBF1+"), </span>
<span class="co">#                             group.id = c("EAE", "EAE", "EAE", "aged CNS", "aged CNS", "aged CNS", "aged CNS"), get.VDJ.stats = F) </span>

<span class="co">#saveRDS(vgm_EAEaged,"EAE_vgm_EAEaged.rds")</span>



<span class="va">sample_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>,<span class="st">"s2"</span>,<span class="st">"s3"</span>,<span class="st">"s4"</span>,<span class="st">"s5"</span>,<span class="st">"s6"</span>, <span class="st">"s7"</span><span class="op">)</span>
<span class="va">short_replace_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG_1"</span>, <span class="st">"rMOG_2"</span>,<span class="st">"MOG35-55"</span>, <span class="st">"3m"</span>, <span class="st">"12m"</span>, <span class="st">"18m"</span>, <span class="st">"18m single"</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">{</span>
  <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">short_replace_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">short_replace_ids</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] rMOG_1     rMOG_2     MOG35-55   3m         12m        18m        18m single
## Levels: rMOG_1 rMOG_2 MOG35-55 3m 12m 18m 18m single</code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">samples_color_aged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">samples_color</span>,<span class="st">"#71716F"</span>, <span class="st">"#577590"</span>, <span class="st">"#B2B7A4"</span>, <span class="st">"#D8DAD3"</span><span class="op">)</span>

<span class="va">short_replace_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">short_replace_ids</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">short_replace_ids</span><span class="op">)</span><span class="op">)</span>
<span class="va">test_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="va">samples_color_aged</span>, nam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">short_replace_ids</span><span class="op">)</span> , val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Color test ggplot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">test_col</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nam</span>, y <span class="op">=</span> <span class="va">val</span>, fill<span class="op">=</span> <span class="va">nam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color_aged</span><span class="op">)</span>

<span class="co">#Nr. cells per sample </span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##     rMOG_1     rMOG_2   MOG35-55         3m        12m        18m 18m single 
##       2477       1597       1354         64         41        491        108</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-29-1.png" width="576"></p>
<p>Next: General UMAP to show transcriptional landscape</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"sample_id"</span>, cols <span class="op">=</span> <span class="va">samples_color_aged</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Sample"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">#ggsave(plot = last_plot(), filename = "Tcs_eaeaged_umap_sample.svg", dpi = 700, width = 6.5, height = 5)</span>

<span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"seurat_clusters"</span>, cols <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span><span class="op">)</span><span class="op">]</span>, shuffle <span class="op">=</span> <span class="cn">T</span>, label <span class="op">=</span><span class="cn">T</span>, label.size <span class="op">=</span> <span class="fl">7</span> <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Cluster"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">#ggsave(plot = last_plot(), filename = "Tcs_eaeaged_umap_cluster.svg", dpi = 700, width = 6.5, height = 5)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-30-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-30-2.png" width="576"></p>
<p>Next we visualize cluster membership with a barplot</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_members</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_proportions_barplot.html">GEX_proportions_barplot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,source.group <span class="op">=</span> <span class="st">"sample_id"</span>, target.group <span class="op">=</span> <span class="st">"seurat_clusters"</span>, stacked.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color_aged</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0.7</span>,r <span class="op">=</span> <span class="fl">2.5</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span>,panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">33</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">33</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">19</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"% of cells of cluster"</span>, fill <span class="op">=</span> <span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ordering based on existing source group factor levels"
##  [1] rMOG_1     rMOG_1     rMOG_1     rMOG_1     rMOG_1     rMOG_1    
##  [7] rMOG_1     rMOG_1     rMOG_1     rMOG_1     rMOG_1     rMOG_1    
## [13] rMOG_2     rMOG_2     rMOG_2     rMOG_2     rMOG_2     rMOG_2    
## [19] rMOG_2     rMOG_2     rMOG_2     rMOG_2     rMOG_2     rMOG_2    
## [25] MOG35-55   MOG35-55   MOG35-55   MOG35-55   MOG35-55   MOG35-55  
## [31] MOG35-55   MOG35-55   MOG35-55   MOG35-55   MOG35-55   MOG35-55  
## [37] 3m         3m         3m         3m         3m         3m        
## [43] 3m         3m         3m         3m         3m         3m        
## [49] 12m        12m        12m        12m        12m        12m       
## [55] 12m        12m        12m        12m        12m        12m       
## [61] 18m        18m        18m        18m        18m        18m       
## [67] 18m        18m        18m        18m        18m        18m       
## [73] 18m single 18m single 18m single 18m single 18m single 18m single
## [79] 18m single 18m single 18m single 18m single 18m single 18m single
## Levels: rMOG_1 &lt; rMOG_2 &lt; MOG35-55 &lt; 3m &lt; 12m &lt; 18m &lt; 18m single
## [1] "Ordering based on existing target group factor levels"
## [1] "Returning stacked barplot with y axis = % of cells of target group"</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_members</span> 

<span class="co">#ggsave(last_plot(), filename = "Tcs_eaeaged_Cluster_membership.svg", dpi = 400, width = 7.5, height = 5)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-31-1.png" width="576"></p>
<p>Dotmaps again come in useful for many genes and conditions</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>,<span class="st">"CD8A"</span>,<span class="st">"CD69"</span>,<span class="st">"CD28"</span>,<span class="st">"ICOS"</span>,<span class="st">"CD40LG"</span>,<span class="st">"PDCD1"</span>,<span class="st">"LAG3"</span>,<span class="st">"S1PR1"</span>,<span class="st">"PTPRC"</span>,<span class="st">"SELL"</span>,<span class="st">"IL7R"</span>,<span class="st">"STAT4"</span>,<span class="st">"FOXP3"</span>, <span class="st">"MKI67"</span>,<span class="st">"TCF7"</span>,<span class="st">"TOX"</span>, <span class="st">"GZMB"</span>,<span class="st">"GZMK"</span>,<span class="st">"IFNG"</span>,<span class="st">"TGFB1"</span>,<span class="st">"IL17A"</span>,<span class="st">"CXCR3"</span>,<span class="st">"CCR5"</span>,<span class="st">"ITGA4"</span>,<span class="st">"ITGB2"</span><span class="op">)</span>

<span class="va">linesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">genes_to_plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, genes <span class="op">=</span> <span class="va">genes_to_plot</span>, group.by <span class="op">=</span> <span class="st">"sample_id"</span>, threshold.to.plot <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"% positive"</span>, color <span class="op">=</span> <span class="st">"Expression"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">29</span>, angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>,vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.title.x.bottom <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">12</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">linesh</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#For vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 9 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = plot_out, filename = "Tc_eaeaged_dottile.svg", dpi = 400, width = 8, height = 11)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-32-1.png" width="576"></p>
<p>Differentially expressed genes by condition: Given the higher number of CD8+ T cells in aged CNS, we can also split these DEG calculations by T cell subtype</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD4_</span> <span class="op">&lt;-</span> <span class="st">"neg"</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD4_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FetchData.html" class="external-link">FetchData</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="st">"CD4"</span><span class="op">)</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD4_</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD4_dat</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"CD4"</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD4_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span>, <span class="st">" "</span>, <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD4_</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD4_</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## aged CNS CD4 aged CNS neg      EAE CD4      EAE neg 
##           77          627         2939         2489</code></pre>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, grouping.column <span class="op">=</span> <span class="st">"CD4_"</span>, group1 <span class="op">=</span> <span class="st">"EAE CD4"</span>, group2 <span class="op">=</span> <span class="st">"aged CNS CD4"</span>, return.plot <span class="op">=</span> <span class="st">"none"</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">#plot volcano</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sample_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(adj p)"</span>,title <span class="op">=</span> <span class="st">"CD4+ EAE vs. Aged"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">sample_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">20</span> <span class="op">|</span> <span class="va">SYMBOL</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TCF7"</span>, <span class="st">"GZMB"</span>, <span class="st">"CD28"</span>, <span class="st">"CD69"</span>, <span class="st">"HIF1A"</span>, <span class="st">"TOX"</span>,<span class="st">"GZMK"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">7</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">40</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="va">samples_color_aged</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="va">samples_color_aged</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Tc_eaeaged_CD4volc.svg", dpi = 400, width = 8, height = 9.2)</span>

<span class="co">#GIVEN the high number of CD8 in Aged: detailed comparison of CD8+ Tcs </span>

<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD8_</span> <span class="op">&lt;-</span> <span class="st">"neg"</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD8_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/FetchData.html" class="external-link">FetchData</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="st">"CD8A"</span><span class="op">)</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD8_</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD8_dat</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"CD8"</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD8_</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span>, <span class="st">" "</span>, <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD8_</span><span class="op">)</span>

<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CD8_</span>

<span class="va">sample_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, grouping.column <span class="op">=</span> <span class="st">"CD8_"</span>, group1 <span class="op">=</span> <span class="st">"EAE CD8"</span>, group2 <span class="op">=</span> <span class="st">"aged CNS CD8"</span>, return.plot <span class="op">=</span> <span class="st">"none"</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">#plot volcano</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sample_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(adj p)"</span>,title <span class="op">=</span> <span class="st">"CD8+ EAE vs. Aged"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">sample_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">37</span> <span class="op">|</span> <span class="va">SYMBOL</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TCF7"</span>, <span class="st">"GZMB"</span>, <span class="st">"CD28"</span>, <span class="st">"CD69"</span>, <span class="st">"HIF1A"</span>, <span class="st">"TOX"</span>,<span class="st">"GZMK"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">7</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">40</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="va">samples_color_aged</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="va">samples_color_aged</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">plot_out</span></code></pre></div>
<pre><code>## Warning: ggrepel: 3 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot_out, filename = "Tc_eaeaged_new_CD8volc.svg", dpi = 400, width = 8, height = 9.2)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-33-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-33-2.png" width="576"></p>
</div>
<div id="exploring-vdj-of-t-cells" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-vdj-of-t-cells" class="anchor" aria-hidden="true"></a>Exploring VDJ of T cells</h2>
<p>After having explored transcriptional phenotypes of T cells we now turn to their TCR repertoires. We can plot circular expansion graphs</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#with VGM counts</span>
<span class="va">plots_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_clonal_donut.html">VDJ_clonal_donut</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, counts.to.use <span class="op">=</span> <span class="st">"VGM"</span>, expanded.colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#68228B"</span>,<span class="st">"#BF3EFF"</span>,<span class="st">"#E066FF"</span>,<span class="st">"#8968CD"</span><span class="op">)</span>, non.expanded.color <span class="op">=</span> <span class="st">"#000000"</span>, label.size <span class="op">=</span> <span class="fl">9</span>, total.label.vjust <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#Middle label position slightly adjusted to fit. Please only use these parameters after having set on a final output format for the plot</span></code></pre></div>
<pre><code>## [1] "Using counts of entries in the VDJ GEX matrix"
## [1] "----------"
## [1] "Sample: rMOG_1"
## [1] "Clones: Expanded: 233 / 28.84%; 1 cell 575 / 71.16%; total: 808"
## [1] "Cells: Expanded: 1590 / 73.44%; 1 cell 575 / 26.56%; Total: 2165"
## [1] "----------"
## [1] "Sample: rMOG_2"
## [1] "Clones: Expanded: 133 / 23.84%; 1 cell 425 / 76.16%; total: 558"
## [1] "Cells: Expanded: 978 / 69.71%; 1 cell 425 / 30.29%; Total: 1403"
## [1] "----------"
## [1] "Sample: MOG35-55"
## [1] "Clones: Expanded: 144 / 31.1%; 1 cell 319 / 68.9%; total: 463"
## [1] "Cells: Expanded: 923 / 74.32%; 1 cell 319 / 25.68%; Total: 1242"</code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#here we use counts of clones from the VGM (i.e. the nr. of rows/cells of every clone) This can also be set to "10x" to use counts from the clonotype_frequency column based on original Cellranger output. The two may diverge if a large number of overlapping barcodes were filtered out or if the clonotyping strategy was changed </span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">plots_out</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#saving in a loop</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plots_out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="co">#ggsave(plots_out[[i]], filename = paste0("Donut_VGMcounts",plots_out[[i]]$labels$title ,".png"), dpi = 400, width = 5, height = 5, bg = "transparent")</span>
<span class="op">}</span>


<span class="co">#check mean expanded clone frequency by group for 10x counts</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span><span class="op">)</span> <span class="co">#making sure </span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_cl_freq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">clonotype_frequency</span><span class="op">)</span>, median_cl_freq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">clonotype_frequency</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   sample_id mean_cl_freq median_cl_freq
##   &lt;ord&gt;            &lt;dbl&gt;          &lt;dbl&gt;
## 1 rMOG_1            22.4            6  
## 2 rMOG_2            NA             NA  
## 3 MOG35-55          22.7            6.5</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-34-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-34-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-34-3.png" width="576"></p>
<p>We continue by calculating common diversity metrics Here we use VDJ and VJ CDR3s seqs as a basis</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#NO SUBSAMPLING</span>
<span class="va">out_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#loop to compile results for all metrics</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"richness"</span>,<span class="st">"bergerparker"</span>,<span class="st">"ginisimpson"</span>,<span class="st">"shannonevenness"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_diversity.html">VDJ_diversity</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_cdr3s_aa"</span>,<span class="st">"VJ_cdr3s_aa"</span><span class="op">)</span>,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, metric <span class="op">=</span> <span class="va">i</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, subsample.to.same.n <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">$</span><span class="va">data</span>
  <span class="va">out</span><span class="op">$</span><span class="va">metric_used</span> <span class="op">&lt;-</span> <span class="va">i</span>
  <span class="va">out_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">out</span>
<span class="op">}</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">out_list</span><span class="op">)</span> <span class="co">#generating a common dataframe</span>

<span class="co">#lets plot this</span>
<span class="va">out</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">index</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species richness"</span>, <span class="st">"Berger-Parker index"</span>, <span class="st">"Gini-Simpson index"</span>, <span class="st">"Shannon evenness"</span><span class="op">)</span><span class="op">)</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">out</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">groups</span>, y <span class="op">=</span> <span class="va">metric</span>, fill <span class="op">=</span> <span class="va">groups</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.6</span>,show.legend <span class="op">=</span> <span class="cn">F</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">index</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> 

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Tcs_rep_diversity_nosubsampling.svg", dpi = 600, width = 10, height = 8)</span>

<span class="co">#SUBSAMPLING</span>
<span class="va">out_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"richness"</span>,<span class="st">"bergerparker"</span>,<span class="st">"ginisimpson"</span>, <span class="st">"shannonevenness"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_diversity.html">VDJ_diversity</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_cdr3s_aa"</span>,<span class="st">"VJ_cdr3s_aa"</span><span class="op">)</span>,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>,metric <span class="op">=</span> <span class="va">i</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, subsample.to.same.n <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">data</span> <span class="co">#subsampling down to the smallest repertoire</span>
  <span class="va">out</span><span class="op">$</span><span class="va">metric_used</span> <span class="op">&lt;-</span> <span class="va">i</span>
  <span class="va">out_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">out</span>
<span class="op">}</span></code></pre></div>
<pre><code>## [1] "Subsampled group rMOG_1 to 1054 entries"
## [1] "Subsampled group rMOG_2 to 1054 entries"
## [1] "Used group MOG35-55 as a reference for subsampling with 1054 entries"
## [1] "To avoid subsampling set subsample.to.same.n = FALSE"
## [1] "Subsampled group rMOG_1 to 1054 entries"
## [1] "Subsampled group rMOG_2 to 1054 entries"
## [1] "Used group MOG35-55 as a reference for subsampling with 1054 entries"
## [1] "To avoid subsampling set subsample.to.same.n = FALSE"
## [1] "Subsampled group rMOG_1 to 1054 entries"
## [1] "Subsampled group rMOG_2 to 1054 entries"
## [1] "Used group MOG35-55 as a reference for subsampling with 1054 entries"
## [1] "To avoid subsampling set subsample.to.same.n = FALSE"
## [1] "Subsampled group rMOG_1 to 1054 entries"
## [1] "Subsampled group rMOG_2 to 1054 entries"
## [1] "Used group MOG35-55 as a reference for subsampling with 1054 entries"
## [1] "To avoid subsampling set subsample.to.same.n = FALSE"</code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">out_list</span><span class="op">)</span>

<span class="co">#lets plot this too</span>
<span class="va">out</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">index</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species richness"</span>, <span class="st">"Berger-Parker index"</span>, <span class="st">"Gini-Simpson index"</span>, <span class="st">"Shannon evenness"</span><span class="op">)</span><span class="op">)</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">out</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">groups</span>, y <span class="op">=</span> <span class="va">metric</span>, fill <span class="op">=</span> <span class="va">groups</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.6</span>,show.legend <span class="op">=</span> <span class="cn">F</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">index</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> 

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Tcs_rep_diversity_subsampled.svg", dpi = 600, width = 8, height = 10)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-35-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-35-2.png" width="576"></p>
<p>V gene usage is an important indicator of repertoire similarity or dissimilarity. 1. stacked barplot</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "rMOG_1"   "rMOG_2"   "MOG35-55"</code></pre>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_vgene</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"TRBV12-2\\+TRBV13-2"</span>, <span class="st">"TRBV13-2"</span>,<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_vgene</span><span class="op">)</span> <span class="co">#A single expanded clone was noted to have 2 heavy chains with 2 different V genes. Here we remove the infrequent of the two.</span>

<span class="va">EAE_Vgene_usage_barplot_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_Vgene_usage_stacked_barplot.html">VDJ_Vgene_usage_stacked_barplot</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, HC.gene.number <span class="op">=</span> <span class="fl">12</span>, LC.Vgene <span class="op">=</span> <span class="cn">F</span>, LC.gene.number <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Sample order: rMOG_1 ; rMOG_2 ; MOG35-55"</code></pre>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggplot magic</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">EAE_Vgene_usage_barplot_b</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">28</span><span class="op">)</span>,legend.position <span class="op">=</span> <span class="st">"right"</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0.7</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span>, panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">stepped2</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG_1"</span>, <span class="st">"rMOG_2"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"relative usage"</span>, fill <span class="op">=</span> <span class="st">"VDJ Vgene"</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot = plot_out, filename = paste0("Tcs_VDJ_vgene_by_sample.svg"), dpi = 400, width = 8, height = 7)</span>

<span class="co">#VJ</span>
<span class="va">EAE_Vgene_usage_barplot_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_Vgene_usage_stacked_barplot.html">VDJ_Vgene_usage_stacked_barplot</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, HC.gene.number <span class="op">=</span> <span class="fl">12</span>, LC.Vgene <span class="op">=</span> <span class="cn">T</span>, LC.gene.number <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Sample order: rMOG_1 ; rMOG_2 ; MOG35-55"</code></pre>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">EAE_Vgene_usage_barplot_b</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">28</span><span class="op">)</span>,legend.position <span class="op">=</span> <span class="st">"right"</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0.7</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span>, panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">stepped2</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"2"</span>, <span class="st">"3"</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG_1"</span>, <span class="st">"rMOG_2"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"relative usage"</span>, fill <span class="op">=</span> <span class="st">"VJ Vgene"</span><span class="op">)</span> 

<span class="va">plot_out</span>

<span class="co">#ggsave(plot = plot_out, filename = paste0("Tcs_VJ_vgene_by_sample.svg"), dpi = 400, width = 8, height = 7)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-36-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-36-2.png" width="576"></p>
<ol start="2" style="list-style-type: decimal">
<li>Using Circos plots These will generate PDF files, which are not contained within this vignette</li>
</ol>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Tcs_circos_rMOG_1.pdf"</span>, onefile <span class="op">=</span> <span class="cn">T</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="va">for_cir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="st">"rMOG_1"</span><span class="op">)</span>
<span class="va">for_cir</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">for_cir</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="va">circos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_VJ_usage_circos.html">VDJ_VJ_usage_circos</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">for_cir</span>, A.or.B <span class="op">=</span> <span class="st">"both"</span>, label.threshold <span class="op">=</span> <span class="fl">5</span>, cell.level <span class="op">=</span> <span class="cn">T</span>, clonotype.per.gene.threshold <span class="op">=</span> <span class="fl">20</span>, c.count <span class="op">=</span> <span class="cn">T</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, filter1H1L <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Tcs_circos_rMOG_2.pdf"</span>, onefile <span class="op">=</span> <span class="cn">T</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="va">for_cir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="st">"rMOG_2"</span><span class="op">)</span>
<span class="va">for_cir</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">for_cir</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="va">circos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_VJ_usage_circos.html">VDJ_VJ_usage_circos</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">for_cir</span>, A.or.B <span class="op">=</span> <span class="st">"both"</span>, label.threshold <span class="op">=</span> <span class="fl">5</span>, cell.level <span class="op">=</span> <span class="cn">T</span>, clonotype.per.gene.threshold <span class="op">=</span> <span class="fl">20</span>, c.count <span class="op">=</span> <span class="cn">T</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, filter1H1L <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Tcs_circos_MOG3555.pdf"</span>, onefile <span class="op">=</span> <span class="cn">T</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="va">for_cir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="st">"MOG35-55"</span><span class="op">)</span>
<span class="va">for_cir</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">for_cir</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="va">circos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_VJ_usage_circos.html">VDJ_VJ_usage_circos</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">for_cir</span>, A.or.B <span class="op">=</span> <span class="st">"both"</span>, label.threshold <span class="op">=</span> <span class="fl">5</span>, cell.level <span class="op">=</span> <span class="cn">T</span>, clonotype.per.gene.threshold <span class="op">=</span> <span class="fl">10</span>, c.count <span class="op">=</span> <span class="cn">T</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, filter1H1L <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Public clones are often of great interest to assess clonal convergence. The following VDJ_overlap_heatmap function quantifies this for the vgm object.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#using the unfiltered (VDJ comb here. All cells, also those with less or more than 1VDJ 1VJ are included)</span>
<span class="va">VDJv_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_vgene"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, add.barcode.table <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_vgene</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 95</code></pre>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VJv_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VJ_vgene"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, add.barcode.table <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VJ_vgene</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 311</code></pre>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VJ_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VJ_cdr3s_aa"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VJ_cdr3s_aa</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1544</code></pre>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VDJ_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_cdr3s_aa"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cdr3s_aa</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1626</code></pre>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clone_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VJ_cdr3s_aa"</span>,<span class="st">"VDJ_cdr3s_aa"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pasted</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#make a table out of this for barplots (The numbers are from the length(unique())) prints above) </span>
<span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ vgene"</span>,<span class="st">"VJ vgene"</span>, <span class="st">"VDJ CDR3"</span>, <span class="st">"VJ CDR3"</span>, <span class="st">"VJ&amp;VDJ CDR3"</span><span class="op">)</span>, ov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">29</span>,<span class="fl">73</span>,<span class="fl">19</span>,<span class="fl">45</span>,<span class="fl">4</span><span class="op">)</span>, total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">96</span>,<span class="fl">314</span>,<span class="fl">1546</span>,<span class="fl">1629</span>,<span class="fl">2094</span><span class="op">)</span><span class="op">)</span>
<span class="va">to_plot</span><span class="op">$</span><span class="va">fraction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">to_plot</span><span class="op">$</span><span class="va">ov</span> <span class="op">/</span> <span class="va">to_plot</span><span class="op">$</span><span class="va">total</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,<span class="st">"%"</span><span class="op">)</span>

<span class="va">to_plot</span><span class="op">$</span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">$</span><span class="va">var</span><span class="op">)</span>,levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ vgene"</span>,<span class="st">"VJ vgene"</span>, <span class="st">"VDJ CDR3"</span>,<span class="st">"VJ CDR3"</span>, <span class="st">"VJ&amp;VDJ CDR3"</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">to_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">var</span>, y <span class="op">=</span> <span class="va">ov</span>, fill <span class="op">=</span> <span class="va">ov</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">27</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,  axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">28</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span>, plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>l <span class="op">=</span> <span class="fl">0.5</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Repertoire overlap"</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"shared elements"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">fraction</span> , vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">83</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey80"</span>, high <span class="op">=</span> <span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">stepped2</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span>, oob <span class="op">=</span> <span class="va">squish_infinite</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Tcs_rep_overlap_new.svg", dpi = 400, width = 8, height = 10)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-38-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-38-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-38-3.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-38-4.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-38-5.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-38-6.png" width="576"></p>
<p>To get the table of overlapping clones</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">clone_overlap</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##                overlapping_items    VJ_cdr3s_aa     VDJ_cdr3s_aa Freq in rMOG_1
## 1     CAVSMSNYNVLYF/CASSIGEYEQYF  CAVSMSNYNVLYF     CASSIGEYEQYF             48
## 2    CALEGDTGYQNFYF/CGARTTNERLFF CALEGDTGYQNFYF     CGARTTNERLFF              7
## 3     CAASNYNQGKLIF/CGARDTQDTQYF  CAASNYNQGKLIF     CGARDTQDTQYF             27
## 4 CAASNYNNNAPRF/CASNTGTGPFNERLFF  CAASNYNNNAPRF CASNTGTGPFNERLFF              1
## 5   CALSDTGSGGKLTL/CASSFQGAPKVFF CALSDTGSGGKLTL    CASSFQGAPKVFF              2
## 6  CAVSRYNQGKLIF/CASSLIQGANSDYTF  CAVSRYNQGKLIF  CASSLIQGANSDYTF              1
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Barcodes rMOG_1
## 1 s1_AAACGGGGTGGTACAG-1;s1_AAAGTAGGTTGAACTC-1;s1_AACACGTAGCTCTCGG-1;s1_AAGGCAGCAGCGTTCG-1;s1_AATCCAGCAAAGTGCG-1;s1_ACATGGTGTCGTTGTA-1;s1_ACGCCAGAGTGTCCAT-1;s1_ACTATCTAGCCATCGC-1;s1_ACTGATGCATTGCGGC-1;s1_ACTGATGGTTCAGTAC-1;s1_ACTTGTTCATCCGGGT-1;s1_AGAGCGAGTGTAATGA-1;s1_AGCATACCAAGCCCAC-1;s1_AGTAGTCGTCGCCATG-1;s1_AGTCTTTCACGAAATA-1;s1_ATAAGAGTCTCTGTCG-1;s1_ATCATCTAGGCGTACA-1;s1_ATCATGGCAGACGTAG-1;s1_CATCCACAGGTCATCT-1;s1_CCCTCCTGTGCGAAAC-1;s1_CGAACATGTGCCTGTG-1;s1_CGTCTACGTCCTCTTG-1;s1_CTCACACAGCGCCTCA-1;s1_CTCACACGTGGCCCTA-1;s1_CTCGGAGGTGGTACAG-1;s1_CTGGTCTTCACCTTAT-1;s1_GAAATGAGTTGGTGGA-1;s1_GAACATCGTACCTACA-1;s1_GAATGAATCGTTACGA-1;s1_GACCAATGTTTGTGTG-1;s1_GACGTTAAGTGAAGAG-1;s1_GCACTCTGTACCCAAT-1;s1_GCACTCTTCAACGAAA-1;s1_GCAGCCATCACCACCT-1;s1_GCGACCATCTGGCGTG-1;s1_GGAATAATCGTATCAG-1;s1_GGACAAGTCCCTTGTG-1;s1_GGAGCAACAGACGCTC-1;s1_GGGACCTAGCCAGAAC-1;s1_GGTATTGAGTTAGCGG-1;s1_GTGAAGGGTTGTCGCG-1;s1_GTGCATATCTGCAGTA-1;s1_GTGTTAGCACCTATCC-1;s1_TACTTACGTACTCTCC-1;s1_TTCTCCTTCGCGTTTC-1;s1_TTCTCCTTCTGTTTGT-1;s1_TTCTTAGTCACATAGC-1;s1_TTGGCAATCTGTCTAT-1
## 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       s1_AACCGCGAGCTTATCG-1;s1_ACGAGGAAGCTGTCTA-1;s1_AGGCCGTAGGGAAACA-1;s1_CACACTCTCCGAAGAG-1;s1_CATGACATCCCTGACT-1;s1_CCCTCCTGTTCGTTGA-1;s1_CTCGAAATCCGATATG-1
## 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                               s1_AAGTCTGGTTGAGGTG-1;s1_ACATGGTGTCCTCCAT-1;s1_ACGATGTTCGTAGATC-1;s1_ACGCCAGTCCAAAGTC-1;s1_AGCGGTCCAGACACTT-1;s1_CAAGGCCGTTCTGTTT-1;s1_CACATTTAGGTCGGAT-1;s1_CAGTCCTAGATGTAAC-1;s1_CCCTCCTTCACTATTC-1;s1_CGGACTGGTTCACCTC-1;s1_CTACATTTCATCGATG-1;s1_CTGAAGTGTTACAGAA-1;s1_GAAGCAGAGAGTCTGG-1;s1_GACACGCTCCGTAGGC-1;s1_GACTGCGCATCACGAT-1;s1_GCAATCAGTTAAAGAC-1;s1_GCGCGATGTTATCCGA-1;s1_GCTTGAACAAAGCGGT-1;s1_GGCAATTAGAAGGGTA-1;s1_TACGGGCGTAGCTAAA-1;s1_TAGGCATGTCTCCACT-1;s1_TAGTGGTGTCGGGTCT-1;s1_TCAGGTAAGAAGCCCA-1;s1_TCTATTGTCTGGAGCC-1;s1_TGCGCAGGTGCAGTAG-1;s1_TTCCCAGAGTCGCCGT-1;s1_TTCTACACAAATTGCC-1
## 4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           s1_CAAGGCCAGGAGCGAG-1
## 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     s1_CCTACCATCAATCTCT-1;s1_TCACAAGCACTTAAGC-1
## 6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           s1_CGAATGTAGCAATCTC-1
##   Freq in rMOG_2
## 1              9
## 2              3
## 3             14
## 4             41
## 5              1
## 6             21
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         Barcodes rMOG_2
## 1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 s2_ACACCGGCATGGGAAC-1;s2_ATTATCCCAGCCAGAA-1;s2_CAAGATCCACGAAGCA-1;s2_CGACCTTGTTAAGAAC-1;s2_CTAATGGAGACCGGAT-1;s2_CTAGCCTAGGCAATTA-1;s2_TGAGCCGGTGGTTTCA-1;s2_TGCTACCTCTATGTGG-1;s2_TTATGCTCACAGACAG-1
## 2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     s2_ACTTGTTGTGAGGGAG-1;s2_CGTAGGCTCACCACCT-1;s2_GACGCGTTCGCCAGCA-1
## 3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   s2_AAAGTAGCAACTGCGC-1;s2_ACATACGGTTGTCTTT-1;s2_ACGAGGATCCGTTGCT-1;s2_ATTTCTGGTTCTGGTA-1;s2_CCCTCCTTCAGGCGAA-1;s2_CGCGTTTCAATGGTCT-1;s2_CGCTGGACAGGTGCCT-1;s2_CGGAGTCGTTATGCGT-1;s2_CTACACCCAAGAAGAG-1;s2_GATGAAACACTCAGGC-1;s2_GATTCAGCAACACCTA-1;s2_GGAACTTAGGCCGAAT-1;s2_TATTACCAGTCCCACG-1;s2_TTAACTCCAAGAGTCG-1
## 4 s2_AACACGTCAGACGCTC-1;s2_AAGACCTCAAACGTGG-1;s2_ACACCAAGTCAGAAGC-1;s2_ACGATACGTCCGTGAC-1;s2_ACTGTCCTCTGCGTAA-1;s2_AGAGCTTTCGCGATCG-1;s2_AGCCTAACATATACGC-1;s2_AGGGATGTCGGTCTAA-1;s2_AGGTCCGAGTAGCGGT-1;s2_ATCACGAAGACAGAGA-1;s2_ATCCACCTCATCTGCC-1;s2_CAAGTTGGTGATAAAC-1;s2_CACAAACCAATGGATA-1;s2_CACACAACATCGGTTA-1;s2_CACACAAGTGAGGCTA-1;s2_CACATAGTCGTTGACA-1;s2_CGAGCCAGTCTCTTTA-1;s2_CGTCAGGTCGCGATCG-1;s2_CTACATTCATCCCACT-1;s2_CTCGGGAGTATAGTAG-1;s2_CTTAACTCATCGATTG-1;s2_CTTAGGAGTCTGCCAG-1;s2_GACGTGCAGCTAAGAT-1;s2_GATCTAGTCCAAGCCG-1;s2_GATCTAGTCGAACTGT-1;s2_GCGGGTTCAGCTGCAC-1;s2_GGCGACTGTTCGTGAT-1;s2_GGTATTGCAGACAAAT-1;s2_GTAACGTTCGCCTGAG-1;s2_GTGGGTCAGAATCTCC-1;s2_GTTCATTCAGTGGGAT-1;s2_TAAACCGAGTTCCACA-1;s2_TACTCATAGAGCCCAA-1;s2_TATCTCAGTATTACCG-1;s2_TATCTCATCACTTCAT-1;s2_TATTACCGTTAAGTAG-1;s2_TCGAGGCGTAAACGCG-1;s2_TGACGGCAGAGGGCTT-1;s2_TGCTACCTCACTGGGC-1;s2_TGGTTCCGTGACTACT-1;s2_TTCGGTCAGACACTAA-1
## 5                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 s2_GATGAGGAGTCTCGGC-1
## 6                                                                                                                                                                                                                                                                                                                                                                                                                                                         s2_ACTGCTCGTTCGGGCT-1;s2_AGTAGTCGTCTCCACT-1;s2_AGTAGTCTCACAATGC-1;s2_CAGCGACTCTGTCAAG-1;s2_CATGCCTCAAGGGTCA-1;s2_CCCTCCTAGAGCTATA-1;s2_CGATTGATCCGTCAAA-1;s2_CGGAGCTGTGCAGTAG-1;s2_CGTGTCTAGGTGCAAC-1;s2_CTGTGCTAGTCGATAA-1;s2_GCGACCAGTCTCGTTC-1;s2_GGGAGATAGGAGTCTG-1;s2_GGTGAAGAGAGCTATA-1;s2_GTGCAGCTCTTAGAGC-1;s2_GTTCTCGTCAACGGCC-1;s2_TACACGACAAGCTGAG-1;s2_TAGCCGGGTCTTCTCG-1;s2_TGAGCCGAGCTATGCT-1;s2_TGTGGTAGTTACGCGC-1;s2_TTTACTGAGCTGATAA-1;s2_TTTCCTCCAAACGCGA-1
##   Freq in MOG35-55
## 1                6
## 2                0
## 3                0
## 4                0
## 5                0
## 6                0
##                                                                                                                     Barcodes MOG35-55
## 1 s3_ACACCCTCATCTACGA-1;s3_CGATGTACAGATCTGT-1;s3_CGTCACTGTCGACTGC-1;s3_CTAACTTGTGGGTCAA-1;s3_CTTTGCGTCAACACGT-1;s3_TCGAGGCCATTACCTT-1
## 2                                                                                                                                    
## 3                                                                                                                                    
## 4                                                                                                                                    
## 5                                                                                                                                    
## 6</code></pre>
<p>To visualize clone similarity across repertoires, we can also generate a similarity network. This can either filter out those unconnected clones (recommended for visualization purposes) or draw connections and show all nodes. Each node is a clone and the edge indicates that the distance between the two clones (based on CDR3) is less than the number supplied in the VDJ_network function</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#get unique clones to avoid cluttering </span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span>, <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_id_10x</span><span class="op">)</span>
<span class="va">vgm_t_unique_clones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_clone</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span>, <span class="va">clonotype_frequency</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="co">#filtering: only one cell of each clone with a freq &gt; 10</span>
<span class="va">vgm_t_unique_clones</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">vgm_t_unique_clones</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>
<span class="va">vgm_t_unique_clones</span><span class="op">$</span><span class="va">group_id</span><span class="op">[</span><span class="va">vgm_t_unique_clones</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">==</span> <span class="st">"rMOG_1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co">#renewing the group id with the respective sample colors</span>
<span class="va">vgm_t_unique_clones</span><span class="op">$</span><span class="va">group_id</span><span class="op">[</span><span class="va">vgm_t_unique_clones</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">==</span> <span class="st">"rMOG_2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="va">vgm_t_unique_clones</span><span class="op">$</span><span class="va">group_id</span><span class="op">[</span><span class="va">vgm_t_unique_clones</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">==</span> <span class="st">"MOG35-55"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>

<span class="co">#make a loop to plot for each sample a range of distance cutoff values</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Tcs_VDJ_network_filtered.pdf"</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">3</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">{</span> <span class="co">#here we generate a plot with different edit distance cutoffs to explore how the network behaves </span>
  <span class="va">netwo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_network.html">VDJ_network</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_t_unique_clones</span>,distance.cutoff <span class="op">=</span> <span class="va">j</span>,per.sample <span class="op">=</span> <span class="cn">F</span>,platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span>
  <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/plot.igraph.html" class="external-link">plot.igraph</a></span><span class="op">(</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,vertex.label<span class="op">=</span><span class="cn">NA</span>,vertex.size<span class="op">=</span><span class="fl">5</span><span class="op">+</span><span class="op">(</span><span class="fl">.03</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span><span class="op">)</span><span class="op">)</span>,vertex.color<span class="op">=</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## agg_png 
##       2</code></pre>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#for the purpose of this document, we view the plot at j = 9</span>
<span class="va">netwo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_network.html">VDJ_network</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_t_unique_clones</span>,distance.cutoff <span class="op">=</span> <span class="fl">9</span>,per.sample <span class="op">=</span> <span class="cn">F</span>,platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span>
<span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/plot.igraph.html" class="external-link">plot.igraph</a></span><span class="op">(</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,vertex.label<span class="op">=</span><span class="cn">NA</span>,vertex.size<span class="op">=</span><span class="fl">5</span><span class="op">+</span><span class="op">(</span><span class="fl">.03</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span><span class="op">)</span><span class="op">)</span>,vertex.color<span class="op">=</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-40-1.png" width="576"></p>
</div>
<div id="integrating-vdj-and-gex-sequencing-information-for-t-cells" class="section level2">
<h2 class="hasAnchor">
<a href="#integrating-vdj-and-gex-sequencing-information-for-t-cells" class="anchor" aria-hidden="true"></a>Integrating VDJ and GEX sequencing information for T cells</h2>
<p>The first step is to check how well these two datasets overlap.</p>
<p>Nr. of cells in VDJ for which GEX info is available</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">GEX_av</span> <span class="op">&lt;-</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>av <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">GEX_available</span><span class="op">)</span>, not_av <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">GEX_available</span><span class="op">)</span><span class="op">)</span> <span class="co">#Can use the sum of this column as in R, TRUE is counted as numeric 1 and FALSE as numeric 0</span>
<span class="va">GEX_av</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">GEX_av</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>

<span class="va">GEX_av_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">GEX_av</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">GEX_av</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  
<span class="va">plot_out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">GEX_av_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="fl">1</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkorchid3"</span>,<span class="st">"grey60"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html" class="external-link">coord_polar</a></span><span class="op">(</span><span class="st">"y"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,legend.direction <span class="op">=</span> <span class="st">"vertical"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>,hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">GEX_av</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1.5</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, y <span class="op">=</span> <span class="fl">1</span>, label <span class="op">=</span> <span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"not_av"</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, y <span class="op">=</span> <span class="fl">1</span>, label <span class="op">=</span> <span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"av"</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>inherit.aes <span class="op">=</span> <span class="cn">F</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> 

<span class="co">#ggsave(plot_out[[i]], filename = paste0("GEX_available_pie_",plot_out[[i]]$labels$title ,".png"), dpi = 600, width = 5, height = 5)</span>

<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Purple = Cells in VDJ for which GEX information is available"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Purple = Cells in VDJ for which GEX information is available"</code></pre>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot_out</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<pre><code>## 
## [[2]]</code></pre>
<pre><code>## 
## [[3]]</code></pre>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">GEX_av</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   sample_id name   value
##   &lt;ord&gt;     &lt;chr&gt;  &lt;int&gt;
## 1 rMOG_1    av      1983
## 2 rMOG_1    not_av   182
## 3 rMOG_2    av      1329
## 4 rMOG_2    not_av    75
## 5 MOG35-55  av      1120
## 6 MOG35-55  not_av   122</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-41-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-41-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-41-3.png" width="576"></p>
<p>Nr. of cells in GEX for which VDJ info is available</p>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VDJ_av</span> <span class="op">&lt;-</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>av <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VDJ_available</span><span class="op">)</span>, not_av <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VDJ_available</span><span class="op">)</span><span class="op">)</span> 
<span class="va">VDJ_av</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">VDJ_av</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>

<span class="va">VDJ_av_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">VDJ_av</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">VDJ_av</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  
<span class="va">plot_out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">VDJ_av_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="fl">1</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkorchid3"</span>,<span class="st">"grey60"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html" class="external-link">coord_polar</a></span><span class="op">(</span><span class="st">"y"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,legend.direction <span class="op">=</span> <span class="st">"vertical"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>,hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">GEX_av</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1.5</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, y <span class="op">=</span> <span class="fl">1</span>, label <span class="op">=</span> <span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"not_av"</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, y <span class="op">=</span> <span class="fl">1</span>, label <span class="op">=</span> <span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"av"</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>inherit.aes <span class="op">=</span> <span class="cn">F</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> 

<span class="co">#ggsave(plot_out[[i]], filename = paste0("VDJ_available_pie_",plot_out[[i]]$labels$title ,".png"), dpi = 600, width = 5, height = 5)</span>

<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Purple = Cells in GEX for which VDJ information is available"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Purple = Cells in GEX for which VDJ information is available"</code></pre>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot_out</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<pre><code>## 
## [[2]]</code></pre>
<pre><code>## 
## [[3]]</code></pre>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">VDJ_av</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   sample_id name   value
##   &lt;ord&gt;     &lt;chr&gt;  &lt;int&gt;
## 1 rMOG_1    av      1983
## 2 rMOG_1    not_av   503
## 3 rMOG_2    av      1329
## 4 rMOG_2    not_av   272
## 5 MOG35-55  av      1120
## 6 MOG35-55  not_av   237</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-42-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-42-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-42-3.png" width="576"></p>
<p>As a second step we now overlay VDJ information onto the GEX umap</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Add a discrete scale for expansion (To plot a continuos scale, use Seurat::FeaturePlot(..., features = "clonotype_frequency"))</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span> <span class="op">&lt;-</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">[</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Expanded"</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">[</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"1 cell"</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">[</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_available</span> <span class="op">==</span> <span class="cn">F</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"VDJ not available"</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"expanded"</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey30"</span>,<span class="st">"darkorchid3"</span>,<span class="st">"grey80"</span><span class="op">)</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> 
<span class="va">plot_</span> <span class="op">&lt;-</span> <span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Clonal level"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">3</span>,byrow<span class="op">=</span><span class="cn">TRUE</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_</span> 

<span class="co">#ggsave(plot = plot_ , filename = "Tcs_GEXVDJ_expansion_discrete.svg", dpi = 700, width = 6.8, height = 5) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-43-1.png" width="576"></p>
<p>Proportion barplots again help us visualize differential distribution among clusters</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#adding a combination column</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span>, <span class="st">" "</span>, <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span>, <span class="st">"VDJ not available"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"VDJ not available"</span> <span class="co">#Here we replace sample specific VDJ not available with a general one (e.g. rMOG_1 VDJ not available -&gt; VDJ not available)</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Expanded rMOG_1"</span>, <span class="st">"1 cell rMOG_1"</span>,<span class="st">"Expanded rMOG_2"</span>, <span class="st">"1 cell rMOG_2"</span>, <span class="st">"Expanded MOG35-55"</span>, <span class="st">"1 cell MOG35-55"</span>, <span class="st">"VDJ not available"</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_proportions_barplot.html">GEX_proportions_barplot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, source.group <span class="op">=</span> <span class="st">"seurat_clusters"</span>, target.group <span class="op">=</span> <span class="st">"sample_expanded"</span>, stacked.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ordering based on existing source group factor levels"
##  [1] 2  2  2  2  2  2  2  2  0  0  0  0  0  0  0  0  8  8  8  8  8  8  8  8  9 
## [26] 9  9  9  9  9  9  9  6  6  6  6  6  6  6  6  5  5  5  5  5  5  5  5  1  1 
## [51] 1  1  1  1  1  1  4  4  4  4  4  4  4  4  3  3  3  3  3  3  3  3  10 10 10
## [76] 10 10 10 10 10 7  7  7  7  7  7  7  7 
## Levels: 0 &lt; 1 &lt; 2 &lt; 3 &lt; 4 &lt; 5 &lt; 6 &lt; 7 &lt; 8 &lt; 9 &lt; 10
## [1] "Ordering based on existing target group factor levels"
## [1] "Returning stacked barplot with y axis = % of cells of target group"</code></pre>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">&lt;-</span>  <span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">26</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>l <span class="op">=</span> <span class="fl">1</span>, t <span class="op">=</span> <span class="fl">1</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"% of cells of T cell group"</span>, x <span class="op">=</span> <span class="st">""</span>, fill <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span>
  
<span class="va">plot_out</span></code></pre></div>
<pre><code>## Warning: Removed 11 rows containing missing values (position_stack).</code></pre>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = plot_out, filename = paste0("Tcs_prop_sampleexpanded.svg"), dpi = 700, width = 10, height = 9) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-44-1.png" width="576"></p>
<p>We are now ready to examine individual clones and their transcriptional phenotypes The VDJ_clonal_expansion function gives great flexibility.</p>
<ol style="list-style-type: decimal">
<li>Expansion barplots by cluster (plotting by group ID given the large overlap between rMOG samples)</li>
</ol>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clonal_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_clonal_expansion.html">VDJ_clonal_expansion</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,celltype <span class="op">=</span> <span class="st">"Tcells"</span>,clones <span class="op">=</span> <span class="st">"50"</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, group.by <span class="op">=</span> <span class="st">"group_id"</span>, color.by <span class="op">=</span> <span class="st">"seurat_clusters"</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#as this function will return a nested list of source dataframes and plots we loop over the output to refine the given plots</span>
  
<span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span><span class="op">)</span><span class="op">]</span>, <span class="st">"grey40"</span>,<span class="st">"grey40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Cluster"</span>, y <span class="op">=</span> <span class="st">"n cells"</span><span class="op">)</span><span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="co">#ggsave(plot = clonal_out[[1]][[i]], filename = paste0("Tcs_cluster_per_clone_s_", unique(vgm_t[[1]]$group_id)[i],".svg"), dpi = 400, width = 11, height = 7)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-45-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-45-2.png" width="576"></p>
<ol start="2" style="list-style-type: decimal">
<li>Expansion barplots by T cell subtype</li>
</ol>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#adding a column for T cell group</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span> <span class="op">&lt;-</span> <span class="st">"Other"</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.org/seurat/reference/AssayData.html" class="external-link">GetAssayData</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, assay <span class="op">=</span> <span class="st">"RNA"</span>, slot <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="st">"CD4"</span><span class="op">)</span>,<span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"CD4 Th"</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.org/seurat/reference/AssayData.html" class="external-link">GetAssayData</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, assay <span class="op">=</span> <span class="st">"RNA"</span>, slot <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="st">"CD8A"</span><span class="op">)</span>,<span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"CD8 CTL"</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.org/seurat/reference/AssayData.html" class="external-link">GetAssayData</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, assay <span class="op">=</span> <span class="st">"RNA"</span>, slot <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="st">"FOXP3"</span><span class="op">)</span>,<span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"FOXP3 Treg"</span>

<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">)</span>,levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4 Th"</span>, <span class="st">"CD8 CTL"</span>, <span class="st">"FOXP3 Treg"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#We transfer this extra T cell group column also to the VDJ matrix vgm_t[[1]] by barcode matching</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span> <span class="op">&lt;-</span> <span class="st">"Other"</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>
  <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">barcode</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co">#just checking that it worked</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "CD4 Th"     "Other"      "FOXP3 Treg"</code></pre>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##     CD4 Th FOXP3 Treg      Other 
##       2512        193       2106</code></pre>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_available</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##     CD4 Th    CD8 CTL FOXP3 Treg      Other 
##       2512        506        193       1221</code></pre>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clonal_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_clonal_expansion.html">VDJ_clonal_expansion</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,celltype <span class="op">=</span> <span class="st">"Tcells"</span>,clones <span class="op">=</span> <span class="st">"50"</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, group.by <span class="op">=</span> <span class="st">"group_id"</span>, color.by <span class="op">=</span> <span class="st">"Tc_group"</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  
<span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">stepped</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">1</span>,<span class="fl">9</span><span class="op">)</span><span class="op">]</span>,<span class="st">"grey80"</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4+ Th"</span>, <span class="st">"CD8+ CTL"</span>, <span class="st">"FOXP3+ Treg"</span>, <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Subtype"</span>, y <span class="op">=</span> <span class="st">"n cells"</span><span class="op">)</span><span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">3</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="co">#ggsave(plot = clonal_out[[1]][[i]], filename = paste0("Tcs_celltype_per_clone_s_", unique(vgm_t[[1]]$group_id)[i],".svg"), dpi = 400, width = 11, height = 7)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-46-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-46-2.png" width="576"></p>
<p>Proceeding to DEG analysis by expansion at T cell subtype level</p>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#we join the expanded and T cell group to get a more detailed column. Then we use this column as input for the DEG genes analysis and find what sets these groups apart</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span>, <span class="st">" "</span>, <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">)</span>


<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group_expanded</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Expanded CD4 Th"</span>, <span class="st">"1 cell CD4 Th"</span>,<span class="st">"Expanded CD8 CTL"</span>, <span class="st">"1 cell CD8 CTL"</span>,<span class="st">"Expanded FOXP3 Treg"</span>, <span class="st">"1 cell FOXP3 Treg"</span>, <span class="st">"Expanded Other"</span>, <span class="st">"1 cell Other"</span>,<span class="st">"VDJ not available CD4 Th"</span>, <span class="st">"VDJ not available CD8 CTL"</span>, <span class="st">"VDJ not available FOXP3 Treg"</span>, <span class="st">"VDJ not available Other"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Showing numbers</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group_expanded</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##              Expanded CD4 Th                1 cell CD4 Th 
##                         2042                          470 
##             Expanded CD8 CTL               1 cell CD8 CTL 
##                          315                          191 
##          Expanded FOXP3 Treg            1 cell FOXP3 Treg 
##                           44                          149 
##               Expanded Other                 1 cell Other 
##                          834                          386 
##     VDJ not available CD4 Th    VDJ not available CD8 CTL 
##                          269                           89 
## VDJ not available FOXP3 Treg      VDJ not available Other 
##                           34                          620</code></pre>
<p>First helper CD4+ cells (Th)</p>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exp_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, grouping.column <span class="op">=</span> <span class="st">"Tc_group_expanded"</span>,group1 <span class="op">=</span> <span class="st">"Expanded CD4 Th"</span>, group2 <span class="op">=</span> <span class="st">"1 cell CD4 Th"</span>, return.plot <span class="op">=</span> <span class="st">"volcano"</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> 

<span class="co">#plot volcano</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(adj p)"</span>,title <span class="op">=</span> <span class="st">"Expanded vs. 1 cell CD4+"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">8</span> <span class="op">|</span> <span class="va">SYMBOL</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TCF7"</span>, <span class="st">"GZMB"</span>, <span class="st">"CD28"</span>, <span class="st">"CD69"</span>, <span class="st">"HIF1A"</span>, <span class="st">"TOX"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">7</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">40</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey10"</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="st">"darkorchid3"</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Tc_volc_cd4_expanded.svg", dpi = 400, width = 9, height = 7)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-48-1.png" width="576"></p>
<p>Next: CD8+ CTLs</p>
<div class="sourceCode" id="cb171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exp_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, grouping.column <span class="op">=</span> <span class="st">"Tc_group_expanded"</span>,group1 <span class="op">=</span> <span class="st">"Expanded CD8 CTL"</span>, group2 <span class="op">=</span> <span class="st">"1 cell CD8 CTL"</span>, return.plot <span class="op">=</span> <span class="st">"volcano"</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">#plot volcano</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(adj p)"</span>,title <span class="op">=</span> <span class="st">"Expanded vs. 1 cell CD8+"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1.8</span> <span class="op">|</span> <span class="va">SYMBOL</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TCF7"</span>, <span class="st">"GZMB"</span>, <span class="st">"CD28"</span>, <span class="st">"CD69"</span>, <span class="st">"TOX"</span>, <span class="st">"JUN"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">7</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">40</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey10"</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="st">"darkorchid3"</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Tc_volc_cd8_expanded.svg", dpi = 400, width = 9, height = 7)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-49-1.png" width="576"></p>
<p>And finally Tregs</p>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exp_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, grouping.column <span class="op">=</span> <span class="st">"Tc_group_expanded"</span>,group1 <span class="op">=</span> <span class="st">"Expanded FOXP3 Treg"</span>, group2 <span class="op">=</span> <span class="st">"1 cell FOXP3 Treg"</span>, return.plot <span class="op">=</span> <span class="st">"volcano"</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">#plot volcano</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">23</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">23</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(adj p)"</span>,title <span class="op">=</span> <span class="st">"Expanded vs. 1 cell FOXP3+"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.4</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">avg_logFC</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.95</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">7</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">40</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey10"</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="st">"darkorchid3"</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Tc_volc_foxp3_expanded.svg", dpi = 400, width = 9, height = 7)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-50-1.png" width="576"></p>
</div>
<div id="t-cells-vdj-gex-overview-by-projectils" class="section level2">
<h2 class="hasAnchor">
<a href="#t-cells-vdj-gex-overview-by-projectils" class="anchor" aria-hidden="true"></a>T cells VDJ GEX overview by ProjecTILs</h2>
<p>A recent publication (Andreatta, M. et al. Interpretation of T cell states from single-cell transcriptomics data using reference atlases. Nat. Commun. 12, 2965 (2021)) put forward a reference atlas of murine T cells, onto which local single cell data can easily be projected. We use this to verify our observation about phenotypes of expanded T cells Much of this is copied from the papers vignette, which we highly recommend.</p>
<div class="sourceCode" id="cb173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ProjecTILs</span><span class="op">)</span> <span class="co">#For installation instructions please refer to github carmonalab/ProjecTILs</span></code></pre></div>
<pre><code>## Lade nötiges Paket: umap</code></pre>
<pre><code>## Lade nötiges Paket: TILPRED</code></pre>
<pre><code>## Lade nötiges Paket: Matrix</code></pre>
<pre><code>## 
## Attache Paket: 'Matrix'</code></pre>
<pre><code>## The following objects are masked from 'package:tidyr':
## 
##     expand, pack, unpack</code></pre>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ref &lt;- load.reference.map() #If you do not have the reference dataset downloaded, it will download this for you. Loading is done via the same command. </span>
<span class="co">#For me loading did not work as expected, so we downloaded the file manually via my browser (https://doi.org/10.6084/m9.figshare.12489518) and read it in</span>
<span class="va">ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"C:/Dokumente usw/Master/Reddy Lab/1_thesis/3_code/4_DB project/EAE website vignette/ref_TILAtlas_mouse_v1.rds"</span><span class="op">)</span>

<span class="co">#Generating a dimplot of the reference </span>
<span class="va">refCols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#edbe2a"</span>, <span class="st">"#A58AFF"</span>, <span class="st">"#53B400"</span>, <span class="st">"#F8766D"</span>, <span class="st">"#00B6EB"</span>, <span class="st">"#d1cfcc"</span>, <span class="st">"#FF0000"</span>, <span class="st">"#87f6a5"</span>, <span class="st">"#e812dd"</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">ref</span>,label <span class="op">=</span> <span class="cn">T</span>, cols <span class="op">=</span> <span class="va">refCols</span><span class="op">)</span>

<span class="co">#And feature plots of the reference</span>
<span class="va">markers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cd4"</span>,<span class="st">"Cd8a"</span>,<span class="st">"Ccr7"</span>,<span class="st">"Tcf7"</span>,<span class="st">"Pdcd1"</span>,<span class="st">"Havcr2"</span>,<span class="st">"Tox"</span>,<span class="st">"Izumo1r"</span>,<span class="st">"Cxcr6"</span>,<span class="st">"Xcl1"</span>,<span class="st">"Gzmb"</span>,<span class="st">"Gzmk"</span>,<span class="st">"Ifng"</span>,<span class="st">"Foxp3"</span><span class="op">)</span>
<span class="fu"><a href="https://satijalab.org/seurat/reference/VlnPlot.html" class="external-link">VlnPlot</a></span><span class="op">(</span><span class="va">ref</span>,features<span class="op">=</span><span class="va">markers</span>,stack <span class="op">=</span> <span class="cn">T</span>,flip <span class="op">=</span> <span class="cn">T</span>,assay <span class="op">=</span> <span class="st">"RNA"</span><span class="op">)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-52-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-52-2.png" width="576"></p>
<p>Overlaying the query data (vgm_t[[2]]) to this reference</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#make query projection</span>
<span class="va">query.projected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProjecTILs/man/make.projection.html" class="external-link">make.projection</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, ref<span class="op">=</span><span class="va">ref</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Using assay RNA for query"</code></pre>
<pre><code>## Pre-filtering of T cells (TILPRED classifier)...</code></pre>
<pre><code>## Warning in predictTilState(sce, human = human): The following
## genes were not found in the dataset provided CD8B,HLA-
## DRA,NAPSB,NCF1C,HLA-DQB1,HLA-DPA1,IGLL5,HLA-DQA1,HLA-DRB1,HLA-
## DMB,HLA-DPB1,FCER2,HLA-DOB,TCL1A,HLA-DRB5,NCF1B,ELK2AP,HLA-
## DMA,CYBASC3,IGJ,C1S,C1R,WISP2,CTGF,PLA2G2A,PTRF,CYR61,C10orf10,CCL14,DARC,CCL21,SERPINA1,FCGR3A,FCGR2A,FAM26F,MS4A6A,CTSL1,FCN1,IL8,SEPP1,SERPINA3,MT2A,KLRF1 .
## Doesn't look too bad but prediction performance might be affected.</code></pre>
<pre><code>## Genes in the gene sets NOT available in the dataset: 
##  Tcell:  1 (12% of 8)
##  B.cell:     19 (38% of 50)
##  CAF:    5 (10% of 49)
##  Endo.:  7 (15% of 46)
##  Macrophage:     16 (35% of 46)
##  Mal:    3 (7% of 45)
##  NK:     2 (29% of 7)</code></pre>
<pre><code>## [1] "2952 out of 5444 ( 54 % ) non-pure T cells removed.  Use filter.cells=FALSE to avoid pre-filtering (NOT RECOMMENDED)"
## [1] "Transforming expression matrix into space of mouse orthologs"
## [1] "Aligning query to reference map for batch-correction..."</code></pre>
<pre><code>## Computing within dataset neighborhoods</code></pre>
<pre><code>## Finding all pairwise anchors</code></pre>
<pre><code>## Projecting new data onto SVD
## Projecting new data onto SVD</code></pre>
<pre><code>## Finding neighborhoods</code></pre>
<pre><code>## Finding anchors</code></pre>
<pre><code>##  Found 1050 anchors</code></pre>
<pre><code>## 
## Projecting corrected query onto Reference PCA space
## [1] "Projecting corrected query onto Reference UMAP space"</code></pre>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Plot overlay on umap as density</span>
<span class="fu"><a href="https://rdrr.io/pkg/ProjecTILs/man/plot.projection.html" class="external-link">plot.projection</a></span><span class="op">(</span><span class="va">ref</span>, <span class="va">query.projected</span><span class="op">)</span>
<span class="co">#ggsave(plot = last_plot(), filename = "ProjecTILs_overlay.png", dpi = 700, width = 8, height = 6)</span>

<span class="co">#Get a barplot of cell states</span>
<span class="va">query.projected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProjecTILs/man/cellstate.predict.html" class="external-link">cellstate.predict</a></span><span class="op">(</span>ref<span class="op">=</span><span class="va">ref</span>, query<span class="op">=</span><span class="va">query.projected</span><span class="op">)</span></code></pre></div>
<pre><code>## Creating slots functional.cluster and functional.cluster.conf in query object</code></pre>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/ProjecTILs/man/plot.statepred.composition.html" class="external-link">plot.statepred.composition</a></span><span class="op">(</span><span class="va">ref</span>, <span class="va">query.projected</span>,metric <span class="op">=</span> <span class="st">"Percent"</span><span class="op">)</span></code></pre></div>
<pre><code>## Lade nötiges Paket: reshape2</code></pre>
<pre><code>## 
## Attache Paket: 'reshape2'</code></pre>
<pre><code>## The following object is masked from 'package:tidyr':
## 
##     smiths</code></pre>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = last_plot(), filename = "ProjecTILs_celltypes.png", dpi = 700, width = 6, height = 5)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-53-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-53-2.png" width="576"></p>
<p>We can then use the expansion information to check for reference T cell phenotypes that match our expanded phenotype</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#split by that</span>
<span class="va">not_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">query.projected</span>, <span class="va">expanded</span> <span class="op">==</span> <span class="st">"1 cell"</span><span class="op">)</span>
<span class="va">expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">query.projected</span>, <span class="va">expanded</span> <span class="op">==</span> <span class="st">"Expanded"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ProjecTILs/man/plot.projection.html" class="external-link">plot.projection</a></span><span class="op">(</span><span class="va">ref</span>, <span class="va">expanded</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/ProjecTILs/man/plot.projection.html" class="external-link">plot.projection</a></span><span class="op">(</span><span class="va">ref</span>, <span class="va">not_expanded</span><span class="op">)</span>

<span class="co">#summarize this and plot the same as an easy to view stacked barplot</span>
<span class="va">melting</span> <span class="op">&lt;-</span> <span class="va">query.projected</span><span class="op">@</span><span class="va">meta.data</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">expanded</span>, <span class="va">functional.cluster</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">for_norm</span> <span class="op">&lt;-</span> <span class="va">query.projected</span><span class="op">@</span><span class="va">meta.data</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">functional.cluster</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>n_all <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="va">melting</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">melting</span>,<span class="va">for_norm</span>, by <span class="op">=</span><span class="st">"functional.cluster"</span>, all.x <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">melting</span><span class="op">$</span><span class="va">norm</span> <span class="op">&lt;-</span> <span class="va">melting</span><span class="op">$</span><span class="va">n</span> <span class="op">/</span> <span class="va">melting</span><span class="op">$</span><span class="va">n_all</span> <span class="op">*</span> <span class="fl">100</span> <span class="co">#normalize frequencies across reference clusters</span>

<span class="va">output.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">melting</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">expanded</span>, y<span class="op">=</span><span class="va">norm</span>, x<span class="op">=</span> <span class="va">functional.cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, width<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span><span class="st">"black"</span>, position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"% of cells of clonal group"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"ProjectTIL phenotype assignment"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey30"</span>,<span class="st">"darkorchid3"</span>,<span class="st">"grey70"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">26</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>l <span class="op">=</span> <span class="fl">1</span>, t <span class="op">=</span> <span class="fl">1</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Clonal level"</span><span class="op">)</span>

<span class="va">output.plot</span>

<span class="co">#ggsave(plot = output.plot, filename = paste0("ProjecTILs_stacked_expansion.png"), dpi = 700, width = 9, height = 9) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-54-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-54-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-54-3.png" width="576"></p>
</div>
<div id="t-cells-vdj-gex-integration-of-human-data-by-beltrán-et-al-" class="section level2">
<h2 class="hasAnchor">
<a href="#t-cells-vdj-gex-integration-of-human-data-by-beltr%C3%A1n-et-al-" class="anchor" aria-hidden="true"></a>T cells VDJ GEX integration of human data by Beltrán et al. </h2>
<p>A second recent publication (Beltrán, E. et al. Early adaptive immune activation detected in monozygotic twins with prodromal multiple sclerosis. J. Clin. Invest. 129, 4758–4768 (2019)) about lymphocytes in the CNS of discordant twins (twins were one developed Multiple sclerosis, while the other has not) highlighted a resident memory-like phenotype of expanded T cells in MS as well as other inflammatory neurological conditions (SCNwe = subclinical neuroinflammation, Enc = autoimmune encephalitis, HD /NIC = Healthy donors, Non-inflammatory controls)</p>
<p>Here we load in the raw data of that publication to investigate if similar cellular patterns can be observed in murine EAE</p>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#data downloaded and loaded loaded in manually from GEO GSE127969</span>
<span class="co">#tpm &lt;- read.delim("GSE127969_counts_TPM_ALL.csv.gz")</span>
<span class="va">inf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="st">"C:/Dokumente usw/Master/Reddy Lab/1_thesis/3_code/4_DB project/EAE website vignette/GSE127969_sc_cell_info.txt.gz"</span><span class="op">)</span>
<span class="co">#bar &lt;-  read.delim("GSE127969_cellID_barcode_SRR.txt.gz")</span>

<span class="co">#make Seurat object</span>
<span class="co">#rownames(tpm) &lt;- tpm$Symbol</span>
<span class="co">#tpm &lt;- tpm[,-c(1)]</span>

<span class="co">#tpm_s &lt;- CreateSeuratObject(tpm, names.delim = "/", names.field = 1)</span>
<span class="co">#tpm &lt;- NULL</span>

<span class="co">#using a Platypus function to process raw reads</span>
<span class="co">#tpm_s &lt;- automate_GEX(GEX.list = list(tpm_s), GEX.outs.directory.list = "none")</span>

<span class="co">#saveRDS(tpm_s, "Beltran_GEX.rds")</span>

<span class="co">#Loading in a processed object for faster knitting</span>
<span class="va">tpm_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"C:/Dokumente usw/Master/Reddy Lab/1_thesis/3_code/4_DB project/EAE website vignette/Beltran_GEX.rds"</span><span class="op">)</span>

<span class="co">#figure out which cells are which</span>
<span class="va">inf_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">inf</span><span class="op">$</span><span class="va">Cell</span>, <span class="st">"_[A-Z]\\d\\d"</span><span class="op">)</span>
<span class="va">tpm_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">tpm_s</span><span class="op">)</span>, <span class="st">"_[A-Z]\\d+"</span><span class="op">)</span>

<span class="co">#apparently there are a few more cells in info than in the object. Lets remove those</span>
<span class="va">met</span> <span class="op">&lt;-</span> <span class="va">tpm_s</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span>
<span class="va">met</span><span class="op">$</span><span class="va">Cell</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">met</span><span class="op">)</span>
<span class="va">new_met</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">met</span>, <span class="va">inf</span>, by <span class="op">=</span> <span class="st">"Cell"</span>, all.x <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">new_met</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">new_met</span><span class="op">$</span><span class="va">Cell</span>
<span class="va">tpm_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/AddMetaData.html" class="external-link">AddMetaData</a></span><span class="op">(</span><span class="va">tpm_s</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">new_met</span><span class="op">)</span> <span class="co">#make tpm_s a Seurat object instead of a list</span>

<span class="co">#add expansion information based on clone column</span>
<span class="va">tpm_s</span><span class="op">$</span><span class="va">Expanded</span> <span class="op">&lt;-</span> <span class="st">"1 cell"</span>
<span class="va">tpm_s</span><span class="op">$</span><span class="va">Expanded</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">tpm_s</span><span class="op">$</span><span class="va">Clones</span> <span class="op">&gt;</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">tpm_s</span><span class="op">$</span><span class="va">Clones</span> <span class="op">!=</span> <span class="st">"ND"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Expanded"</span>
<span class="va">tpm_s</span><span class="op">$</span><span class="va">exp_past</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">tpm_s</span><span class="op">$</span><span class="va">Expanded</span>, <span class="st">" "</span>, <span class="va">tpm_s</span><span class="op">$</span><span class="va">index.sort</span><span class="op">)</span>
<span class="va">tpm_s</span><span class="op">$</span><span class="va">exp_past_diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">tpm_s</span><span class="op">$</span><span class="va">Expanded</span>, <span class="st">" "</span>, <span class="va">tpm_s</span><span class="op">$</span><span class="va">Case</span><span class="op">)</span>

<span class="co">#SUBSET CD8</span>
<span class="va">tpm_cd8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tpm_s</span>, <span class="va">index.sort</span> <span class="op">==</span> <span class="st">"CD8Tcell"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">tpm_cd8</span><span class="op">$</span><span class="va">exp_past_diag</span> <span class="op">)</span></code></pre></div>
<pre><code>## 
##    1 cell Enc     1 cell HD     1 cell MS   1 cell SCNI  Expanded Enc 
##            57           203           230           283            22 
##   Expanded HD   Expanded MS Expanded SCNI 
##             5            94            50</code></pre>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#order by condition and clonal level</span>
<span class="va">tpm_cd8</span><span class="op">$</span><span class="va">exp_past_diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">tpm_cd8</span><span class="op">$</span><span class="va">exp_past_diag</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1 cell HD"</span>, <span class="st">"Expanded HD"</span>,<span class="st">"1 cell SCNI"</span>, <span class="st">"Expanded SCNI"</span>, <span class="st">"1 cell MS"</span>, <span class="st">"Expanded MS"</span>, <span class="st">"1 cell Enc"</span>, <span class="st">"Expanded Enc"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#plot dotmap</span>
<span class="va">linesv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span><span class="va">tpm_cd8</span>, genes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>, <span class="st">"CD8A"</span>,<span class="st">"PTPRC"</span>,<span class="st">"CCR7"</span>,<span class="st">"SELL"</span>, <span class="st">"CD69"</span>,<span class="st">"CXCR6"</span>, <span class="st">"CCR5"</span>,<span class="st">"TCF7"</span>,<span class="st">"S1PR1"</span>, <span class="st">"IL7R"</span>,<span class="st">"TOX"</span>, <span class="st">"SOCS3"</span>,<span class="st">"GZMB"</span>,<span class="st">"TGFB1"</span><span class="op">)</span>, group.by <span class="op">=</span> <span class="st">"exp_past_diag"</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Human CD8+ T cells"</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">linesv</span>, color <span class="op">=</span> <span class="st">"black"</span>, size<span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">13</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#for showing in the vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 18 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot_out, filename = "TcsBeltran_dottile_CD8_rel.svg", width = 11.5, height = 11.5, dpi = 300)</span>

<span class="co">#SUBSET CD4</span>
<span class="va">tpm_cd4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tpm_s</span>, <span class="va">index.sort</span> <span class="op">==</span> <span class="st">"CD4Tcell"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">tpm_cd4</span><span class="op">$</span><span class="va">exp_past_diag</span> <span class="op">)</span></code></pre></div>
<pre><code>## 
##    1 cell Enc     1 cell HD     1 cell MS   1 cell SCNI  Expanded Enc 
##            75           198           227           318             4 
##   Expanded HD   Expanded MS Expanded SCNI 
##             4            23            22</code></pre>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#order by condition and clonal level</span>
<span class="va">tpm_cd4</span><span class="op">$</span><span class="va">exp_past_diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">tpm_cd4</span><span class="op">$</span><span class="va">exp_past_diag</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="st">"1 cell HD"</span>, <span class="st">"Expanded HD"</span>,<span class="st">"1 cell SCNI"</span>, <span class="st">"Expanded SCNI"</span>, <span class="st">"1 cell MS"</span>, <span class="st">"Expanded MS"</span>, <span class="st">"1 cell Enc"</span>, <span class="st">"Expanded Enc"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#plot dotmap</span>
<span class="va">linesv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span><span class="va">tpm_cd4</span>, genes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>, <span class="st">"CD8A"</span>,<span class="st">"PTPRC"</span>,<span class="st">"CCR7"</span>,<span class="st">"SELL"</span>, <span class="st">"CD69"</span>,<span class="st">"CXCR6"</span>, <span class="st">"CCR5"</span>,<span class="st">"TCF7"</span>,<span class="st">"S1PR1"</span>, <span class="st">"IL7R"</span>,<span class="st">"TOX"</span>, <span class="st">"SOCS3"</span>,<span class="st">"GZMB"</span>,<span class="st">"TGFB1"</span><span class="op">)</span>, group.by <span class="op">=</span> <span class="st">"exp_past_diag"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Human CD4+ T cells"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x<span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">linesv</span>, color <span class="op">=</span> <span class="st">"black"</span>, size<span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">13</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#for showing in the vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 30 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot_out, filename = "TcsBeltran_dottile_CD4_rel.svg", width = 10, height = 10, dpi = 300)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-56-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-56-2.png" width="576"></p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">bar</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in rm(bar): Objekt 'bar' nicht gefunden</code></pre>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">inf</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">met</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span>pattern<span class="op">=</span><span class="st">"tpm"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##             used   (Mb) gc trigger    (Mb)   max used    (Mb)
## Ncells   8919017  476.4   13861893   740.4   13861893   740.4
## Vcells 807018187 6157.1 2172926744 16578.2 1840482019 14041.8</code></pre>
<p>We follow this up with identical dottiles containing EAE and aged CNS data</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#add expansion measures</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span> <span class="op">&lt;-</span> <span class="st">"VDJ not available"</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">[</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Expanded"</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">[</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"1 cell"</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">[</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_available</span> <span class="op">==</span> <span class="cn">F</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"VDJ not available"</span>

<span class="co">#we join the expanded and T cell group to get a more detailed column. Then we use this column as input for the DEG genes analysis and find what sets these groups apart</span>
<span class="co">#t cell group</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span> <span class="op">&lt;-</span> <span class="st">"Other"</span> 
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.org/seurat/reference/AssayData.html" class="external-link">GetAssayData</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, assay <span class="op">=</span> <span class="st">"RNA"</span>, slot <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="st">"CD4"</span><span class="op">)</span>,<span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"CD4"</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.org/seurat/reference/AssayData.html" class="external-link">GetAssayData</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, assay <span class="op">=</span> <span class="st">"RNA"</span>, slot <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="st">"CD8A"</span><span class="op">)</span>,<span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"CD8"</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Tc_group</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://satijalab.org/seurat/reference/AssayData.html" class="external-link">GetAssayData</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, assay <span class="op">=</span> <span class="st">"RNA"</span>, slot <span class="op">=</span> <span class="st">"counts"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">==</span> <span class="st">"FOXP3"</span><span class="op">)</span>,<span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"FOXP3"</span>

<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span>, <span class="st">" "</span>, <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_expanded</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##            1 cell aged CNS                 1 cell EAE 
##                        293                       1193 
##          Expanded aged CNS               Expanded EAE 
##                        283                       3222 
## VDJ not available aged CNS      VDJ not available EAE 
##                        128                       1013</code></pre>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vgm_EAEaged_allGEX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">expanded</span> <span class="op">!=</span> <span class="st">"VDJ not available"</span><span class="op">)</span> <span class="co">#removing cells without VDJ information from GEX</span>
<span class="va">vgm_EAEaged_allGEX</span><span class="op">$</span><span class="va">group_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_EAEaged_allGEX</span><span class="op">$</span><span class="va">group_expanded</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1 cell EAE"</span>, <span class="st">"Expanded EAE"</span>, <span class="st">"1 cell aged CNS"</span>, <span class="st">"Expanded aged CNS"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#dottile CD8</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_EAEaged_allGEX</span>, <span class="va">Tc_group</span> <span class="op">==</span> <span class="st">"CD8"</span><span class="op">)</span>, genes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>, <span class="st">"CD8A"</span>,<span class="st">"PTPRC"</span>,<span class="st">"CCR7"</span>,<span class="st">"SELL"</span>, <span class="st">"CD69"</span>,<span class="st">"CXCR6"</span>, <span class="st">"CCR5"</span>,<span class="st">"TCF7"</span>,<span class="st">"S1PR1"</span>, <span class="st">"IL7R"</span>,<span class="st">"TOX"</span>, <span class="st">"SOCS3"</span>,<span class="st">"GZMB"</span>,<span class="st">"TGFB1"</span><span class="op">)</span>, group.by <span class="op">=</span> <span class="st">"group_expanded"</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Murine CD8+ T cells"</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">13</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>,<span class="fl">2.5</span>,<span class="fl">3.5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size<span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 6 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot_out, filename = "TcsEAEaged_dottile_CD8_rel.svg", width = 10, height = 12, dpi = 300)</span>


<span class="co">#dottile CD4</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_EAEaged_allGEX</span>, <span class="va">Tc_group</span> <span class="op">==</span> <span class="st">"CD4"</span><span class="op">)</span>, genes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>, <span class="st">"CD8A"</span>,<span class="st">"PTPRC"</span>,<span class="st">"CCR7"</span>,<span class="st">"SELL"</span>, <span class="st">"CD69"</span>,<span class="st">"CXCR6"</span>, <span class="st">"CCR5"</span>,<span class="st">"TCF7"</span>,<span class="st">"S1PR1"</span>, <span class="st">"IL7R"</span>,<span class="st">"TOX"</span>, <span class="st">"SOCS3"</span>,<span class="st">"GZMB"</span>,<span class="st">"TGFB1"</span><span class="op">)</span>, group.by <span class="op">=</span> <span class="st">"group_expanded"</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Murine CD4+ T cells"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">13</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.5</span>,<span class="fl">2.5</span>,<span class="fl">3.5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, size<span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 8 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot_out, filename = "TcsEAEaged_dottile_CD4_rel.svg", width = 10, height = 12, dpi = 300)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-59-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-59-2.png" width="576"></p>
<p>As a final view of T cells in EAE and aged CNS, we can replot the umap from before, but overlay clonal expansion information</p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Add group expansion identifier column</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span>, <span class="st">" "</span>, <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_expanded</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##            aged CNS 1 cell          aged CNS Expanded 
##                        293                        283 
## aged CNS VDJ not available                 EAE 1 cell 
##                        128                       1193 
##               EAE Expanded      EAE VDJ not available 
##                       3222                       1013</code></pre>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_expanded</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EAE 1 cell"</span>, <span class="st">"EAE Expanded"</span>, <span class="st">"aged CNS 1 cell"</span>, <span class="st">"aged CNS Expanded"</span>, <span class="st">"EAE VDJ not available"</span>, <span class="st">"aged CNS VDJ not available"</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"group_expanded"</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey30"</span>,<span class="st">"darkorchid3"</span>, <span class="va">samples_color_aged</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span>, <span class="st">"gold2"</span>, <span class="st">"grey80"</span> ,<span class="st">"grey80"</span><span class="op">)</span>, shuffle <span class="op">=</span> <span class="cn">T</span>, pt.size <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> 
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Clonal level"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">3</span>,byrow<span class="op">=</span><span class="cn">TRUE</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> 

<span class="co">#ggsave(plot = plot_ , filename = "Tcs_EAEaged_expansion_discrete.svg", dpi = 700, width = 10, height = 5) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-60-1.png" width="576"></p>
</div>
<div id="t-cells-mog-specific-tcrs-by-public-dataset-integration" class="section level2">
<h2 class="hasAnchor">
<a href="#t-cells-mog-specific-tcrs-by-public-dataset-integration" class="anchor" aria-hidden="true"></a>T cells MOG-specific TCRs by public dataset integration</h2>
<p>A key goal was to validate the presence of MOG-specific T cells within our dataset. For this a literature search resulted in several T cell repertoire datasets in EAE. For dataset reference see publication</p>
<p>As part of this vignette we do not show the whole download and formatting process of these, but rather load in a formatted table of CDR3s</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#comb &lt;- readRDS("~/Combined VDJ_comb Literature MOG TCRs.rds")</span>

<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">comb</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "EAE"                          "Aged"                        
## [3] "Broder Engler 2019"           "2D2 MOG-specific derivatives"
## [5] "MOG-specific Saligrama 2020"  "Schliffke 2019"              
## [7] "Martinez Riano 2019"</code></pre>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#minor corrections in naming scheme</span>
<span class="va">comb</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"MOG-specific "</span>, <span class="st">""</span>, <span class="va">comb</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>
<span class="va">comb</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"Aged"</span>, <span class="st">"aged CNS"</span>, <span class="va">comb</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>

<span class="co">#addin a barcode column that the overlap function needs to generate an adjunct frequency table with tidy information</span>
<span class="va">comb</span><span class="op">$</span><span class="va">barcode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">comb</span><span class="op">)</span><span class="op">)</span>

<span class="va">cdra_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">comb</span>,
                    feature.columns <span class="op">=</span> <span class="st">"VJ_cdr3s_aa"</span>,
                    grouping.column <span class="op">=</span> <span class="st">"group_id"</span>,
                    pvalues.label.size <span class="op">=</span> <span class="fl">6</span>,
                    axis.label.size <span class="op">=</span> <span class="fl">16</span>,
                    add.barcode.table <span class="op">=</span> <span class="cn">T</span>,
                    platypus.version <span class="op">=</span> <span class="st">"v3"</span>,
                    plot.type <span class="op">=</span> <span class="st">"pheatmap"</span><span class="op">)</span>


<span class="va">cdra_overlap</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="co">#ggsave(last_plot(), filename = "MOGspec_Overlap_cdra.svg", dpi = 400, width = 6.5, height = 6.5)</span>


<span class="va">cdrb_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">comb</span>,
                    feature.columns <span class="op">=</span> <span class="st">"VDJ_cdr3s_aa"</span>,
                    grouping.column <span class="op">=</span> <span class="st">"group_id"</span>,
                    pvalues.label.size <span class="op">=</span> <span class="fl">6</span>,
                    axis.label.size <span class="op">=</span> <span class="fl">16</span>,
                    add.barcode.table <span class="op">=</span> <span class="cn">T</span>,
                    platypus.version <span class="op">=</span> <span class="st">"v3"</span>,
                    plot.type <span class="op">=</span> <span class="st">"pheatmap"</span><span class="op">)</span>

<span class="va">cdrb_overlap</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="co">#ggsave(cdrb_overlap[[1]], filename = "MOGspec_Overlap_cdrb.svg", dpi = 400, width = 6.5, height = 6.5)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-62-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-62-2.png" width="576"></p>
<p>We found two clones in the EAE MOG35-55 dataset that were reported to be MOG35-55-specific by Saligrama et al. Here we briefly explore the phenotypes of these cells</p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#add specificity info to VDJ...</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">MOG_spec</span> <span class="op">&lt;-</span> <span class="cn">F</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">MOG_spec</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cdr3s_aa</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CASGDAGGGQNTLYF"</span>, <span class="st">"CASSLETANTEVFF"</span><span class="op">)</span> <span class="op">|</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VJ_cdr3s_aa</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CAASEGQGGRALIF"</span>, <span class="st">"CAVSAGTNAYKVIF"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">T</span>

<span class="co">#...and GEX table</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">MOG_spec</span> <span class="op">&lt;-</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_id_10x</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">MOG_spec</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cdr3s_aa</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CASGDAGGGQNTLYF"</span>, <span class="st">"CASSLETANTEVFF"</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VJ_cdr3s_aa</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CAASEGQGGRALIF"</span>, <span class="st">"CAVSAGTNAYKVIF"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"FALSE"</span>

<span class="co">#Standard dotmap first </span>
<span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD4"</span>,<span class="st">"CD8A"</span>,<span class="st">"CD28"</span>,<span class="st">"ICOS"</span>,<span class="st">"CD40LG"</span>,<span class="st">"PDCD1"</span>,<span class="st">"LAG3"</span>,<span class="st">"S1PR1"</span>,<span class="st">"PTPRC"</span>,<span class="st">"SELL"</span>,<span class="st">"TBX21"</span>,<span class="st">"GATA3"</span>,<span class="st">"SPI1"</span>,<span class="st">"IRF4"</span>,<span class="st">"BCL6"</span>,<span class="st">"STAT4"</span>,<span class="st">"STAT6"</span>,<span class="st">"FOXP3"</span>, <span class="st">"MKI67"</span>,<span class="st">"TCF7"</span>,<span class="st">"TOX"</span>, <span class="st">"GZMB"</span>,<span class="st">"IFNG"</span>,<span class="st">"TGFB1"</span>,<span class="st">"IL10"</span>,<span class="st">"IL17A"</span>,<span class="st">"CSF2"</span>,<span class="st">"IL2RA"</span>,<span class="st">"IL4RA"</span>,<span class="st">"IL12RB1"</span>,<span class="st">"CXCR3"</span>,<span class="st">"CCR5"</span>,<span class="st">"CCR8"</span>,<span class="st">"ITGA4"</span>,<span class="st">"ITGB2"</span><span class="op">)</span>

<span class="va">linesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">genes_to_plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, genes <span class="op">=</span> <span class="va">genes_to_plot</span>, group.by <span class="op">=</span> <span class="st">"MOG_spec"</span>, threshold.to.plot <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"% positive"</span>, color <span class="op">=</span> <span class="st">"Expression"</span>, x <span class="op">=</span> <span class="st">"MOG specific"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">29</span>, angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>,vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">linesh</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#for showing in the vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 36 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = plot_out, filename = "MOGspec_cluster_custom_genes_dottile.svg", dpi = 400, width = 8, height = 14.5)</span>

<span class="co">#project onto umap</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">MOG_spec_umap</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>
<span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">MOG_spec_umap</span><span class="op">[</span><span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">MOG_spec</span> <span class="op">!=</span> <span class="st">"FALSE"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">T</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_GEX_overlay_clones.html">VDJ_GEX_overlay_clones</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_t</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, by.sample <span class="op">=</span> <span class="cn">F</span>, clones.to.plot <span class="op">=</span> <span class="st">"MOG_spec_umap"</span>,ncol.facet <span class="op">=</span> <span class="fl">1</span>,pt.size <span class="op">=</span> <span class="fl">0.6</span>,split.plot.and.legend <span class="op">=</span> <span class="cn">T</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, by.other.group <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>##                                     s_cl sample_id group_id clonotype_id_10x
## s1_AAACCTGCACATTAGC-1  rMOG_1clonotype79    rMOG_1     rMOG      clonotype79
## s1_AAACCTGCAGCCTTGG-1  rMOG_1clonotype25    rMOG_1     rMOG      clonotype25
## s1_AAACCTGGTACACCGC-1  rMOG_1clonotype28    rMOG_1     rMOG      clonotype28
## s1_AAACCTGGTCGGCTCA-1           rMOG_1NA    rMOG_1     rMOG             &lt;NA&gt;
## s1_AAACCTGGTTATGTGC-1 rMOG_1clonotype353    rMOG_1     rMOG     clonotype353
## s1_AAACCTGTCACTGGGC-1   rMOG_1clonotype2    rMOG_1     rMOG       clonotype2
##                       clonotype_frequency clonotype_to_plot
## s1_AAACCTGCACATTAGC-1                   4             FALSE
## s1_AAACCTGCAGCCTTGG-1                  14             FALSE
## s1_AAACCTGGTACACCGC-1                  12             FALSE
## s1_AAACCTGGTCGGCTCA-1                  NA             FALSE
## s1_AAACCTGGTTATGTGC-1                   1             FALSE
## s1_AAACCTGTCACTGGGC-1                  72             FALSE</code></pre>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Package needed below: </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attache Paket: 'gridExtra'</code></pre>
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     combine</code></pre>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">plot_out</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co">#as a grid object, we need to use the plot function to print the legend</span>
<span class="va">plot_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="co">#ggsave(plot = plot_out[[2]], filename = "MOGspec_overlay_leg.svg", dpi = 700, width = 10, height = 10)</span>
<span class="co">#ggsave(plot = plot_out[[1]], filename = "MOGspec_overlay_plot.svg", dpi = 700, width = 4.5, height = 4.5) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-63-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-63-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-63-3.png" width="576"></p>
<p>This concludes our journey through the T cells from this dataset. We will now progress on to B cells</p>
</div>
<div id="exploring-gex-of-b-cells-by-cluster" class="section level2">
<h2 class="hasAnchor">
<a href="#exploring-gex-of-b-cells-by-cluster" class="anchor" aria-hidden="true"></a>Exploring GEX of B cells by cluster</h2>
<p>The walk through of B cells will in many ways be very similar to that of T cells. The VDJ and VDJ GEX integration contains more specific B cell-specific analysis.</p>
<p>Querying the transcriptional phenotypes of B cells in this dataset. We will start with some overview UMAPs and work towards cluster classification</p>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#By sample </span>
<span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"sample_id"</span>, cols <span class="op">=</span> <span class="va">samples_color</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Sample"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> 

<span class="co">#ggsave(plot = last_plot(), filename = "Bcs_umap_sample.svg", dpi = 700, width = 6.5, height = 5)</span>

<span class="co">#By group</span>
<span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"group_id"</span>, cols <span class="op">=</span> <span class="va">groups_color</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Sample"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> 

<span class="co">#ggsave(plot = last_plot(), filename = "Bcs_umap_group.svg", dpi = 700, width = 6.5, height = 5)</span>

<span class="co">#By cluster</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kwstat.github.io/pals/" class="external-link">pals</a></span><span class="op">)</span> <span class="co">#the pals package offers some great varities of palettes, especially for applications were rColorBrewer palettes contain too few distinct colors</span>

<span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"seurat_clusters"</span>, cols <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span><span class="op">)</span><span class="op">]</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Cluster"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> 

<span class="co">#ggsave(plot = last_plot(), filename = "Bcs_umap_clusters.svg", dpi = 700, width = 6.5, height = 5)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-65-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-65-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-65-3.png" width="576"></p>
<p>We see clear overlap between samples. Almost all clusters are composed of cells of all samples and groups. To visualize proportions specifically, we use a stacked barplot</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_members</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_proportions_barplot.html">GEX_proportions_barplot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,source.group <span class="op">=</span> <span class="st">"sample_id"</span>, target.group <span class="op">=</span> <span class="st">"seurat_clusters"</span>, stacked.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span>, labels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">33</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">33</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"% of cells of cluster"</span>, fill <span class="op">=</span> <span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ordering based on existing source group factor levels"
##  [1] rMOG_1   rMOG_1   rMOG_1   rMOG_1   rMOG_1   rMOG_1   rMOG_1   rMOG_2  
##  [9] rMOG_2   rMOG_2   rMOG_2   rMOG_2   rMOG_2   rMOG_2   MOG35-55 MOG35-55
## [17] MOG35-55 MOG35-55 MOG35-55 MOG35-55 MOG35-55
## Levels: rMOG_1 &lt; rMOG_2 &lt; MOG35-55
## [1] "Ordering based on existing target group factor levels"
## [1] "Returning stacked barplot with y axis = % of cells of target group"</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_members</span> 

<span class="co">#ggsave(last_plot(), filename = "Bc_cluster_membership_sample_new.svg", dpi = 400, width = 10, height = 8)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-66-1.png" width="576"></p>
<p>Checking what the cluster represent. Step 1: Project common markers to get a basic idea</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span>

<span class="fu"><a href="https://satijalab.org/seurat/reference/FeaturePlot.html" class="external-link">FeaturePlot</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD19"</span>,<span class="st">"PTPRC"</span>, <span class="st">"CD74"</span>, <span class="st">"MS4A1"</span><span class="op">)</span>, reduction <span class="op">=</span> <span class="st">"umap"</span>, label <span class="op">=</span> <span class="cn">F</span>, repel <span class="op">=</span> <span class="cn">F</span>, pt.size <span class="op">=</span> <span class="fl">1.3</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.1</span><span class="op">)</span>, legend.direction <span class="op">=</span> <span class="st">"horizontal"</span>, axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">27</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey80"</span>, mid <span class="op">=</span> <span class="st">"grey80"</span>, high <span class="op">=</span> <span class="st">"#DD513AFF"</span>, oob <span class="op">=</span> <span class="va">squish_infinite</span><span class="op">)</span> <span class="co">#We position the legend inside the plot using legend.position, to save some space. Further we use the "squish_infinite" function of the scales package to easily reppresent outlier values without compromising overall color scales.  </span></code></pre></div>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.
## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.
## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.
## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = last_plot(), filename = "Bcs_umap_Tcell_basic.svg", dpi = 400, width = 10, height = 10)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-67-1.png" width="576"></p>
<p>For a more in depth look at marker expression, we use the dottile function for some common B cell markers.</p>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Check what genes are available with this searchable dataframe view (at least in R studio)</span>
<span class="co">#View(as.data.frame(rownames(vgm_b)))</span>

<span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD19"</span>, <span class="st">"CD74"</span>,<span class="st">"SDC1"</span>, <span class="st">"EBF1"</span>,<span class="st">"PTPRC"</span>,<span class="st">"CD38"</span>,<span class="st">"CD24A"</span>,<span class="st">"CD1D1"</span>,<span class="st">"CD5"</span>,<span class="st">"MS4A1"</span>,<span class="st">"CXCR5"</span>,<span class="st">"SELL"</span>,<span class="st">"CD40"</span>,<span class="st">"CD83"</span>,<span class="st">"H2-AB1"</span>,<span class="st">"H2-EB1"</span>,<span class="st">"CD27"</span>,<span class="st">"POU2AF1"</span>,<span class="st">"NT5E"</span>,<span class="st">"FASL"</span>,<span class="st">"PDCD1LG2"</span>,<span class="st">"PRDM1"</span>,<span class="st">"ITGAM"</span>,<span class="st">"TGFB1"</span>,<span class="st">"ZCWPW1"</span><span class="op">)</span>

<span class="va">linesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">genes_to_plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="co">#these lines are for easier viewing of the plot</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, genes <span class="op">=</span> <span class="va">genes_to_plot</span>, group.by <span class="op">=</span> <span class="st">"seurat_clusters"</span>, threshold.to.plot <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"% positive"</span>, color <span class="op">=</span> <span class="st">"Expression"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">29</span>, angle <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>,vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">linesh</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span> <span class="co">#we end the viridis palette at .85 specifically, to avoid bright yellow spots that can be hard to view when printed</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb257"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#For vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 54 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb259"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = last_plot(), filename = "Bc_dottile.svg", dpi = 400, width = 10, height = 15)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-68-1.png" width="576"></p>
<p>After getting some visual evidence the search leads to cluster specific genes by DEG analysis. Here we are using the GEX_cluster_genes to find genes that are deferentially expressed in one cluster in comparison to all other cluster</p>
<div class="sourceCode" id="cb260"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Warning: running this function will take a while</span>
<span class="va">gene_expression_cluster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_cluster_genes.html">GEX_cluster_genes</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,min.pct <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> 

<span class="co">#saveRDS(gene_expression_cluster, file = "Bcs_gene_expression_clusters.rds")</span>

<span class="co">#Recommended to get an overview of the output format</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">gene_expression_cluster</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "p_val"     "avg_logFC" "pct.1"     "pct.2"     "p_val_adj" "SYMBOL"   
## [7] "cluster"</code></pre>
<div class="sourceCode" id="cb262"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#View(gene_expression_cluster[[1]])</span></code></pre></div>
<p>We can visualize these cluster defining genes both as a heatmap, a dotmap and as volcano plots</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#heatmap</span>
<span class="va">EAE_heatmap_clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_cluster_genes_heatmap.html">GEX_cluster_genes_heatmap</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, GEX_cluster_genes.output <span class="op">=</span> <span class="va">gene_expression_cluster</span>, n.genes.per.cluster <span class="op">=</span> <span class="fl">5</span>,max.cell <span class="op">=</span> <span class="fl">30</span>, metric <span class="op">=</span> <span class="st">"top_logFC"</span>, group.colors <span class="op">=</span> <span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>,<span class="st">"grey80"</span>,<span class="st">"darkorchid3"</span><span class="op">)</span>, oob <span class="op">=</span> <span class="va">squish_infinite</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">13</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="co">#here we picked top genes by fold change value. It is recommended to also check top genes by p value for consistency</span></code></pre></div>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EAE_heatmap_clusters</span>

<span class="co">#ggsave(plot = last_plot(), filename = "Bc_cluster_heatmap_top5_logFC.svg", dpi = 400, width = 10, height = 10)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-70-1.png" width="576"></p>
<p>The dottile function can be run directly from the gene selection that made by the heatmap function</p>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cldef</span> <span class="op">&lt;-</span> <span class="va">EAE_heatmap_clusters</span><span class="op">$</span><span class="va">data</span> <span class="co">#getting the source data table of the heatmap from above</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cldef</span><span class="op">$</span><span class="va">Feature</span><span class="op">)</span><span class="op">)</span> <span class="co">#how many genes were selected</span></code></pre></div>
<pre><code>## [1] 35</code></pre>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cldef</span><span class="op">$</span><span class="va">Feature</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">58</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, genes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">genes_to_plot</span><span class="op">)</span>, group.by <span class="op">=</span> <span class="st">"seurat_clusters"</span>, threshold.to.plot <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"% positive"</span>, color <span class="op">=</span> <span class="st">"Expression"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">29</span>, angle <span class="op">=</span> <span class="fl">0</span>, hjust <span class="op">=</span> <span class="fl">0.5</span>,vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">lines</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>reverse<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#For vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 40 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = plot_out, filename = "Bc_cluster_dottile_top5_logFC.svg", dpi = 400, width = 10, height = 22)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-71-1.png" width="576"></p>
<p>And some more DEG analysis between clusters: We notice a difference between the two sides of the UMAP. Here we look at this specifically</p>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">umap_side</span> <span class="op">&lt;-</span> <span class="st">"none"</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">umap_side</span><span class="op">[</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">seurat_clusters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"left"</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">umap_side</span><span class="op">[</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">seurat_clusters</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"right"</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">umap_side</span><span class="op">)</span><span class="co">#Check cell nr.</span>
<span class="co">#Get DEGs</span>
<span class="va">exp_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, grouping.column <span class="op">=</span> <span class="st">"umap_side"</span>, group1 <span class="op">=</span> <span class="st">"right"</span>, group2 <span class="op">=</span> <span class="st">"left"</span>, return.plot <span class="op">=</span> <span class="st">"volcano"</span>, logFC <span class="op">=</span> <span class="cn">F</span>, label.n.top.genes <span class="op">=</span> <span class="fl">20</span>, genes.to.label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD24A"</span>, <span class="st">"BACH2"</span>, <span class="st">"EBF1"</span>, <span class="st">"CD83"</span>, <span class="st">"PTPRC"</span>, <span class="st">"CD38"</span>, <span class="st">"ARHGAP15"</span>, <span class="st">"MALAT1"</span>, <span class="st">"DOCK2"</span>, <span class="st">"FOXP1"</span>, <span class="st">"LNCPINT"</span>, <span class="st">"TGFB1"</span><span class="op">)</span><span class="op">)</span>

<span class="co">#plot volcano</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(adj p)"</span>,title <span class="op">=</span> <span class="st">"UMAP lobe right vs. left"</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey30"</span>, mid <span class="op">=</span> <span class="st">"grey30"</span>, high <span class="op">=</span> <span class="st">"grey60"</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Bcs1_volc_umap_rightvleft.svg", dpi = 400, width = 9.5, height = 6.5)</span></code></pre></div>
</div>
<div id="b-cell-gex-by-group" class="section level2">
<h2 class="hasAnchor">
<a href="#b-cell-gex-by-group" class="anchor" aria-hidden="true"></a>B cell GEX by group</h2>
<p>A key goal of this study is the comparison between B cells in EAE initiated by two different autoantigens: rMOG and MOG35-55 Here we compare B cells from the two conditions.</p>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#first a membership barplot to check if B cells from either immunizations cluster differently</span>
<span class="va">cl_members</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_proportions_barplot.html">GEX_proportions_barplot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,source.group <span class="op">=</span> <span class="st">"group_id"</span>, target.group <span class="op">=</span> <span class="st">"seurat_clusters"</span>, stacked.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">groups_color</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG"</span>,<span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">33</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">33</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"% of cells of cluster"</span>, fill <span class="op">=</span> <span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ordering based on existing source group factor levels"
##  [1] rMOG     rMOG     rMOG     rMOG     rMOG     rMOG     rMOG     MOG35-55
##  [9] MOG35-55 MOG35-55 MOG35-55 MOG35-55 MOG35-55 MOG35-55
## Levels: rMOG &lt; MOG35-55
## [1] "Ordering based on existing target group factor levels"
## [1] "Returning stacked barplot with y axis = % of cells of target group"</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_members</span> 

<span class="co">#ggsave(last_plot(), filename = "Bc_cluster_membership_group.svg", dpi = 400, width = 10, height = 8)</span>

<span class="co">#Get DEGs </span>
<span class="va">exp_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, grouping.column <span class="op">=</span> <span class="st">"group_id"</span>, group1 <span class="op">=</span> <span class="st">"rMOG"</span>, group2 <span class="op">=</span> <span class="st">"MOG35-55"</span>, return.plot <span class="op">=</span> <span class="st">"none"</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="co">#here we separate the function call from the ggplot for more flexibility. output[[1]] of the GEX_DEgenes is a dataframe with DEGs</span>

<span class="co">#remove the max fold change gene. Most likely an artifact</span>
<span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"GM30211"</span>,<span class="op">]</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(adj p)"</span>,title <span class="op">=</span> <span class="st">"rMOG vs. MOG33-55"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">7</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Bc_volc_bygroup.svg", dpi = 400, width = 13, height = 11)</span>

<span class="co">#DEGs after p correction</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">p_val_adj</span><span class="op">[</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">p_val_adj</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 25</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-73-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-73-2.png" width="576"></p>
<p>Running Gene ontology analysis This outputs plots as PDFs, which are not displayed in this vignette</p>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ontology_EAE &lt;- GEX_GOterm(GEX.cluster.genes.output = list(exp_DEGs[[1]]), topNgenes = 40, go.plots = T)</span></code></pre></div>
<p>For completeness we also plot a dotmap of selected genes across groups</p>
<div class="sourceCode" id="cb281"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD19"</span>, <span class="st">"CD74"</span>,<span class="st">"SDC1"</span>, <span class="st">"EBF1"</span>,<span class="st">"PTPRC"</span>,<span class="st">"CD38"</span>,<span class="st">"CD24A"</span>,<span class="st">"CD1D1"</span>,<span class="st">"CD5"</span>,<span class="st">"MS4A1"</span>,<span class="st">"CXCR5"</span>,<span class="st">"SELL"</span>,<span class="st">"CD40"</span>,<span class="st">"CD83"</span>,<span class="st">"H2-AB1"</span>,<span class="st">"H2-EB1"</span>,<span class="st">"CD27"</span>,<span class="st">"POU2AF1"</span>,<span class="st">"NT5E"</span>,<span class="st">"FASL"</span>,<span class="st">"PDCD1LG2"</span>,<span class="st">"PRDM1"</span>,<span class="st">"ITGAM"</span>,<span class="st">"TGFB1"</span>,<span class="st">"ZCWPW1"</span><span class="op">)</span>

<span class="va">linesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">genes_to_plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, genes <span class="op">=</span> <span class="va">genes_to_plot</span>, group.by <span class="op">=</span> <span class="st">"group_id"</span>, threshold.to.plot <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"% positive"</span>, color <span class="op">=</span> <span class="st">"Expression"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">29</span>, angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>,vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.title.x.bottom <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">12</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">linesh</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb284"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#For vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 14 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb286"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = plot_out, filename = "Bc_dottile_group.svg", dpi = 400, width = 5.5, height = 7)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-75-1.png" width="576"></p>
</div>
<div id="b-cells-integration-with-aged-cns-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#b-cells-integration-with-aged-cns-dataset" class="anchor" aria-hidden="true"></a>B cells integration with aged CNS dataset</h2>
<p>As part of an earlier study, our group examined phenotypes of B cells in the CNS of aged mice. They found increased numbers of lymphocytes and increased clonal expansion, especially of CD8+ B cells in aged vs. young animals.</p>
<p>(Yermanos, A. et al. Single-cell immune repertoire and transcriptome sequencing reveals that clonally expanded and transcriptionally distinct lymphocytes populate the aged central nervous system in mice. Proc. R. Soc. B Biol. Sci. 288, (2021).)</p>
<p>We wondered how different cells of EAE and aged CNS are transcriptionally.</p>
<p>Running a new VGM to integrate these datasets.</p>
<div class="sourceCode" id="cb287"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VDJ.out.directory.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S1"</span><span class="op">)</span> <span class="co">#rMOG </span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S1"</span><span class="op">)</span> <span class="co">#rMOG</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S1"</span><span class="op">)</span> <span class="co">#MOG35-55</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S5"</span><span class="op">)</span> <span class="co"># 3 Months pool</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S6"</span><span class="op">)</span> <span class="co"># 12 months pool</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S7"</span><span class="op">)</span> <span class="co"># 18 months pool</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S8"</span><span class="op">)</span> <span class="co"># 18 months alone</span></code></pre></div>
<p>Run VGM</p>
<div class="sourceCode" id="cb288"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#vgm_EAEaged &lt;- VDJ_GEX_matrix(VDJ.out.directory.list = VDJ.out.directory.list,  </span>
<span class="co">#                              GEX.out.directory.list = GEX.out.directory.list,</span>
<span class="co">#                             exclude.on.cell.state.markers = c("CD3G+", "CD3E+", "CD4+", "CD8A+","CD8B1+","C1QA+","C1QB+","RORA+","NKG7+"), </span>
<span class="co">#                             group.id = c("EAE", "EAE", "EAE", "aged CNS", "aged CNS", "aged CNS", "aged CNS")) </span>

<span class="co">#saveRDS(vgm_EAEaged,"EAE_vgm_EAEaged_Bcs.rds")</span>


<span class="va">sample_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s1"</span>,<span class="st">"s2"</span>,<span class="st">"s3"</span>,<span class="st">"s4"</span>,<span class="st">"s5"</span>,<span class="st">"s6"</span>, <span class="st">"s7"</span><span class="op">)</span>
<span class="va">short_replace_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG_1"</span>, <span class="st">"rMOG_2"</span>,<span class="st">"MOG35-55"</span>, <span class="st">"3m"</span>, <span class="st">"12m"</span>, <span class="st">"18m"</span>, <span class="st">"18m single"</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">short_replace_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">short_replace_ids</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] rMOG_1     rMOG_2     MOG35-55   3m         12m        18m        18m single
## Levels: rMOG_1 rMOG_2 MOG35-55 3m 12m 18m 18m single</code></pre>
<div class="sourceCode" id="cb290"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">samples_color_aged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">samples_color</span>,<span class="st">"#71716F"</span>, <span class="st">"#577590"</span>, <span class="st">"#B2B7A4"</span>, <span class="st">"#D8DAD3"</span><span class="op">)</span>

<span class="va">short_replace_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">short_replace_ids</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">short_replace_ids</span><span class="op">)</span><span class="op">)</span>
<span class="va">test_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pal <span class="op">=</span> <span class="va">samples_color_aged</span>, nam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">short_replace_ids</span><span class="op">)</span> , val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">12</span><span class="op">)</span><span class="op">)</span>

<span class="co">#Color test ggplot</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">test_col</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nam</span>, y <span class="op">=</span> <span class="va">val</span>, fill<span class="op">=</span> <span class="va">nam</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color_aged</span><span class="op">)</span>

<span class="co">#Nr. cells per sample </span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##     rMOG_1     rMOG_2   MOG35-55         3m        12m        18m 18m single 
##        926        350        762        111        145        249        410</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-78-1.png" width="576"></p>
<p>Next: umap</p>
<div class="sourceCode" id="cb292"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"sample_id"</span>, cols <span class="op">=</span> <span class="va">samples_color_aged</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Sample"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">#ggsave(plot = last_plot(), filename = "Bcs_eaeaged_umap_sample.svg", dpi = 700, width = 6.5, height = 5)</span>

<span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"seurat_clusters"</span>, cols <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span><span class="op">)</span><span class="op">]</span>, shuffle <span class="op">=</span> <span class="cn">T</span>, label <span class="op">=</span><span class="cn">T</span>, label.size <span class="op">=</span> <span class="fl">7</span> <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Cluster"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">#ggsave(plot = last_plot(), filename = "Bcs_eaeaged_umap_cluster.svg", dpi = 700, width = 6.5, height = 5)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-79-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-79-2.png" width="576"></p>
<p>Next we look at cluster membership using a barplot</p>
<div class="sourceCode" id="cb293"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_members</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_proportions_barplot.html">GEX_proportions_barplot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,source.group <span class="op">=</span> <span class="st">"sample_id"</span>, target.group <span class="op">=</span> <span class="st">"seurat_clusters"</span>, stacked.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color_aged</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0.7</span>,r <span class="op">=</span> <span class="fl">2.5</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span>,panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">33</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">33</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>, legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">19</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"% of cells of cluster"</span>, fill <span class="op">=</span> <span class="st">"Sample"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ordering based on existing source group factor levels"
##  [1] rMOG_1     rMOG_1     rMOG_1     rMOG_1     rMOG_1     rMOG_1    
##  [7] rMOG_1     rMOG_1     rMOG_1     rMOG_1     rMOG_1     rMOG_2    
## [13] rMOG_2     rMOG_2     rMOG_2     rMOG_2     rMOG_2     rMOG_2    
## [19] rMOG_2     rMOG_2     rMOG_2     rMOG_2     MOG35-55   MOG35-55  
## [25] MOG35-55   MOG35-55   MOG35-55   MOG35-55   MOG35-55   MOG35-55  
## [31] MOG35-55   MOG35-55   MOG35-55   3m         3m         3m        
## [37] 3m         3m         3m         3m         3m         3m        
## [43] 3m         3m         12m        12m        12m        12m       
## [49] 12m        12m        12m        12m        12m        12m       
## [55] 12m        18m        18m        18m        18m        18m       
## [61] 18m        18m        18m        18m        18m        18m       
## [67] 18m single 18m single 18m single 18m single 18m single 18m single
## [73] 18m single 18m single 18m single 18m single 18m single
## Levels: rMOG_1 &lt; rMOG_2 &lt; MOG35-55 &lt; 3m &lt; 12m &lt; 18m &lt; 18m single
## [1] "Ordering based on existing target group factor levels"
## [1] "Returning stacked barplot with y axis = % of cells of target group"</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb296"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl_members</span> 

<span class="co">#ggsave(last_plot(), filename = "Bcs_eaeaged_Cluster_membership.svg", dpi = 400, width = 7.5, height = 5)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-80-1.png" width="576"></p>
<p>Viewing selected genes as a dotmap</p>
<div class="sourceCode" id="cb297"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genes_to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD19"</span>,<span class="st">"CD74"</span>,<span class="st">"SDC1"</span>, <span class="st">"EBF1"</span>,<span class="st">"PTPRC"</span>,<span class="st">"CD38"</span>,<span class="st">"CD24A"</span>,<span class="st">"CD1D1"</span>,<span class="st">"CD5"</span>,<span class="st">"MS4A1"</span>,<span class="st">"CXCR5"</span>,<span class="st">"SELL"</span>,<span class="st">"CD40"</span>,<span class="st">"CD83"</span>,<span class="st">"H2-AB1"</span>,<span class="st">"H2-EB1"</span>,<span class="st">"CD27"</span>,<span class="st">"POU2AF1"</span>,<span class="st">"NT5E"</span>,<span class="st">"FASL"</span>,<span class="st">"PDCD1LG2"</span>,<span class="st">"PRDM1"</span>,<span class="st">"ITGAM"</span>,<span class="st">"TGFB1"</span>,<span class="st">"ZCWPW1"</span><span class="op">)</span>

<span class="va">linesh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">genes_to_plot</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_dottile_plot.html">GEX_dottile_plot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, genes <span class="op">=</span> <span class="va">genes_to_plot</span>, group.by <span class="op">=</span> <span class="st">"sample_id"</span>, threshold.to.plot <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>size <span class="op">=</span> <span class="st">"% positive"</span>, color <span class="op">=</span> <span class="st">"Expression"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">29</span>, angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>,vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.title.x.bottom <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>,<span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_binned</a></span><span class="op">(</span>range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">12</span><span class="op">)</span>, n.breaks <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">linesh</span>, col <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"B"</span>, end <span class="op">=</span> <span class="fl">0.85</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'size' is already present. Adding another scale for 'size', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'colour' is already present. Adding another scale for 'colour',
## which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb300"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#For vignette</span>
<span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 53 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb302"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = plot_out, filename = "Bc_eaeaged_dottile.svg", dpi = 400, width = 8, height = 11)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-81-1.png" width="576"></p>
<p>Looking at differential expressed genes by condition.</p>
<div class="sourceCode" id="cb303"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span><span class="va">vgm_EAEaged</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, grouping.column <span class="op">=</span> <span class="st">"group_id"</span>, group1 <span class="op">=</span> <span class="st">"EAE"</span>, group2 <span class="op">=</span> <span class="st">"aged CNS"</span>, return.plot <span class="op">=</span> <span class="cn">T</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Please set return.plot to either 'volcano', 'heatmap' or 'none'"
## [1] "Setting return.plot to 'heatmap' for now"
##  [1] "H2-K1"   "VPS37B"  "APOE"    "GPR132"  "PDE3B"   "CD86"    "H2-EB1" 
##  [8] "PLAUR"   "CYTH1"   "LAPTM5"  "PCBP2"   "INPP5D"  "PDE4B"   "LY6A"   
## [15] "CREM"    "AFM"     "FAH"     "PRKCH"   "HDAC9"   "GUCY1B2" "GM11808"
## [22] "FGFR2"   "TLK1"    "PLCXD3"  "CTNND2"  "H3F3A"   "TMSB10"  "CD79B"  
## [29] "UCP2"    "CD24A"</code></pre>
<div class="sourceCode" id="cb305"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#plot volcano</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sample_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">4</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(adj p)"</span>,title <span class="op">=</span> <span class="st">"EAE vs. Aged CNS"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">sample_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">20</span> <span class="op">|</span> <span class="va">SYMBOL</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CD19"</span>, <span class="st">"EBF1"</span>, <span class="st">"CD40"</span>, <span class="st">"FASL"</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val_adj</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">7</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">40</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="va">samples_color_aged</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, midpoint <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">plot_out</span></code></pre></div>
<pre><code>## Warning: ggrepel: 123 unlabeled data points (too many overlaps). Consider
## increasing max.overlaps</code></pre>
<div class="sourceCode" id="cb307"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot_out, filename = "Bc_eaeaged_volc.svg", dpi = 400, width = 8, height = 9.2)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-82-1.png" width="576"></p>
</div>
<div id="b-cells-vdj" class="section level2">
<h2 class="hasAnchor">
<a href="#b-cells-vdj" class="anchor" aria-hidden="true"></a>B cells VDJ</h2>
<p>After having explored transcriptional phenotypes of B cells we now turn to their TCR repertoires. We first look at basic metrics of expansion by plotting clonal donuts With VGM counts</p>
<div class="sourceCode" id="cb308"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_clonal_donut.html">VDJ_clonal_donut</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, counts.to.use <span class="op">=</span> <span class="st">"VGM"</span>, expanded.colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#68228B"</span>,<span class="st">"#BF3EFF"</span>,<span class="st">"#E066FF"</span>,<span class="st">"#8968CD"</span><span class="op">)</span>, non.expanded.color <span class="op">=</span> <span class="st">"#000000"</span>, label.size <span class="op">=</span> <span class="fl">9</span>, total.label.vjust <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </code></pre></div>
<pre><code>## [1] "Using counts of entries in the VDJ GEX matrix"
## [1] "----------"
## [1] "Sample: rMOG_1"
## [1] "Clones: Expanded: 132 / 6.82%; 1 cell 1804 / 93.18%; total: 1936"
## [1] "Cells: Expanded: 758 / 29.59%; 1 cell 1804 / 70.41%; Total: 2562"
## [1] "----------"
## [1] "Sample: rMOG_2"
## [1] "Clones: Expanded: 47 / 9.22%; 1 cell 463 / 90.78%; total: 510"
## [1] "Cells: Expanded: 168 / 26.62%; 1 cell 463 / 73.38%; Total: 631"
## [1] "----------"
## [1] "Sample: MOG35-55"
## [1] "Clones: Expanded: 83 / 9.73%; 1 cell 770 / 90.27%; total: 853"
## [1] "Cells: Expanded: 240 / 23.76%; 1 cell 770 / 76.24%; Total: 1010"</code></pre>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#here we use counts of clones from the VGM (i.e. the nr. of rows/cells of every clone) This can also be set to "10x" to use counts from the clonotype_frequency column based on original Cellranger output. The two may diverge if a large number of overlapping barcodes were filtered out or if the clonotyping strategy was changed </span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">plots_out</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#saving in a loop</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plots_out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="co">#ggsave(plots_out[[i]], filename = paste0("Donut_VGMcounts",plots_out[[i]]$labels$title ,".png"), dpi = 400, width = 5, height = 5, bg = "transparent")</span>
<span class="op">}</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-83-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-83-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-83-3.png" width="576"></p>
<p>With 10x cellranger counts</p>
<div class="sourceCode" id="cb311"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plots_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_clonal_donut.html">VDJ_clonal_donut</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, counts.to.use <span class="op">=</span> <span class="st">"10x"</span>, expanded.colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#68228B"</span>,<span class="st">"#BF3EFF"</span>,<span class="st">"#E066FF"</span>,<span class="st">"#8968CD"</span><span class="op">)</span>, non.expanded.color <span class="op">=</span> <span class="st">"#000000"</span>, label.size <span class="op">=</span> <span class="fl">9</span>, total.label.vjust <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> </code></pre></div>
<pre><code>## [1] "Using counts provided by 10X in the clonotype_frequency column"
## [1] "----------"
## [1] "Sample: rMOG_1"
## [1] "Clones: Expanded: 149 / 7.7%; 1 cell 1787 / 92.3%; total: 1936"
## [1] "Cells: Expanded: 1116 / 38.44%; 1 cell 1787 / 61.56%; Total: 2903"
## [1] "----------"
## [1] "Sample: rMOG_2"
## [1] "Clones: Expanded: 86 / 16.86%; 1 cell 424 / 83.14%; total: 510"
## [1] "Cells: Expanded: 481 / 53.15%; 1 cell 424 / 46.85%; Total: 905"
## [1] "----------"
## [1] "Sample: MOG35-55"
## [1] "Clones: Expanded: 114 / 13.36%; 1 cell 739 / 86.64%; total: 853"
## [1] "Cells: Expanded: 455 / 38.11%; 1 cell 739 / 61.89%; Total: 1194"</code></pre>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">plots_out</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#saving in a loop</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plots_out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
  <span class="co">#ggsave(plots_out[[i]], filename = paste0("Donut_10xcounts",plots_out[[i]]$labels$title ,".png"), dpi = 400, width = 5, height = 5, bg = "transparent")</span>
<span class="op">}</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-84-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-84-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-84-3.png" width="576"></p>
<p>We continue by calculating common diversity metrics Here we use VDJ and VJ CDR3s seqs as a basis</p>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#NO SUBSAMPLING</span>
<span class="va">out_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#loop to compile results for each metric</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"richness"</span>,<span class="st">"bergerparker"</span>,<span class="st">"ginisimpson"</span>,<span class="st">"shannonevenness"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_diversity.html">VDJ_diversity</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_cdr3s_aa"</span>,<span class="st">"VJ_cdr3s_aa"</span><span class="op">)</span>,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, metric <span class="op">=</span> <span class="va">i</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, subsample.to.same.n <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">$</span><span class="va">data</span>
  <span class="va">out</span><span class="op">$</span><span class="va">metric_used</span> <span class="op">&lt;-</span> <span class="va">i</span>
  <span class="va">out_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">out</span>
<span class="op">}</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">out_list</span><span class="op">)</span> <span class="co">#generating a common dataframe</span>

<span class="co">#lets plot this</span>
<span class="va">out</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">index</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species richness"</span>, <span class="st">"Berger-Parker index"</span>, <span class="st">"Gini-Simpson index"</span>, <span class="st">"Shannon evenness"</span><span class="op">)</span><span class="op">)</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">out</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">groups</span>, y <span class="op">=</span> <span class="va">metric</span>, fill <span class="op">=</span> <span class="va">groups</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.6</span>,show.legend <span class="op">=</span> <span class="cn">F</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">index</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> 

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Bcs_rep_diversity_nosubsampling.svg", dpi = 600, width = 10, height = 8)</span>

<span class="co">#SUBSAMPLING</span>
<span class="va">out_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"richness"</span>,<span class="st">"bergerparker"</span>,<span class="st">"ginisimpson"</span>, <span class="st">"shannonevenness"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_diversity.html">VDJ_diversity</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_cdr3s_aa"</span>,<span class="st">"VJ_cdr3s_aa"</span><span class="op">)</span>,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>,metric <span class="op">=</span> <span class="va">i</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, subsample.to.same.n <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">data</span> <span class="co">#subsampling down to the smallest repertoire</span>
  <span class="va">out</span><span class="op">$</span><span class="va">metric_used</span> <span class="op">&lt;-</span> <span class="va">i</span>
  <span class="va">out_list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">out</span>
<span class="op">}</span></code></pre></div>
<pre><code>## [1] "Subsampled group rMOG_1 to 362 entries"
## [1] "Used group rMOG_2 as a reference for subsampling with 362 entries"
## [1] "To avoid subsampling set subsample.to.same.n = FALSE"
## [1] "Subsampled group MOG35-55 to 362 entries"
## [1] "Subsampled group rMOG_1 to 362 entries"
## [1] "Used group rMOG_2 as a reference for subsampling with 362 entries"
## [1] "To avoid subsampling set subsample.to.same.n = FALSE"
## [1] "Subsampled group MOG35-55 to 362 entries"
## [1] "Subsampled group rMOG_1 to 362 entries"
## [1] "Used group rMOG_2 as a reference for subsampling with 362 entries"
## [1] "To avoid subsampling set subsample.to.same.n = FALSE"
## [1] "Subsampled group MOG35-55 to 362 entries"
## [1] "Subsampled group rMOG_1 to 362 entries"
## [1] "Used group rMOG_2 as a reference for subsampling with 362 entries"
## [1] "To avoid subsampling set subsample.to.same.n = FALSE"
## [1] "Subsampled group MOG35-55 to 362 entries"</code></pre>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">out_list</span><span class="op">)</span>

<span class="co">#lets plot this too</span>
<span class="va">out</span><span class="op">$</span><span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">index</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species richness"</span>, <span class="st">"Berger-Parker index"</span>, <span class="st">"Gini-Simpson index"</span>, <span class="st">"Shannon evenness"</span><span class="op">)</span><span class="op">)</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">out</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">groups</span>, y <span class="op">=</span> <span class="va">metric</span>, fill <span class="op">=</span> <span class="va">groups</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.6</span>,show.legend <span class="op">=</span> <span class="cn">F</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, strip.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">index</span>, ncol <span class="op">=</span> <span class="fl">2</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> 

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Bcs_rep_diversity_subsampled.svg", dpi = 600, width = 8, height = 10)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-85-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-85-2.png" width="576"></p>
<p>V gene usage is an important indicator of repertoire similarity or dissimilarity. 1. stacked barplot</p>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "rMOG_1"   "rMOG_2"   "MOG35-55"</code></pre>
<div class="sourceCode" id="cb319"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">EAE_Vgene_usage_barplot_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_Vgene_usage_stacked_barplot.html">VDJ_Vgene_usage_stacked_barplot</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, HC.gene.number <span class="op">=</span> <span class="fl">12</span>, LC.Vgene <span class="op">=</span> <span class="cn">F</span>, LC.gene.number <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Sample order: rMOG_1 ; rMOG_2 ; MOG35-55"</code></pre>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggplot magic</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">EAE_Vgene_usage_barplot_b</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">28</span><span class="op">)</span>,legend.position <span class="op">=</span> <span class="st">"right"</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0.7</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span>, panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">stepped2</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"2"</span>,<span class="st">"3"</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG_1"</span>, <span class="st">"rMOG_2"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"relative usage"</span>, fill <span class="op">=</span> <span class="st">"VDJ Vgene"</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot = plot_out, filename = paste0("Bcs_VDJ_vgene_by_sample.svg"), dpi = 400, width = 8, height = 7)</span>

<span class="co">#VJ</span>
<span class="va">EAE_Vgene_usage_barplot_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_Vgene_usage_stacked_barplot.html">VDJ_Vgene_usage_stacked_barplot</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, HC.gene.number <span class="op">=</span> <span class="fl">12</span>, LC.Vgene <span class="op">=</span> <span class="cn">T</span>, LC.gene.number <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Sample order: rMOG_1 ; rMOG_2 ; MOG35-55"</code></pre>
<div class="sourceCode" id="cb323"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">EAE_Vgene_usage_barplot_b</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">28</span><span class="op">)</span>,legend.position <span class="op">=</span> <span class="st">"right"</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">0.7</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span>, panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,panel.border <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">stepped2</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>,<span class="st">"2"</span>, <span class="st">"3"</span><span class="op">)</span>,labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG_1"</span>, <span class="st">"rMOG_2"</span>, <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"relative usage"</span>, fill <span class="op">=</span> <span class="st">"VJ Vgene"</span><span class="op">)</span> 

<span class="va">plot_out</span>

<span class="co">#ggsave(plot = plot_out, filename = paste0("Bcs_VJ_vgene_by_sample.svg"), dpi = 400, width = 8, height = 7)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-86-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-86-2.png" width="576"></p>
<ol start="2" style="list-style-type: decimal">
<li>Using Circos plots These will generate PDF files, which are not contained within this vignette</li>
</ol>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Bcs_circos_rMOG_1.pdf"</span>, onefile <span class="op">=</span> <span class="cn">T</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="va">for_cir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="st">"rMOG_1"</span><span class="op">)</span><span class="op">)</span>
<span class="va">for_cir</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">for_cir</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="va">circos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_VJ_usage_circos.html">VDJ_VJ_usage_circos</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">for_cir</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, A.or.B <span class="op">=</span> <span class="st">"both"</span>, label.threshold <span class="op">=</span> <span class="fl">5</span>, cell.level <span class="op">=</span> <span class="cn">T</span>, clonotype.per.gene.threshold <span class="op">=</span> <span class="fl">10</span>, c.count <span class="op">=</span> <span class="cn">T</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, filter1H1L <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Reminder: VDJ_VJ_usage_circos() funcion built for new Platypus 3.0.0 is being used. The output VDJ dataframe of the VDJ_GEX_matrix function (VDJ_GEX_matrix[[1]]) required as input."
## [1] "Plotting for sample rMOG_1"</code></pre>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## agg_png 
##       2</code></pre>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Bcs_circos_rMOG_2.pdf"</span>, onefile <span class="op">=</span> <span class="cn">T</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="va">for_cir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="st">"rMOG_2"</span><span class="op">)</span><span class="op">)</span>
<span class="va">for_cir</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">for_cir</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="va">circos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_VJ_usage_circos.html">VDJ_VJ_usage_circos</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">for_cir</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, A.or.B <span class="op">=</span> <span class="st">"both"</span>, label.threshold <span class="op">=</span> <span class="fl">5</span>, cell.level <span class="op">=</span> <span class="cn">T</span>, clonotype.per.gene.threshold <span class="op">=</span> <span class="fl">10</span>, c.count <span class="op">=</span> <span class="cn">T</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, filter1H1L <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Reminder: VDJ_VJ_usage_circos() funcion built for new Platypus 3.0.0 is being used. The output VDJ dataframe of the VDJ_GEX_matrix function (VDJ_GEX_matrix[[1]]) required as input."
## [1] "Plotting for sample rMOG_2"</code></pre>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## agg_png 
##       2</code></pre>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Bcs_circos_MOG3555.pdf"</span>, onefile <span class="op">=</span> <span class="cn">T</span>, width <span class="op">=</span> <span class="fl">6</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
<span class="va">for_cir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="st">"MOG35-55"</span><span class="op">)</span><span class="op">)</span>
<span class="va">for_cir</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">for_cir</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="va">circos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_VJ_usage_circos.html">VDJ_VJ_usage_circos</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">for_cir</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, A.or.B <span class="op">=</span> <span class="st">"both"</span>, label.threshold <span class="op">=</span> <span class="fl">5</span>, cell.level <span class="op">=</span> <span class="cn">T</span>, clonotype.per.gene.threshold <span class="op">=</span> <span class="fl">10</span>, c.count <span class="op">=</span> <span class="cn">T</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, filter1H1L <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Reminder: VDJ_VJ_usage_circos() funcion built for new Platypus 3.0.0 is being used. The output VDJ dataframe of the VDJ_GEX_matrix function (VDJ_GEX_matrix[[1]]) required as input."
## [1] "Plotting for sample MOG35-55"</code></pre>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## agg_png 
##       2</code></pre>
<p>Public clones are of great interest here and so we assay them together with overlap of other repertoire elements</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#using the unfiltered (VDJ comb here. All cells, also those with less or more than 1VDJ 1VJ are included)</span>
<span class="va">VDJv_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_vgene"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, add.barcode.table <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_vgene</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 126</code></pre>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VJv_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VJ_vgene"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, add.barcode.table <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VJ_vgene</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 244</code></pre>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VJ_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VJ_cdr3s_aa"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VJ_cdr3s_aa</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 801</code></pre>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VDJ_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_cdr3s_aa"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cdr3s_aa</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2253</code></pre>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clone_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VJ_cdr3s_aa"</span>,<span class="st">"VDJ_cdr3s_aa"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pasted</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#make a table out of this for barplots (The numbers are from the length(unique())) prints above) </span>
<span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ vgene"</span>,<span class="st">"VJ vgene"</span>, <span class="st">"VDJ CDR3"</span>, <span class="st">"VJ CDR3"</span>, <span class="st">"VJ&amp;VDJ CDR3"</span><span class="op">)</span>, ov <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">29</span>,<span class="fl">73</span>,<span class="fl">19</span>,<span class="fl">45</span>,<span class="fl">4</span><span class="op">)</span>, total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">96</span>,<span class="fl">314</span>,<span class="fl">1546</span>,<span class="fl">1629</span>,<span class="fl">2094</span><span class="op">)</span><span class="op">)</span>
<span class="va">to_plot</span><span class="op">$</span><span class="va">fraction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="op">(</span><span class="va">to_plot</span><span class="op">$</span><span class="va">ov</span> <span class="op">/</span> <span class="va">to_plot</span><span class="op">$</span><span class="va">total</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>,<span class="st">"%"</span><span class="op">)</span>

<span class="va">to_plot</span><span class="op">$</span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">to_plot</span><span class="op">$</span><span class="va">var</span><span class="op">)</span>,levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ vgene"</span>,<span class="st">"VJ vgene"</span>, <span class="st">"VDJ CDR3"</span>,<span class="st">"VJ CDR3"</span>, <span class="st">"VJ&amp;VDJ CDR3"</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">to_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">var</span>, y <span class="op">=</span> <span class="va">ov</span>, fill <span class="op">=</span> <span class="va">ov</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">30</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span>, size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">27</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,  axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>,<span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">28</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span>, plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>l <span class="op">=</span> <span class="fl">0.5</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Repertoire overlap"</span>, x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"shared elements"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">fraction</span> , vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">83</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey80"</span>, high <span class="op">=</span> <span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">stepped2</a></span><span class="op">(</span><span class="fl">15</span><span class="op">)</span><span class="op">[</span><span class="fl">13</span><span class="op">]</span>, oob <span class="op">=</span> <span class="va">squish_infinite</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = "Bcs_rep_overlap_new.svg", dpi = 400, width = 8, height = 10)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-88-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-88-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-88-3.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-88-4.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-88-5.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-88-6.png" width="576"></p>
<p>To get the table of overlapping clones</p>
<div class="sourceCode" id="cb347"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">clone_overlap</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##                       overlapping_items             VJ_cdr3s_aa  VDJ_cdr3s_aa
## 1             CQHSWEIPWTF/CVRPYYYEAMDYW             CQHSWEIPWTF CVRPYYYEAMDYW
## 2 CQHSWEIPWTF;CQQYSSYPLTF/CVRPYYYEAMDYW CQHSWEIPWTF;CQQYSSYPLTF CVRPYYYEAMDYW
## 3             CQHSWEIPWTF/CVRPYYYEAMDYW             CQHSWEIPWTF CVRPYYYEAMDYW
## 4             CLQHGESPYTF/CMRYSNYWYFDVW             CLQHGESPYTF CMRYSNYWYFDVW
## 5             CLQHGESPYTF/CMRYGNYWYFDVW             CLQHGESPYTF CMRYGNYWYFDVW
## 6             CQHSWEIPWTF/CVRPYYYEAMDYW             CQHSWEIPWTF CVRPYYYEAMDYW
##   Freq in rMOG_1
## 1              5
## 2             10
## 3              5
## 4              2
## 5              1
## 6              5
##                                                                                                                                                                                                               Barcodes rMOG_1
## 1                                                                                                               s1_AAGACCTTCCAGTAGT-1;s1_ACTGATGCATAGTAAG-1;s1_AGTGGGAAGGCATTGG-1;s1_TCGCGAGAGCTAGTCT-1;s1_TCGTACCGTTCTGAAC-1
## 2 s1_AAGTCTGCAATGGACG-1;s1_AGCCTAATCAAGGCTT-1;s1_AGGGTGAGTGAGGGAG-1;s1_CAGATCAGTCCGAATT-1;s1_CTTCTCTAGCAGGCTA-1;s1_GAATAAGTCGTACCGG-1;s1_GTAACTGTCAGGTAAA-1;s1_GTCACGGCATGTTGAC-1;s1_TAAGAGACATGCCACG-1;s1_TAGGCATGTCATATCG-1
## 3                                                                                                               s1_AAGACCTTCCAGTAGT-1;s1_ACTGATGCATAGTAAG-1;s1_AGTGGGAAGGCATTGG-1;s1_TCGCGAGAGCTAGTCT-1;s1_TCGTACCGTTCTGAAC-1
## 4                                                                                                                                                                                 s1_AGGTCATAGTCCGGTC-1;s1_GAACCTATCCTTGACC-1
## 5                                                                                                                                                                                                       s1_GCGGGTTTCTGACCTC-1
## 6                                                                                                               s1_AAGACCTTCCAGTAGT-1;s1_ACTGATGCATAGTAAG-1;s1_AGTGGGAAGGCATTGG-1;s1_TCGCGAGAGCTAGTCT-1;s1_TCGTACCGTTCTGAAC-1
##   Freq in rMOG_2
## 1              3
## 2              1
## 3              3
## 4              0
## 5              0
## 6              3
##                                                     Barcodes rMOG_2
## 1 s2_GTGCGGTGTACGCACC-1;s2_TACTCGCAGCTACCTA-1;s2_TCAGGTAAGGGCATGT-1
## 2                                             s2_GACTGCGCAGGGAGAG-1
## 3 s2_GTGCGGTGTACGCACC-1;s2_TACTCGCAGCTACCTA-1;s2_TCAGGTAAGGGCATGT-1
## 4                                                                  
## 5                                                                  
## 6 s2_GTGCGGTGTACGCACC-1;s2_TACTCGCAGCTACCTA-1;s2_TCAGGTAAGGGCATGT-1
##   Freq in MOG35-55
## 1                1
## 2                0
## 3                1
## 4                3
## 5                2
## 6                1
##                                                   Barcodes MOG35-55
## 1                                             s3_GCGCCAATCAATCTCT-1
## 2                                                                  
## 3                                             s3_GCGCCAATCAATCTCT-1
## 4 s3_GCAGTTATCGTAGGAG-1;s3_TACCTTAAGCATCATC-1;s3_TTCTCCTCACATGTGT-1
## 5                       s3_CAGCGACCATTCTTAC-1;s3_GGAACTTGTGTAACGG-1
## 6                                             s3_GCGCCAATCAATCTCT-1</code></pre>
<p>Here we also use 3 other datasets that were recently aquired in our group. The aged CNS dataset, which has been used extensively above and paired BCR/GEX seq of cells from young and aged murine spleen and bone marrow (BM) We import, run the VGM and check for overlapping clones</p>
<div class="sourceCode" id="cb349"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VDJ.out.directory.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S1"</span><span class="op">)</span> <span class="co">#rMOG </span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S1"</span><span class="op">)</span> <span class="co">#rMOG</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/EAE/bcell/S1"</span><span class="op">)</span> <span class="co">#MOG35-55</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_organs/vdj/S11"</span><span class="op">)</span> <span class="co">#S11 - old BM vdj</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_organs/vdj/S14"</span><span class="op">)</span> <span class="co">#S14 - old spleen vdj</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">6</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_organs/vdj/S12"</span><span class="op">)</span> <span class="co">#S12 - young BM vdj</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_organs/vdj/S13"</span><span class="op">)</span> <span class="co">#S13 - young spleen vdj</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">8</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S5"</span><span class="op">)</span> <span class="co"># 3 Months pool</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">9</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S6"</span><span class="op">)</span> <span class="co"># 12 months pool</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S7"</span><span class="op">)</span> <span class="co"># 18 months pool</span>
<span class="va">VDJ.out.directory.list</span><span class="op">[[</span><span class="fl">11</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"~/Aged_CNS/vdj/S8"</span><span class="op">)</span> <span class="co"># 18 months alone</span></code></pre></div>
<p>Run VGM with only VDJ loading</p>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#vgm_int &lt;- VDJ_GEX_matrix(VDJ.out.directory.list = VDJ.out.directory.list, VDJ.combine = T, filter.overlapping.barcodes.VDJ = T, get.VDJ.stats = T, parallel.processing = "parlapply", trim.and.align = F, group.id = c("EAE","EAE","EAE","Aged organs","Aged organs","Aged organs","Aged organs","Aged CNS","Aged CNS","Aged CNS","Aged CNS"))</span>

<span class="co">#saveRDS(vgm_int, "EAE_vgm_int.rds")</span>
<span class="va">vgm_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"C:/Dokumente usw/Master/Reddy Lab/1_thesis/3_code/4_DB project/EAE website vignette/EAE_vgm_int.rds"</span><span class="op">)</span>

<span class="va">vgm_int</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_int</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span>, <span class="st">"s"</span><span class="op">)</span> <span class="co">#for easier Gsubs</span>
<span class="co">#add complete sample names</span>
<span class="va">sample_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"s"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span>, <span class="st">"s"</span><span class="op">)</span> 
<span class="va">short_replace_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG_1"</span>, <span class="st">"rMOG_2"</span> , <span class="st">"MOG35-55"</span>, <span class="st">"Aged BM"</span>, <span class="st">"Aged spleen"</span>, <span class="st">"Young BM"</span>, <span class="st">"Young spleen"</span>, <span class="st">"3m CNS"</span>, <span class="st">"12m CNS"</span>, <span class="st">"18m CNS"</span>, <span class="st">"18m single CNS"</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="va">vgm_int</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="va">sample_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">short_replace_ids</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">vgm_int</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">}</span>
<span class="va">vgm_int</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_int</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>, levels <span class="op">=</span> <span class="va">short_replace_ids</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">vgm_int</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##         rMOG_1         rMOG_2       MOG35-55        Aged BM    Aged spleen 
##           1964            523            931           2122           3918 
##       Young BM   Young spleen         3m CNS        12m CNS        18m CNS 
##            405           4084             75            157            203 
## 18m single CNS 
##            490</code></pre>
<p>Find overlapping clones</p>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clone_overlap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_overlap_heatmap.html">VDJ_overlap_heatmap</a></span><span class="op">(</span><span class="va">vgm_int</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,feature.columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VJ_cdr3s_aa"</span>,<span class="st">"VDJ_cdr3s_aa"</span><span class="op">)</span> ,grouping.column <span class="op">=</span> <span class="st">"sample_id"</span>, axis.label.size <span class="op">=</span> <span class="fl">20</span>, pvalues.label.size <span class="op">=</span> <span class="fl">12</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, plot.type <span class="op">=</span> <span class="st">"pheatmap"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_int</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">pasted</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb354"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clone_overlap</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> 

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">clone_overlap</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="co">#table of overlapping elements</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-93-1.png" width="576"></p>
<p>To visualize clone similarity across repertoires we display a similarity graph depicting clonal relationships based on the edit distance of CDR3s.</p>
<div class="sourceCode" id="cb356"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#get unique clones to avoid cluttering </span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span>, <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_id_10x</span><span class="op">)</span>
<span class="va">vgm_b_unique_clones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_clone</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span>, <span class="va">clonotype_frequency</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="co">#filtering: only one cell of each clone with a freq &gt; 10</span>
<span class="va">vgm_b_unique_clones</span><span class="op">$</span><span class="va">group_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">vgm_b_unique_clones</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>
<span class="va">vgm_b_unique_clones</span><span class="op">$</span><span class="va">group_id</span><span class="op">[</span><span class="va">vgm_b_unique_clones</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">==</span> <span class="st">"rMOG_1"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co">#renewing the group id with the respective sample colors</span>
<span class="va">vgm_b_unique_clones</span><span class="op">$</span><span class="va">group_id</span><span class="op">[</span><span class="va">vgm_b_unique_clones</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">==</span> <span class="st">"rMOG_2"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="va">vgm_b_unique_clones</span><span class="op">$</span><span class="va">group_id</span><span class="op">[</span><span class="va">vgm_b_unique_clones</span><span class="op">$</span><span class="va">sample_id</span> <span class="op">==</span> <span class="st">"MOG35-55"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>

<span class="co">#make a loop to plot for each sample a range of distance cutoff values</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html" class="external-link">pdf</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"Bcs_VDJ_network_filtered.pdf"</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">3</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span><span class="op">{</span> <span class="co">#generates a plot with different edit distance cutoffs to explore how the network behaves </span>
  <span class="va">netwo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_network.html">VDJ_network</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_b_unique_clones</span>,distance.cutoff <span class="op">=</span> <span class="va">j</span>,per.sample <span class="op">=</span> <span class="cn">F</span>,platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span>
  <span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/plot.igraph.html" class="external-link">plot.igraph</a></span><span class="op">(</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,vertex.label<span class="op">=</span><span class="cn">NA</span>,vertex.size<span class="op">=</span><span class="fl">5</span><span class="op">+</span><span class="op">(</span><span class="fl">.03</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span><span class="op">)</span><span class="op">)</span>,vertex.color<span class="op">=</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## agg_png 
##       2</code></pre>
<div class="sourceCode" id="cb358"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#for the purpose of this document, we view the plot at j = 10</span>
<span class="va">netwo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_network.html">VDJ_network</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_b_unique_clones</span>,distance.cutoff <span class="op">=</span> <span class="fl">10</span>,per.sample <span class="op">=</span> <span class="cn">F</span>,platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span>
<span class="fu">igraph</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/plot.igraph.html" class="external-link">plot.igraph</a></span><span class="op">(</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">4</span><span class="op">]</span><span class="op">]</span>,vertex.label<span class="op">=</span><span class="cn">NA</span>,vertex.size<span class="op">=</span><span class="fl">5</span><span class="op">+</span><span class="op">(</span><span class="fl">.03</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span><span class="op">)</span><span class="op">)</span>,vertex.color<span class="op">=</span><span class="va">netwo</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-94-1.png" width="576"></p>
</div>
<div id="b-cell-isotypes" class="section level2">
<h2 class="hasAnchor">
<a href="#b-cell-isotypes" class="anchor" aria-hidden="true"></a>B cell Isotypes</h2>
<p>Isotypes are an important metric of any B cell repertoire First we examine clonal expansion</p>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clonal_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_clonal_expansion.html">VDJ_clonal_expansion</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,celltype <span class="op">=</span> <span class="st">"Bcells"</span>,clones <span class="op">=</span> <span class="fl">30</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, group.by <span class="op">=</span> <span class="st">"sample_id"</span>, color.by <span class="op">=</span> <span class="st">"isotype"</span>, subtypes <span class="op">=</span> <span class="cn">F</span>, treat.incomplete.clones <span class="op">=</span> <span class="st">"exclude"</span>, treat.incomplete.cells <span class="op">=</span> <span class="st">"proportional"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "For sample rMOG_1 removing 802 clones of which no cell contains a VDJ chain which is 41.43 % of all clones"
## [1] "For sample rMOG_2 removing 143 clones of which no cell contains a VDJ chain which is 28.04 % of all clones"
## [1] "For sample MOG35-55 removing 97 clones of which no cell contains a VDJ chain which is 11.36 % of all clones"</code></pre>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">isotypes_color</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,<span class="st">"darkorchid3"</span> ,<span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,<span class="st">"chartreuse3"</span>,<span class="st">"black"</span>,<span class="st">"grey60"</span><span class="op">)</span>

<span class="co">#rMOG_1</span>
<span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.9</span><span class="op">)</span>,legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">isotypes_color</span>, <span class="st">"grey60"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Isotype"</span>, y <span class="op">=</span> <span class="st">"n cells"</span><span class="op">)</span><span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">2</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span> <span class="co">#adding a horizonal line at freq = 2</span></code></pre></div>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb364"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="co">#ggsave(plot = clonal_out[[1]][[1]], filename = paste0("Bcs1_expansion_by_isotype_rMOG_1.svg"), dpi = 400, width = 10, height = 8)</span>

<span class="co">#rMOG_2</span>
<span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.9</span><span class="op">)</span>,legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">isotypes_color</span>, <span class="st">"grey60"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Isotype"</span>, y <span class="op">=</span> <span class="st">"n cells"</span><span class="op">)</span><span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">30</span>,<span class="fl">40</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">2</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span> <span class="co">#adding a horizonal line at freq = 2</span></code></pre></div>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.
## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb366"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>

<span class="co">#ggsave(plot = clonal_out[[1]][[2]], filename = paste0("Bcs1_expansion_by_isotype_rMOG_1.svg"), dpi = 400, width = 10, height = 8)</span>

<span class="co">#MOG35-55</span>
<span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span>,legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">isotypes_color</span>, <span class="st">"grey60"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Isotype"</span>, y <span class="op">=</span> <span class="st">"n cells"</span><span class="op">)</span><span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">15</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">3</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">2</span>, size <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"grey60"</span><span class="op">)</span></code></pre></div>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.
## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb368"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>

<span class="co">#ggsave(plot = clonal_out[[1]][[3]], filename = paste0("Bcs1_expansion_by_isotype_MOG35-55.svg"), dpi = 400, width = 10, height = 8)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-95-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-95-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-95-3.png" width="576"></p>
<p>Comparing isotype usage between samples</p>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#we format a column so to make the annotation more consistent</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cgene</span>, <span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span> <span class="co">#First 4 letters of the c gene</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cgene</span>, <span class="st">";"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Multiple VDJ chains"</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span><span class="op">[</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cgene</span> <span class="op">==</span> <span class="st">""</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Unknown"</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cgene</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Unknown"</span>

<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IGHA"</span>, <span class="st">"IGHG"</span>, <span class="st">"IGHD"</span>, <span class="st">"IGHM"</span>, <span class="st">"IGHE"</span>, <span class="st">"Multiple VDJ chains"</span>, <span class="st">"Unknown"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span><span class="op">)</span>     </code></pre></div>
<pre><code>## [1] IGHM                Unknown             IGHD               
## [4] Multiple VDJ chains IGHG                IGHA               
## [7] IGHE               
## Levels: IGHA IGHG IGHD IGHM IGHE Multiple VDJ chains Unknown</code></pre>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_proportions_barplot.html">GEX_proportions_barplot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, source.group <span class="op">=</span> <span class="st">"isotype"</span>, target.group <span class="op">=</span> <span class="st">"seurat_clusters"</span>, stacked.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ordering based on existing source group factor levels"
##  [1] IGHM                IGHM                IGHM               
##  [4] IGHM                IGHM                IGHM               
##  [7] IGHM                Unknown             Unknown            
## [10] Unknown             Unknown             Unknown            
## [13] Unknown             Unknown             IGHD               
## [16] IGHD                IGHD                IGHD               
## [19] IGHD                IGHD                IGHD               
## [22] Multiple VDJ chains Multiple VDJ chains Multiple VDJ chains
## [25] Multiple VDJ chains Multiple VDJ chains Multiple VDJ chains
## [28] Multiple VDJ chains IGHG                IGHG               
## [31] IGHG                IGHG                IGHG               
## [34] IGHG                IGHG                IGHA               
## [37] IGHA                IGHA                IGHA               
## [40] IGHA                IGHA                IGHA               
## [43] IGHE                IGHE                IGHE               
## [46] IGHE                IGHE                IGHE               
## [49] IGHE               
## 7 Levels: IGHA &lt; IGHG &lt; IGHD &lt; IGHM &lt; IGHE &lt; ... &lt; Unknown
## [1] "Ordering based on existing target group factor levels"
## [1] "Returning stacked barplot with y axis = % of cells of target group"</code></pre>
<div class="sourceCode" id="cb373"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">&lt;-</span>  <span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,<span class="st">"darkorchid3"</span> ,<span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,<span class="st">"chartreuse3"</span>,<span class="st">"black"</span>,<span class="st">"grey60"</span>,<span class="st">"grey80"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">33</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">33</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"% of clonal level"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span>, fill <span class="op">=</span> <span class="st">"Clonal level"</span><span class="op">)</span>

<span class="va">plot_out</span>
  
<span class="co">#ggsave(plot = plot_out, filename = paste0("Bcs_prop_isotype.svg"), dpi = 700, width = 8, height = 6) </span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>
<span class="co">#ggsave(plot = plot_out, filename = paste0("Bcs_prop_isotype_noleg.svg"), dpi = 700, width = 8, height = 6) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-96-1.png" width="576"></p>
<p>we will return to isotypes upon VDJ GEX integration</p>
</div>
<div id="b-cells-shm" class="section level2">
<h2 class="hasAnchor">
<a href="#b-cells-shm" class="anchor" aria-hidden="true"></a>B cells SHM</h2>
<p>To quantify somatic hypermutations we use MIXCR and align BCR sequences to then recover the count of inserts, deletions and mismatches. Using MIXCR requires that the user has downloaded the software and can locate the correct directory.</p>
<p>A column containing SHM information for VDJ and VJ chain has now been added, which can be used directly for plotting</p>
<div class="sourceCode" id="cb374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "barcode"                 "sample_id"              
##  [3] "group_id"                "clonotype_id_10x"       
##  [5] "celltype"                "Nr_of_VDJ_chains"       
##  [7] "Nr_of_VJ_chains"         "VDJ_cdr3s_aa"           
##  [9] "VJ_cdr3s_aa"             "VDJ_cdr3s_nt"           
## [11] "VJ_cdr3s_nt"             "VDJ_chain_contig"       
## [13] "VJ_chain_contig"         "VDJ_chain"              
## [15] "VJ_chain"                "VDJ_vgene"              
## [17] "VJ_vgene"                "VDJ_dgene"              
## [19] "VDJ_jgene"               "VJ_jgene"               
## [21] "VDJ_cgene"               "VJ_cgene"               
## [23] "VDJ_sequence_nt_raw"     "VJ_sequence_nt_raw"     
## [25] "VDJ_sequence_nt_trimmed" "VJ_sequence_nt_trimmed" 
## [27] "VDJ_sequence_aa"         "VJ_sequence_aa"         
## [29] "VDJ_trimmed_ref"         "VJ_trimmed_ref"         
## [31] "VDJ_raw_consensus_id"    "VJ_raw_consensus_id"    
## [33] "orig_barcode"            "clonotype_frequency"    
## [35] "specifity"               "affinity"               
## [37] "GEX_available"           "orig.ident"             
## [39] "orig_barcode_GEX"        "seurat_clusters"        
## [41] "PC_1"                    "PC_2"                   
## [43] "UMAP_1"                  "UMAP_2"                 
## [45] "tSNE_1"                  "tSNE_2"                 
## [47] "batches"                 "clonotype_id"           
## [49] "sample_clone"            "VDJ_nSeqFR1"            
## [51] "VDJ_nSeqCDR1"            "VDJ_nSeqFR2"            
## [53] "VDJ_nSeqCDR2"            "VDJ_nSeqFR3"            
## [55] "VDJ_nSeqCDR3"            "VDJ_nSeqFR4"            
## [57] "VDJ_aaSeqFR1"            "VDJ_aaSeqCDR1"          
## [59] "VDJ_aaSeqFR2"            "VDJ_aaSeqCDR2"          
## [61] "VDJ_aaSeqFR3"            "VDJ_aaSeqCDR3"          
## [63] "VDJ_aaSeqFR4"            "VDJ_SHM"                
## [65] "VJ_nSeqFR1"              "VJ_nSeqCDR1"            
## [67] "VJ_nSeqFR2"              "VJ_nSeqCDR2"            
## [69] "VJ_nSeqFR3"              "VJ_nSeqCDR3"            
## [71] "VJ_nSeqFR4"              "VJ_aaSeqFR1"            
## [73] "VJ_aaSeqCDR1"            "VJ_aaSeqFR2"            
## [75] "VJ_aaSeqCDR2"            "VJ_aaSeqFR3"            
## [77] "VJ_aaSeqCDR3"            "VJ_aaSeqFR4"            
## [79] "VJ_SHM"</code></pre>
<p>Run the function, which returns multiple plots, then take view the by sample boxplots This will also return the results of signifcance analysis by anova and post hoc tukey HSD tests.</p>
<div class="sourceCode" id="cb376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SHM_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_plot_SHM.html">VDJ_plot_SHM</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
                     group.by <span class="op">=</span> <span class="st">"sample_id"</span>, 
                     quantile.label <span class="op">=</span> <span class="fl">0.995</span>,
                     point.size <span class="op">=</span> <span class="fl">2.7</span>,
                     platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "VDJ chain SHM data summary"
##      group count      mean       sd median IQR
## 1   rMOG_1  2454 0.3606357 1.418795      0   0
## 2   rMOG_2   605 0.4363636 1.444790      0   0
## 3 MOG35-55   950 0.4726316 1.606359      0   0
## 
##  kruskal.test()
##  Kruskal-Wallis rank sum test
## 
## data:  value by group
## Kruskal-Wallis chi-squared = 27.738, df = 2, p-value = 9.481e-07
## 
## 
##  pairwise.wilcox.test(p.adjust.method = 'BH')
##  Pairwise comparisons using Wilcoxon rank sum test with continuity correction 
## 
## data:  SHM_iso_VDJ$value and SHM_iso_VDJ$group 
## 
##          rMOG_1  rMOG_2
## rMOG_2   0.001   -     
## MOG35-55 3.8e-06 0.556 
## 
## P value adjustment method: BH 
## [1] "------------"
## [1] "VJ chain SHM data summary"
##      group count      mean       sd median IQR
## 1   rMOG_1  2454 0.9714751 2.665478      0   0
## 2   rMOG_2   605 0.6561983 2.123851      0   0
## 3 MOG35-55   950 0.2936842 1.341979      0   0
## 
##  kruskal.test()
##  Kruskal-Wallis rank sum test
## 
## data:  value by group
## Kruskal-Wallis chi-squared = 72.894, df = 2, p-value &lt; 2.2e-16
## 
## 
##  pairwise.wilcox.test(p.adjust.method = 'BH')
##  Pairwise comparisons using Wilcoxon rank sum test with continuity correction 
## 
## data:  SHM_iso_VJ$value and SHM_iso_VJ$group 
## 
##          rMOG_1  rMOG_2 
## rMOG_2   0.00149 -      
## MOG35-55 &lt; 2e-16 0.00025
## 
## P value adjustment method: BH 
## 
##  Please refer to output[[1]] to view boxplot showing group comparions tested here
##  Done</code></pre>
<div class="sourceCode" id="cb378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Boxplot</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">SHM_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span>, panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">50</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">samples_color</span><span class="op">)</span>
  
<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out,filename = "Bcs_SHM_box_sample.svg",dpi = 600, width = 8.5, height = 11) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-100-1.png" width="576"></p>
<p>Of course it is also interesting to view VGM by isotype</p>
<div class="sourceCode" id="cb379"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#adding formatted isotype column to VDJ</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cgene</span>, <span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span> <span class="co">#First 4 letters of the c gene</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cgene</span>, <span class="st">";"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Multiple VDJ chains"</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span><span class="op">[</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cgene</span> <span class="op">==</span> <span class="st">""</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Unknown"</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">isotype</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_cgene</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Unknown"</span>

<span class="va">SHM_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_plot_SHM.html">VDJ_plot_SHM</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
                     group.by <span class="op">=</span> <span class="st">"isotype"</span>, 
                     quantile.label <span class="op">=</span> <span class="fl">0.995</span>,
                     point.size <span class="op">=</span> <span class="fl">2.7</span>,
                     platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "VDJ chain SHM data summary"
##     group count       mean        sd median IQR
## 1    IGHA    20 3.15000000 4.0298230      1 4.5
## 2    IGHD   235 0.36595745 0.7694144      0 1.0
## 3    IGHE     3 1.00000000 0.0000000      1 0.0
## 4    IGHG   235 2.46382979 4.0183567      1 3.5
## 5    IGHM  1704 0.48474178 1.1924610      0 1.0
## 6 Unknown  1812 0.02262693 0.5688744      0 0.0
## 
##  kruskal.test()
##  Kruskal-Wallis rank sum test
## 
## data:  value by group
## Kruskal-Wallis chi-squared = 795.37, df = 5, p-value &lt; 2.2e-16
## 
## 
##  pairwise.wilcox.test(p.adjust.method = 'BH')
##  Pairwise comparisons using Wilcoxon rank sum test with continuity correction 
## 
## data:  SHM_iso_VDJ$value and SHM_iso_VDJ$group 
## 
##         IGHA    IGHD    IGHE    IGHG    IGHM   
## IGHD    5.5e-05 -       -       -       -      
## IGHE    0.925   0.014   -       -       -      
## IGHG    0.457   1.3e-13 0.827   -       -      
## IGHM    5.9e-05 0.457   0.022   &lt; 2e-16 -      
## Unknown &lt; 2e-16 &lt; 2e-16 &lt; 2e-16 &lt; 2e-16 &lt; 2e-16
## 
## P value adjustment method: BH 
## [1] "------------"
## [1] "VJ chain SHM data summary"
##     group count      mean        sd median IQR
## 1    IGHA    20 2.2500000 4.1151197    0.5 3.0
## 2    IGHD   235 0.1063830 0.6003575    0.0 0.0
## 3    IGHE     3 1.0000000 0.0000000    1.0 0.0
## 4    IGHG   235 1.0255319 2.5934227    0.0 0.5
## 5    IGHM  1704 0.1437793 0.7631309    0.0 0.0
## 6 Unknown  1812 1.3802428 3.1268959    0.0 1.0
## 
##  kruskal.test()
##  Kruskal-Wallis rank sum test
## 
## data:  value by group
## Kruskal-Wallis chi-squared = 387.35, df = 5, p-value &lt; 2.2e-16
## 
## 
##  pairwise.wilcox.test(p.adjust.method = 'BH')
##  Pairwise comparisons using Wilcoxon rank sum test with continuity correction 
## 
## data:  SHM_iso_VJ$value and SHM_iso_VJ$group 
## 
##         IGHA    IGHD    IGHE    IGHG    IGHM   
## IGHD    5.5e-10 -       -       -       -      
## IGHE    0.700   1.3e-08 -       -       -      
## IGHG    0.028   3.1e-08 0.037   -       -      
## IGHM    2.9e-10 0.236   2.4e-07 2.5e-14 -      
## Unknown 0.129   &lt; 2e-16 0.129   0.028   &lt; 2e-16
## 
## P value adjustment method: BH 
## 
##  Please refer to output[[1]] to view boxplot showing group comparions tested here
##  Done</code></pre>
<div class="sourceCode" id="cb381"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Boxplot</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">SHM_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span>, panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">50</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,<span class="st">"darkorchid3"</span> ,<span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,<span class="st">"chartreuse3"</span>,<span class="st">"black"</span>,<span class="st">"grey60"</span>,<span class="st">"grey80"</span><span class="op">)</span><span class="op">)</span>
  
<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out,filename = "Bcs_SHM_box_isotype.svg", dpi = 600, width = 8.5, height = 11) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-101-1.png" width="576"></p>
<p>Finally we also visualize SHM at the clonal level</p>
<div class="sourceCode" id="cb382"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Adding a dedicated column of sample + clonal level</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span> <span class="op">&lt;-</span> <span class="st">"1 cell"</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">[</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Expanded"</span>

<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span>, <span class="st">" "</span>, <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "rMOG_1 Expanded"   "rMOG_1 1 cell"     "rMOG_2 Expanded"  
## [4] "rMOG_2 1 cell"     "MOG35-55 Expanded" "MOG35-55 1 cell"</code></pre>
<div class="sourceCode" id="cb384"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rMOG_1 Expanded"</span>,<span class="st">"rMOG_2 Expanded"</span>, <span class="st">"MOG35-55 Expanded"</span>, <span class="st">"rMOG_1 1 cell"</span>, <span class="st">"rMOG_2 1 cell"</span>, <span class="st">"MOG35-55 1 cell"</span> <span class="op">)</span><span class="op">)</span>


<span class="va">SHM_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_plot_SHM.html">VDJ_plot_SHM</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
                     group.by <span class="op">=</span> <span class="st">"sample_expanded"</span>, 
                     quantile.label <span class="op">=</span> <span class="fl">0.995</span>,
                     point.size <span class="op">=</span> <span class="fl">2.7</span>,
                     platypus.version <span class="op">=</span> <span class="st">"v3"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "VDJ chain SHM data summary"
##               group count      mean        sd median  IQR
## 1   rMOG_1 Expanded   750 0.1440000 0.7857611      0 0.00
## 2   rMOG_2 Expanded   201 0.1890547 0.7239334      0 0.00
## 3 MOG35-55 Expanded   257 0.3073930 1.1903189      0 0.00
## 4     rMOG_1 1 cell  1704 0.4559859 1.6118868      0 0.00
## 5     rMOG_2 1 cell   404 0.5594059 1.6801086      0 0.25
## 6   MOG35-55 1 cell   693 0.5339105 1.7322398      0 0.00
## 
##  kruskal.test()
##  Kruskal-Wallis rank sum test
## 
## data:  value by group
## Kruskal-Wallis chi-squared = 125.61, df = 5, p-value &lt; 2.2e-16
## 
## 
##  pairwise.wilcox.test(p.adjust.method = 'BH')
##  Pairwise comparisons using Wilcoxon rank sum test with continuity correction 
## 
## data:  SHM_iso_VDJ$value and SHM_iso_VDJ$group 
## 
##                   rMOG_1 Expanded rMOG_2 Expanded MOG35-55 Expanded
## rMOG_2 Expanded   0.01041         -               -                
## MOG35-55 Expanded 4.2e-05         0.31020         -                
## rMOG_1 1 cell     &lt; 2e-16         0.00596         0.06741          
## rMOG_2 1 cell     &lt; 2e-16         5.9e-05         0.00084          
## MOG35-55 1 cell   &lt; 2e-16         5.9e-05         0.00084          
##                   rMOG_1 1 cell rMOG_2 1 cell
## rMOG_2 Expanded   -             -            
## MOG35-55 Expanded -             -            
## rMOG_1 1 cell     -             -            
## rMOG_2 1 cell     0.00560       -            
## MOG35-55 1 cell   0.00294       0.77169      
## 
## P value adjustment method: BH 
## [1] "------------"
## [1] "VJ chain SHM data summary"
##               group count      mean        sd median IQR
## 1   rMOG_1 Expanded   750 0.0800000 0.3887607      0   0
## 2   rMOG_2 Expanded   201 0.2686567 1.2639077      0   0
## 3 MOG35-55 Expanded   257 0.1089494 0.5410833      0   0
## 4     rMOG_1 1 cell  1704 1.3638498 3.1085672      0   1
## 5     rMOG_2 1 cell   404 0.8490099 2.4198259      0   0
## 6   MOG35-55 1 cell   693 0.3621934 1.5310323      0   0
## 
##  kruskal.test()
##  Kruskal-Wallis rank sum test
## 
## data:  value by group
## Kruskal-Wallis chi-squared = 355.41, df = 5, p-value &lt; 2.2e-16
## 
## 
##  pairwise.wilcox.test(p.adjust.method = 'BH')
##  Pairwise comparisons using Wilcoxon rank sum test with continuity correction 
## 
## data:  SHM_iso_VJ$value and SHM_iso_VJ$group 
## 
##                   rMOG_1 Expanded rMOG_2 Expanded MOG35-55 Expanded
## rMOG_2 Expanded   0.00534         -               -                
## MOG35-55 Expanded 0.91759         0.03729         -                
## rMOG_1 1 cell     &lt; 2e-16         5.0e-11         &lt; 2e-16          
## rMOG_2 1 cell     &lt; 2e-16         0.00022         2.5e-09          
## MOG35-55 1 cell   1.2e-09         0.13284         0.00012          
##                   rMOG_1 1 cell rMOG_2 1 cell
## rMOG_2 Expanded   -             -            
## MOG35-55 Expanded -             -            
## rMOG_1 1 cell     -             -            
## rMOG_2 1 cell     6.6e-05       -            
## MOG35-55 1 cell   &lt; 2e-16       0.00032      
## 
## P value adjustment method: BH 
## 
##  Please refer to output[[1]] to view boxplot showing group comparions tested here
##  Done</code></pre>
<div class="sourceCode" id="cb386"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Boxplot</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">SHM_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="st">"cm"</span><span class="op">)</span>, panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">50</span>,vjust <span class="op">=</span> <span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">samples_color</span>,<span class="va">samples_color</span><span class="op">)</span><span class="op">)</span>
  
<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out,filename = "Bcs_SHM_box_isotype.svg", dpi = 600, width = 8.5, height = 11) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-102-1.png" width="576"></p>
</div>
<div id="b-cells-vdj-gex-integration" class="section level2">
<h2 class="hasAnchor">
<a href="#b-cells-vdj-gex-integration" class="anchor" aria-hidden="true"></a>B cells VDJ GEX integration</h2>
<p>The first step is to check how well these two datasets overlap.</p>
<p>Nr. of cells in VDJ for which GEX info is available</p>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">GEX_av</span> <span class="op">&lt;-</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>av <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">GEX_available</span><span class="op">)</span>, not_av <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">GEX_available</span><span class="op">)</span><span class="op">)</span> <span class="co">#Using the sum of this column as in R, TRUE is counted as numeric 1 and FALSE as numeric 0</span>
<span class="va">GEX_av</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">GEX_av</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>

<span class="va">GEX_av_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">GEX_av</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">GEX_av</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  
<span class="va">plot_out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">GEX_av_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="fl">1</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"forestgreen"</span>,<span class="st">"grey60"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html" class="external-link">coord_polar</a></span><span class="op">(</span><span class="st">"y"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,legend.direction <span class="op">=</span> <span class="st">"vertical"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>,hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">GEX_av</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1.5</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, y <span class="op">=</span> <span class="fl">1</span>, label <span class="op">=</span> <span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"not_av"</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, y <span class="op">=</span> <span class="fl">1</span>, label <span class="op">=</span> <span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"av"</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>inherit.aes <span class="op">=</span> <span class="cn">F</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> 

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">plot_out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"GEX_available_pie_"</span>,<span class="va">plot_out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span> ,<span class="st">".png"</span><span class="op">)</span>, dpi <span class="op">=</span> <span class="fl">600</span>, width <span class="op">=</span> <span class="fl">5</span>, height <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Purple = Cells in VDJ for which GEX information is available"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Purple = Cells in VDJ for which GEX information is available"</code></pre>
<div class="sourceCode" id="cb389"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot_out</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<pre><code>## 
## [[2]]</code></pre>
<pre><code>## 
## [[3]]</code></pre>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">GEX_av</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   sample_id name   value
##   &lt;ord&gt;     &lt;chr&gt;  &lt;int&gt;
## 1 rMOG_1    av       712
## 2 rMOG_1    not_av  1742
## 3 rMOG_2    av       290
## 4 rMOG_2    not_av   315
## 5 MOG35-55  av       639
## 6 MOG35-55  not_av   311</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-103-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-103-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-103-3.png" width="576"></p>
<p>Nr. of cells in GEX for which VDJ info is available</p>
<div class="sourceCode" id="cb395"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VDJ_av</span> <span class="op">&lt;-</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/igraph/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>av <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VDJ_available</span><span class="op">)</span>, not_av <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VDJ_available</span><span class="op">)</span><span class="op">)</span> 
<span class="va">VDJ_av</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">VDJ_av</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">{</span>

<span class="va">VDJ_av_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">VDJ_av</span>, <span class="va">sample_id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">VDJ_av</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>
  
<span class="va">plot_out</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">VDJ_av_plot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, width <span class="op">=</span> <span class="fl">1</span>, show.legend <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkorchid3"</span>,<span class="st">"grey60"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html" class="external-link">coord_polar</a></span><span class="op">(</span><span class="st">"y"</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,legend.direction <span class="op">=</span> <span class="st">"vertical"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span>,hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">GEX_av</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">1.5</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, y <span class="op">=</span> <span class="fl">1</span>, label <span class="op">=</span> <span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"not_av"</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, y <span class="op">=</span> <span class="fl">1</span>, label <span class="op">=</span> <span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">GEX_av_plot</span><span class="op">$</span><span class="va">name</span> <span class="op">==</span> <span class="st">"av"</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"white"</span>, fontface <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>inherit.aes <span class="op">=</span> <span class="cn">F</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> 

<span class="co">#ggsave(plot_out[[i]], filename = paste0("VDJ_available_pie_",plot_out[[i]]$labels$title ,".png"), dpi = 600, width = 5, height = 5)</span>

<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Purple = Cells in GEX for which VDJ information is available"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Purple = Cells in GEX for which VDJ information is available"</code></pre>
<div class="sourceCode" id="cb397"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">plot_out</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<pre><code>## 
## [[2]]</code></pre>
<pre><code>## 
## [[3]]</code></pre>
<div class="sourceCode" id="cb401"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">VDJ_av</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   sample_id name   value
##   &lt;ord&gt;     &lt;chr&gt;  &lt;int&gt;
## 1 rMOG_1    av       767
## 2 rMOG_1    not_av   164
## 3 rMOG_2    av       308
## 4 rMOG_2    not_av    45
## 5 MOG35-55  av       682
## 6 MOG35-55  not_av    81</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-104-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-104-2.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-104-3.png" width="576"></p>
<p>As a second step we now overlay VDJ information onto the GEX umap</p>
<div class="sourceCode" id="cb403"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Add a discrete scale for expansion (To plot a continuos scale, use Seurat::FeaturePlot(..., features = "clonotype_frequency"))</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span> <span class="op">&lt;-</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">[</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Expanded"</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">[</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">clonotype_frequency</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"1 cell"</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">[</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">VDJ_available</span> <span class="op">==</span> <span class="cn">F</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"VDJ not available"</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"expanded"</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey30"</span>,<span class="st">"darkorchid3"</span>,<span class="st">"grey80"</span><span class="op">)</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> 
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span> axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Clonal level"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">3</span>,byrow<span class="op">=</span><span class="cn">TRUE</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> 

<span class="co">#ggsave(plot = plot_out , filename = "Bcs_GEXVDJ_expansion_discrete.svg", dpi = 700, width = 6.8, height = 5) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-105-1.png" width="576"></p>
<p>Proportion barplots again help us visualize differential distribution among clusters</p>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#adding a combination column</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span>, <span class="st">" "</span>, <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">)</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span><span class="op">[</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html" class="external-link">str_detect</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span>, <span class="st">"VDJ not available"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"VDJ not available"</span> <span class="co">#replacing sample specific VDJ not available with a general one (e.g. rMOG_1 VDJ not available -&gt; VDJ not available)</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_expanded</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Expanded rMOG_1"</span>, <span class="st">"1 cell rMOG_1"</span>,<span class="st">"Expanded rMOG_2"</span>, <span class="st">"1 cell rMOG_2"</span>, <span class="st">"Expanded MOG35-55"</span>, <span class="st">"1 cell MOG35-55"</span>, <span class="st">"VDJ not available"</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_proportions_barplot.html">GEX_proportions_barplot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, source.group <span class="op">=</span> <span class="st">"seurat_clusters"</span>, target.group <span class="op">=</span> <span class="st">"sample_expanded"</span>, stacked.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ordering based on existing source group factor levels"
##  [1] 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 4 4 4 4 4 4 4 4 6 6 6 6 6 6 6 6 5 5 5 5 5 5
## [39] 5 5 3 3 3 3 3 3 3 3 2 2 2 2 2 2 2 2
## Levels: 0 &lt; 1 &lt; 2 &lt; 3 &lt; 4 &lt; 5 &lt; 6
## [1] "Ordering based on existing target group factor levels"
## [1] "Returning stacked barplot with y axis = % of cells of target group"</code></pre>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">&lt;-</span>  <span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span><span class="op">:</span><span class="fl">13</span>,<span class="fl">6</span>,<span class="fl">16</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">26</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>, axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, plot.margin <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">margin</a></span><span class="op">(</span>l <span class="op">=</span> <span class="fl">1</span>, t <span class="op">=</span> <span class="fl">1</span>, unit <span class="op">=</span> <span class="st">"cm"</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"% of cells of B cell group"</span>, x <span class="op">=</span> <span class="st">""</span>, fill <span class="op">=</span> <span class="st">"Cluster"</span><span class="op">)</span>
  
<span class="va">plot_out</span></code></pre></div>
<pre><code>## Warning: Removed 7 rows containing missing values (position_stack).</code></pre>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#ggsave(plot = plot_out, filename = paste0("Bcs_prop_sampleexpanded.svg"), dpi = 700, width = 10, height = 9) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-106-1.png" width="576"></p>
<p>We are now ready to examine individual clones and their transcriptional phenotypes The VDJ_clonal_expansion function gives great flexibility.</p>
<ol style="list-style-type: decimal">
<li>Expansion barplots by cluster (plotting by group ID given the large overlap between rMOG samples)</li>
</ol>
<div class="sourceCode" id="cb409"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clonal_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_clonal_expansion.html">VDJ_clonal_expansion</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,celltype <span class="op">=</span> <span class="st">"Bcells"</span>,clones <span class="op">=</span> <span class="st">"50"</span>, platypus.version <span class="op">=</span> <span class="st">"v3"</span>, group.by <span class="op">=</span> <span class="st">"group_id"</span>, color.by <span class="op">=</span> <span class="st">"seurat_clusters"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "For sample rMOG removing 580 clones of which no cell contains a VDJ chain which is 29.71 % of all clones"
## [1] "For sample MOG35-55 removing 99 clones of which no cell contains a VDJ chain which is 12.33 % of all clones"</code></pre>
<div class="sourceCode" id="cb411"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> <span class="co">#as this function will return a nested list of source dataframes and plots we loop over it to refine the given plots</span>
  
<span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">25</span><span class="op">)</span>,axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,axis.line.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">30</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"bottom"</span>, plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">26</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">17</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">17</span>,<span class="fl">7</span>,<span class="fl">8</span><span class="op">)</span><span class="op">]</span>, <span class="st">"grey60"</span>,<span class="st">"grey40"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Cluster"</span>, y <span class="op">=</span> <span class="st">"n cells"</span><span class="op">)</span><span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="co">#ggsave(plot = clonal_out[[1]][[i]], filename = paste0("Bcs_cluster_per_clone_s_", unique(vgm_b[[1]]$group_id)[i],".svg"), dpi = 400, width = 11, height = 7)</span>
<span class="op">}</span></code></pre></div>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<pre><code>## Scale for 'fill' is already present. Adding another scale for 'fill', which
## will replace the existing scale.</code></pre>
<pre><code>## Scale for 'y' is already present. Adding another scale for 'y', which will
## replace the existing scale.</code></pre>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clonal_out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-107-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-107-2.png" width="576"></p>
<p>Fitting with this we can return to isotypes and view those projected onto the UMAP</p>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu">Seurat</span><span class="fu">::</span><span class="fu"><a href="https://satijalab.org/seurat/reference/DimPlot.html" class="external-link">DimPlot</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,reduction <span class="op">=</span> <span class="st">"umap"</span>, group.by <span class="op">=</span> <span class="st">"isotype"</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,<span class="st">"darkorchid3"</span> ,<span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,<span class="st">"chartreuse3"</span>,<span class="st">"black"</span>,<span class="st">"grey60"</span>,<span class="st">"grey80"</span><span class="op">)</span>, shuffle <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> 

<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>,plot.title <span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.line<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"Isotpye"</span>, x <span class="op">=</span> <span class="st">"UMAP1"</span>, y <span class="op">=</span> <span class="st">"UMAP2"</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">8</span>,byrow<span class="op">=</span><span class="cn">TRUE</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot = plot_out , filename = "Bcs_GEXVDJ_umap_isotype.svg", dpi = 700, width = 6.8, height = 5) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-108-1.png" width="576"></p>
<p>Checking the same isotype distribution with a proportions stacked barplot</p>
<div class="sourceCode" id="cb420"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_proportions_barplot.html">GEX_proportions_barplot</a></span><span class="op">(</span>GEX <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, source.group <span class="op">=</span> <span class="st">"isotype"</span>, target.group <span class="op">=</span> <span class="st">"seurat_clusters"</span>, stacked.plot <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ordering based on existing source group factor levels"
##  [1] IGHM                IGHM                IGHM               
##  [4] IGHM                IGHM                IGHM               
##  [7] IGHM                Unknown             Unknown            
## [10] Unknown             Unknown             Unknown            
## [13] Unknown             Unknown             IGHD               
## [16] IGHD                IGHD                IGHD               
## [19] IGHD                IGHD                IGHD               
## [22] Multiple VDJ chains Multiple VDJ chains Multiple VDJ chains
## [25] Multiple VDJ chains Multiple VDJ chains Multiple VDJ chains
## [28] Multiple VDJ chains IGHG                IGHG               
## [31] IGHG                IGHG                IGHG               
## [34] IGHG                IGHG                IGHA               
## [37] IGHA                IGHA                IGHA               
## [40] IGHA                IGHA                IGHA               
## [43] IGHE                IGHE                IGHE               
## [46] IGHE                IGHE                IGHE               
## [49] IGHE               
## 7 Levels: IGHA &lt; IGHG &lt; IGHD &lt; IGHM &lt; IGHE &lt; ... &lt; Unknown
## [1] "Ordering based on existing target group factor levels"
## [1] "Returning stacked barplot with y axis = % of cells of target group"</code></pre>
<div class="sourceCode" id="cb422"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">plot_out</span> <span class="op">&lt;-</span>  <span class="va">plot_out</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,<span class="st">"darkorchid3"</span> ,<span class="fu">pals</span><span class="fu">::</span><span class="fu"><a href="https://kwstat.github.io/pals/reference/discrete.html" class="external-link">kelly</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,<span class="st">"chartreuse3"</span>,<span class="st">"black"</span>,<span class="st">"grey60"</span>,<span class="st">"grey80"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">33</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">33</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>, legend.position <span class="op">=</span> <span class="st">"right"</span>, plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"% of isotype"</span>, x <span class="op">=</span> <span class="st">"Cluster"</span>, fill <span class="op">=</span> <span class="st">"Isotype"</span><span class="op">)</span>

<span class="va">plot_out</span>
  
<span class="co">#ggsave(plot = plot_out, filename = paste0("Bcs2_prop_isotype.svg"), dpi = 700, width = 10, height = 6) </span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-109-1.png" width="576"></p>
<p>Proceeing to DEG analysis by expansion</p>
<div class="sourceCode" id="cb423"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">exp_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, grouping.column <span class="op">=</span> <span class="st">"expanded"</span>, group1 <span class="op">=</span> <span class="st">"Expanded"</span>, group2 <span class="op">=</span> <span class="st">"1 cell"</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="co">#Again remove this particular gene that already showed an abnormally high fold change in rMOG vs. MOG35-55</span>
<span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"GM30211"</span>,<span class="op">]</span>

<span class="co">#given the low statistical power here, we plot non-adjusted p values</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.15</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">26</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(p)"</span>,title <span class="op">=</span> <span class="st">""</span>, subtitle <span class="op">=</span> <span class="st">"Expanded vs. 1 cell"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">p_val</span> <span class="op">&lt;</span> <span class="fl">0.0005</span> <span class="op">|</span> <span class="op">(</span><span class="va">avg_logFC</span> <span class="op">&gt;</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">p_val</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">5</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_colour_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey30"</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="st">"darkorchid3"</span>, oob <span class="op">=</span> <span class="va">squish_infinite</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = paste0("Bcs1_DEGexpanded_pval.svg"), dpi = 400, width = 6.7, height = 6)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-110-1.png" width="576"></p>
<p>And to elaborate on the comparison between immunization conditions</p>
<div class="sourceCode" id="cb424"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Add a group + expansion column</span>
<span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_expanded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span>, <span class="st">" "</span>, <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">expanded</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_expanded</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "rMOG 1 cell"                "rMOG VDJ not available"    
## [3] "rMOG Expanded"              "MOG35-55 VDJ not available"
## [5] "MOG35-55 1 cell"            "MOG35-55 Expanded"         
## [7] "MOG35-55 NA"</code></pre>
<div class="sourceCode" id="cb426"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Expanded vs. Expanded from each group</span>
<span class="va">exp_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, grouping.column <span class="op">=</span> <span class="st">"group_expanded"</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, group1 <span class="op">=</span> <span class="st">"rMOG Expanded"</span>, group2 <span class="op">=</span> <span class="st">"MOG35-55 Expanded"</span>, return.plot <span class="op">=</span> <span class="st">"volcano"</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>

<span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"GM30211"</span>,<span class="op">]</span>

<span class="co">#plot volcano</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">26</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(p)"</span>,title <span class="op">=</span> <span class="st">"Expanded rMOG vs. MOG35-55"</span>, subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">5</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_colour_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, oob <span class="op">=</span> <span class="va">squish_infinite</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = paste0("Bcs1_DEG_expanded rMOG vs MOG3555.svg"), dpi = 400, width = 6, height = 6)</span>

<span class="co">#now for non expanded cells</span>
<span class="va">exp_DEGs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/GEX_DEgenes.html">GEX_DEgenes</a></span><span class="op">(</span><span class="va">vgm_b</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, grouping.column <span class="op">=</span> <span class="st">"group_expanded"</span>, min.pct <span class="op">=</span> <span class="fl">0.25</span>, group1 <span class="op">=</span> <span class="st">"rMOG 1 cell"</span>, group2 <span class="op">=</span> <span class="st">"MOG35-55 1 cell"</span>, return.plot <span class="op">=</span> <span class="st">"volcano"</span>, logFC <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>
<span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"GM30211"</span>,<span class="op">]</span>

<span class="co">#plot volcano</span>
<span class="va">plot_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">avg_logFC</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">3</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>, axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, axis.ticks.length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="st">"cm"</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">26</span><span class="op">)</span>, legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,legend.key.height <span class="op">=</span> <span class="cn">NULL</span>,legend.key.width <span class="op">=</span> <span class="cn">NULL</span>, legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"log2(avg FC)"</span>, y <span class="op">=</span> <span class="st">"-log10(p)"</span>,title <span class="op">=</span> <span class="st">"1 cell rMOG vs. MOG35-55"</span>, subtitle <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">exp_DEGs</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">avg_logFC</span>, y <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">p_val</span><span class="op">)</span>, label <span class="op">=</span> <span class="va">SYMBOL</span><span class="op">)</span>, inherit.aes <span class="op">=</span> <span class="cn">F</span>, size <span class="op">=</span> <span class="fl">4</span>, segment.alpha <span class="op">=</span> <span class="fl">1</span>, max.overlaps <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_colour_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, mid <span class="op">=</span> <span class="st">"grey60"</span>, high <span class="op">=</span> <span class="va">samples_color</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, oob <span class="op">=</span> <span class="va">squish_infinite</span><span class="op">)</span>

<span class="va">plot_out</span>

<span class="co">#ggsave(plot_out, filename = paste0("Bcs1_DEG_1cell rMOG vs MOG3555.png"), dpi = 400, width = 6, height = 6)</span></code></pre></div>
<p><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-111-1.png" width="576"><img src="PlatypusV3_EAE_files/figure-html/unnamed-chunk-111-2.png" width="576"></p>
<p>As part of the investigation into BCR specificities within EAE, we selected 20 BCR sequences to express in the available PnP hybridoma system. (Pogson, M., Parola, C., Kelton, W. J., Heuberger, P. &amp; Reddy, S. T. Immunogenomic engineering of a plug-and-(dis)play hybridoma platform. Nat. Commun. 7, 12535 (2016)). As part of this, aligned BCR sequences need to be prepared for DNA synthesis. For this the function VDJ_assemble_for_PnP helps</p>
<div class="sourceCode" id="cb427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">VGM_with_PnP_seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_assemble_for_PnP.html">VDJ_assemble_for_PnP</a></span><span class="op">(</span>VDJ.mixcr.matrix <span class="op">=</span> <span class="va">vgm_b</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, id.column <span class="op">=</span> <span class="st">"barcode"</span>,species <span class="op">=</span> <span class="st">"human"</span>, manual_IgKC <span class="op">=</span> <span class="st">"none"</span>, manual_2A <span class="op">=</span> <span class="st">"none"</span>, manual_VDJLeader <span class="op">=</span> <span class="st">"none"</span>, write.to.disk <span class="op">=</span> <span class="cn">T</span>, filename <span class="op">=</span> <span class="st">"RawforPnP_EAE.csv"</span><span class="op">)</span>
<span class="co">#We use human constant regions so to allow for staining of tissues via microscopy.</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">VGM_with_PnP_seq</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb428"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.0.5 (2021-03-31)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 19042)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=German_Germany.1252  LC_CTYPE=German_Germany.1252   
## [3] LC_MONETARY=German_Germany.1252 LC_NUMERIC=C                   
## [5] LC_TIME=German_Germany.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] cowplot_1.1.1      gridExtra_2.3      reshape2_1.4.4     ProjecTILs_1.0.0  
##  [5] Matrix_1.3-4       TILPRED_1.0.2      umap_0.2.7.0       remotes_2.4.0     
##  [9] gtable_0.3.0       igraph_1.2.6       ggrepel_0.9.1      pals_1.7          
## [13] scales_1.1.1       forcats_0.5.1      stringr_1.4.0      purrr_0.3.4       
## [17] readr_2.0.1        tidyr_1.1.3        tibble_3.1.2       ggplot2_3.3.5     
## [21] tidyverse_1.3.1    SeuratObject_4.0.2 Seurat_4.0.3       Platypus_3.1      
## [25] dplyr_1.0.7       
## 
## loaded via a namespace (and not attached):
##   [1] utf8_1.2.1                  R.utils_2.10.1             
##   [3] reticulate_1.20             tidyselect_1.1.1           
##   [5] RSQLite_2.2.8               AnnotationDbi_1.52.0       
##   [7] htmlwidgets_1.5.4           grid_4.0.5                 
##   [9] Rtsne_0.15                  munsell_0.5.0              
##  [11] codetools_0.2-18            ragg_1.1.3                 
##  [13] ica_1.0-2                   future_1.22.1              
##  [15] miniUI_0.1.1.1              withr_2.4.2                
##  [17] colorspace_2.0-2            Biobase_2.50.0             
##  [19] highr_0.9                   knitr_1.34                 
##  [21] rstudioapi_0.13             stats4_4.0.5               
##  [23] SingleCellExperiment_1.12.0 ROCR_1.0-11                
##  [25] tensor_1.5                  listenv_0.8.0              
##  [27] MatrixGenerics_1.2.1        labeling_0.4.2             
##  [29] GenomeInfoDbData_1.2.4      polyclip_1.10-0            
##  [31] bit64_4.0.5                 farver_2.1.0               
##  [33] pheatmap_1.0.12             rprojroot_2.0.2            
##  [35] parallelly_1.28.1           vctrs_0.3.8                
##  [37] generics_0.1.0              xfun_0.24                  
##  [39] GenomeInfoDb_1.26.7         R6_2.5.1                   
##  [41] isoband_0.2.5               DelayedArray_0.16.3        
##  [43] bitops_1.0-7                spatstat.utils_2.2-0       
##  [45] cachem_1.0.5                assertthat_0.2.1           
##  [47] promises_1.2.0.1            globals_0.14.0             
##  [49] goftest_1.2-2               rlang_0.4.10               
##  [51] systemfonts_1.0.2           GlobalOptions_0.1.2        
##  [53] splines_4.0.5               lazyeval_0.2.2             
##  [55] dichromat_2.0-0             spatstat.geom_2.2-0        
##  [57] broom_0.7.9                 yaml_2.2.1                 
##  [59] abind_1.4-5                 modelr_0.1.8               
##  [61] backports_1.2.1             httpuv_1.6.1               
##  [63] tools_4.0.5                 ellipsis_0.3.2             
##  [65] spatstat.core_2.2-0         jquerylib_0.1.4            
##  [67] RColorBrewer_1.1-2          BiocGenerics_0.36.1        
##  [69] ggridges_0.5.3              Rcpp_1.0.7                 
##  [71] plyr_1.8.6                  zlibbioc_1.36.0            
##  [73] RCurl_1.98-1.4              rpart_4.1-15               
##  [75] openssl_1.4.5               deldir_0.2-10              
##  [77] pbapply_1.5-0               S4Vectors_0.28.1           
##  [79] zoo_1.8-9                   SummarizedExperiment_1.20.0
##  [81] haven_2.4.3                 cluster_2.1.2              
##  [83] fs_1.5.0                    magrittr_2.0.1             
##  [85] data.table_1.14.0           RSpectra_0.16-0            
##  [87] scattermore_0.7             circlize_0.4.13            
##  [89] lmtest_0.9-38               reprex_2.0.1               
##  [91] RANN_2.6.1                  fitdistrplus_1.1-5         
##  [93] matrixStats_0.59.0          hms_1.1.0                  
##  [95] patchwork_1.1.1             mime_0.11                  
##  [97] evaluate_0.14               xtable_1.8-4               
##  [99] XML_3.99-0.7                AUCell_1.12.0              
## [101] readxl_1.3.1                shape_1.4.6                
## [103] IRanges_2.24.1              compiler_4.0.5             
## [105] maps_3.3.0                  KernSmooth_2.23-20         
## [107] crayon_1.4.1                R.oo_1.24.0                
## [109] htmltools_0.5.2             mgcv_1.8-36                
## [111] later_1.2.0                 tzdb_0.1.2                 
## [113] lubridate_1.7.10            DBI_1.1.1                  
## [115] dbplyr_2.1.1                MASS_7.3-54                
## [117] ade4_1.7-17                 permute_0.9-5              
## [119] cli_3.0.0                   R.methodsS3_1.8.1          
## [121] parallel_4.0.5              GenomicRanges_1.42.0       
## [123] pkgconfig_2.0.3             pkgdown_1.6.1.9001         
## [125] plotly_4.9.4.1              spatstat.sparse_2.0-0      
## [127] xml2_1.3.2                  annotate_1.68.0            
## [129] bslib_0.3.0                 XVector_0.30.0             
## [131] stringdist_0.9.8            rvest_1.0.1                
## [133] digest_0.6.27               sctransform_0.3.2          
## [135] RcppAnnoy_0.0.18            graph_1.68.0               
## [137] vegan_2.5-7                 spatstat.data_2.1-0        
## [139] rmarkdown_2.11              cellranger_1.1.0           
## [141] leiden_0.3.9                uwot_0.1.10                
## [143] GSEABase_1.52.1             shiny_1.6.0                
## [145] lifecycle_1.0.0             nlme_3.1-152               
## [147] jsonlite_1.7.2              seqinr_4.2-8               
## [149] mapproj_1.2.7               desc_1.3.0                 
## [151] viridisLite_0.4.0           askpass_1.1                
## [153] limma_3.46.0                fansi_0.5.0                
## [155] pillar_1.6.2                lattice_0.20-44            
## [157] fastmap_1.1.0               httr_1.4.2                 
## [159] survival_3.2-11             glue_1.4.2                 
## [161] png_0.1-7                   bit_4.0.4                  
## [163] stringi_1.7.4               sass_0.4.0                 
## [165] blob_1.2.2                  textshaping_0.3.5          
## [167] memoise_2.0.0               irlba_2.3.3                
## [169] future.apply_1.8.1</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alexander Yermanos.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
