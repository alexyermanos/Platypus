<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PlatypusML_classic vignette • Platypus</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="PlatypusML_classic vignette">
<meta property="og:description" content="Platypus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Platypus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/quickstart.html">Get started</a>
</li>
<li>
  <a href="../vignette_index.html">Vignettes</a>
</li>
<li>
  <a href="../PlatypusDB_index.html">PlatypusDB</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://immunesim.readthedocs.io/en/latest/" class="external-link">ImmuneSIM</a>
    </li>
  </ul>
</li>
<li>
  <a href="../cute_monotremes.html">Cute Monotremes</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/alexyermanos" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/alexyermanos/Platypus" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>PlatypusML_classic vignette</h1>
                        <h4 data-toc-skip class="author">Daria Laslo
&amp; Stine Anzboeck</h4>
            
            <h4 data-toc-skip class="date">6/20/2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/alexyermanos/Platypus/tree/mastervignettes/PlatypusML_classic.Rmd" class="external-link"><code>vignettes/PlatypusML_classic.Rmd</code></a></small>
      <div class="hidden name"><code>PlatypusML_classic.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The PlatypusML package is meant to provide examples and potential
pipelines for classifying or regressing on immunological data. All
functions are designed based on the VDJ_GEX_matrix (VGM), object central
to the Platypus family of packages. Currently PlatypusML allows the
extraction of features and labels from the VGM object with the
possibility for selecting a desired encoding where multiple options are
available (in the case of sequences for example). The feature matrix can
be then used to classify the samples based on the labels or to predict
relevant quantities such as affinity through regression. For the chosen
machine learning approach, VDJ or GEX features can be used. We are
currently working on models that can integrate both VDJ and GEX for
predictions.</p>
<p>This vignette showcases a potential pipeline using PlatypusML,
focusing on a particular example.</p>
</div>
<div class="section level2">
<h2 id="downloading-data-from-platypusdb-creating-labeled-vgm-objects">2. Downloading data from PlatypusDB &amp; creating labeled VGM
objects<a class="anchor" aria-label="anchor" href="#downloading-data-from-platypusdb-creating-labeled-vgm-objects"></a>
</h2>
<p>For the purpose of this vignette we are going to create two different
labeled VGM objects:</p>
<ol style="list-style-type: decimal">
<li><p><strong>VGM</strong> consisting of GP33- &amp; NP396-specific
CD8+ T cells &amp; GP66-specific CD4+ T cells. We are going to add
binder labels, to be able to predict binding(1)/non-binding(0) in binary
classification tasks.</p></li>
<li><p><strong>VGM_CD8</strong> consisting only of GP33- &amp;
NP396-specific CD8+ T cells. We are going to add binder labels, to be
able to predict binding(1)/non-binding(0) in binary classification
tasks. Additionally, we are going to add phenotype labels to
GP33-specific CD8+ T cells (), to be able to predict different
phenotypes in binary classification tasks, such as LCMV(1)/MCMV(0)
infection, acute(1)/chronic(0) LCMV infection and biological replicate
sample identity.</p></li>
</ol>
<p>Alternatively, labelled VGMs as well as featuresets and classifiers
generated in this vignette can be downloaded directly from here:</p>
<ol style="list-style-type: decimal">
<li>
<strong>VGM 1</strong> <a href="https://storage.googleapis.com/platypus_private/PlatypusML_classic_VGM_NP396_GP33_GP66_labelled_MIXCR.RDS" class="external-link uri">https://storage.googleapis.com/platypus_private/PlatypusML_classic_VGM_NP396_GP33_GP66_labelled_MIXCR.RDS</a>
</li>
<li>
<strong>VGM CD8</strong> <a href="https://storage.googleapis.com/platypus_private/PlatypusML_classic_VGM_NP396_GP33_labelled_MIXCR.rds" class="external-link uri">https://storage.googleapis.com/platypus_private/PlatypusML_classic_VGM_NP396_GP33_labelled_MIXCR.rds</a>
</li>
<li>
<strong>Zip archive of features and classifiers</strong> <a href="https://storage.googleapis.com/platypus_private/PlatypusML_calssic_classifiers_features.zip" class="external-link uri">https://storage.googleapis.com/platypus_private/PlatypusML_calssic_classifiers_features.zip</a>
After downloading please unzip and set the <em>filepath</em> variable to
your download folder.</li>
</ol>
<div class="section level3">
<h3 id="vgm-with-gp33--np396-specific-cd8-t-cells-gp66-specific-cd4-t-cells">2.1 VGM: with GP33- &amp; NP396-specific CD8+ T cells &amp;
GP66-specific CD4+ T cells<a class="anchor" aria-label="anchor" href="#vgm-with-gp33--np396-specific-cd8-t-cells-gp66-specific-cd4-t-cells"></a>
</h3>
<div class="section level4">
<h4 id="creating-the-vgm-object">2.1.1 Creating the VGM object<a class="anchor" aria-label="anchor" href="#creating-the-vgm-object"></a>
</h4>
<p>We download the raw VDJ and GEX Cellranger outputs of the datasets
kuhn2021a (containing GP33-specific CD8+ cells) &amp; shlesinger2022c
(containing NP396-specific CD8+ cells) &amp; khatun2021a (containing
GP66-specific CD4+ cells) from Platypus DB.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#kuhn2021a:GP33-specific CD8+ cells</span></span>
<span><span class="va">kuhn2021a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusDB_fetch.html">PlatypusDB_fetch</a></span><span class="op">(</span></span>
<span>  PlatypusDB.links <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kuhn2021a/GP33.AcuteLCMV.28dpi.CD4Tcell.S1/ALL"</span>,</span>
<span>                       <span class="st">"kuhn2021a/GP33.AcuteLCMV.28dpi.CD4Tcell.S2/ALL"</span>,</span>
<span>                       <span class="st">"kuhn2021a/GP33.ChronicLCMV.28dpi.CD4Tcell.S3/ALL"</span>,</span>
<span>                       <span class="st">"kuhn2021a/GP33.ChronicLCMV.28dpi.CD4Tcell.S4/ALL"</span>,</span>
<span>                       <span class="st">"kuhn2021a/GP33.MCMVie2gp33.28dpi.CD4Tcell.S5/ALL"</span>, </span>
<span>                       <span class="st">"kuhn2021a/GP33.MCMVie2gp33.28dpi.CD4Tcell.S6/ALL"</span><span class="op">)</span>,</span>
<span>  save.to.disk <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  load.to.enviroment <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  load.to.list <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#shlesinger2022c:NP396-specific CD8+ cells</span></span>
<span><span class="va">shlesinger2022c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusDB_fetch.html">PlatypusDB_fetch</a></span><span class="op">(</span></span>
<span>  PlatypusDB.links <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shlesinger2022c/Dejavu.CC10.NP396.S1/ALL"</span>,</span>
<span>                       <span class="st">"shlesinger2022c/Dejavu.CC10.NP396.S2/ALL"</span>,</span>
<span>                       <span class="st">"shlesinger2022c/Dejavu.CC25.NP396.S3/ALL"</span>,</span>
<span>                       <span class="st">"shlesinger2022c/Dejavu.CC25.NP396.S4/ALL"</span><span class="op">)</span>,</span>
<span>  save.to.disk <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  load.to.enviroment <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  load.to.list <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#khatun2021a: GP66-specific CD4+ cells</span></span>
<span><span class="va">khatun2021a</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusDB_fetch.html">PlatypusDB_fetch</a></span><span class="op">(</span></span>
<span>  PlatypusDB.links <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"khatun2021a/CD4.Tcell.Khatun.M3.S5/ALL"</span>,</span>
<span>                       <span class="st">"khatun2021a/CD4.Tcell.Khatun.M4.S6/ALL"</span>,</span>
<span>                       <span class="st">"khatun2021a/CD4.Tcell.Khatun.M5.S7/ALL"</span><span class="op">)</span>,</span>
<span>  save.to.disk <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  load.to.enviroment <span class="op">=</span> <span class="cn">F</span>,</span>
<span>  load.to.list <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We integrate the three datasets by generating a combined
VDJ_GEX_matrix (VGM). The group_id will help us to distinguish samples
from different datasets later on. Additionally, we extract the full
length VDJ sequences using MIXCR through the function
VDJ_call_MIXCR_full. For more details on how this is done please refer
to the ‘Quick Start’ vignette, section 7.3.Extracting full-length
sequences from the VDJRegion. This is an optional step that allows the
use of the full length sequences as features later during modeling.
However, classification can be performed on the already existing
sequences of the integrated VGM object.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#integrating the three datasets into one VGM object</span></span>
<span><span class="va">VGM</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_GEX_matrix.html">VDJ_GEX_matrix</a></span><span class="op">(</span>Data.in <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">shlesinger2022c</span>, <span class="va">kuhn2021a</span>, <span class="va">khatun2021a</span><span class="op">)</span>,</span>
<span>                                 parallel.processing <span class="op">=</span> <span class="st">"parlapply"</span>,</span>
<span>                                 trim.and.align <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 integration.method <span class="op">=</span> <span class="st">"harmony"</span>,</span>
<span>                                 group.id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## add MIXCR columns to VGM[[1]]</span></span>
<span><span class="va">VDJ_MIXCR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_call_MIXCR_full.html">VDJ_call_MIXCR_full</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                 species<span class="op">=</span><span class="st">"mmu"</span>,</span>
<span>                                 platypus.version<span class="op">=</span><span class="st">"v3"</span>,</span>
<span>                                 operating.system<span class="op">=</span><span class="st">"Darwin"</span>,</span>
<span>                                 simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span> <span class="va">VDJ_MIXCR</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adding-labels">2.1.2 Adding labels<a class="anchor" aria-label="anchor" href="#adding-labels"></a>
</h4>
<p>We add the following binary labels to both the VDJ (VGM[[1]]) and the
GEX (VGM[[2]]<span class="citation">@meta.data</span>) object:</p>
<ul>
<li><strong>GP33_binder</strong></li>
<li><strong>NP396_binder</strong></li>
<li><strong>GP66_binder</strong></li>
</ul>
<p>1 indicates binder, 0 indicates non-binder. We use the group_id to
distinguish cells from different datasets.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#adding binder information to VDJ object</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP33_binder</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">NP396_binder</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP66_binder</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">NP396_binder</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP33_binder</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP66_binder</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co">#adding binder information to GEX object</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">GP33_binder</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">NP396_binder</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">GP66_binder</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">NP396_binder</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">GP33_binder</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">GP66_binder</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">VGM</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"PlatypusML_classic_VGM_NP396_GP33_GP66_labelled_MIXCR.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>NOTE: Here we save the resulting VGM object containing the integrated
data including the full length VDJ region sequences as an RDS file as
its computation is both computationally expensive and time-consuming.
This is recommended to make potential future uses of the object more
efficient.</p>
</div>
<div class="section level4">
<h4 id="loading-the-vgm">2.1.3 Loading the VGM<a class="anchor" aria-label="anchor" href="#loading-the-vgm"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VGM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"PlatypusML_classic_VGM_NP396_GP33_GP66_labelled_MIXCR.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#testing labels: number of samples per binder</span></span>
<span><span class="va">VDJ_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP33_binder</span><span class="op">)</span></span>
<span><span class="va">VDJ_GP66</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP66_binder</span><span class="op">)</span></span>
<span><span class="va">VDJ_NP396</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">NP396_binder</span><span class="op">)</span></span>
<span><span class="va">GEX_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP33_binder</span><span class="op">)</span></span>
<span><span class="va">GEX_NP396</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">NP396_binder</span><span class="op">)</span></span>
<span><span class="va">GEX_GP66</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP66_binder</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"VDJ: %s GP33-binding &amp; %s NP396-binding &amp; %s GP66-binding cells"</span>, <span class="va">VDJ_GP33</span>, <span class="va">VDJ_NP396</span>, <span class="va">VDJ_GP66</span><span class="op">)</span>,<span class="st">'  \n'</span>, <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"GEX: %s GP33-binding &amp; %s NP396-binding &amp; %s GP66-binding cells"</span>, <span class="va">GEX_GP33</span>, <span class="va">GEX_NP396</span>, <span class="va">GEX_GP66</span><span class="op">)</span>, <span class="st">'  \n'</span><span class="op">)</span></span></code></pre></div>
<p>VDJ: 10662 GP33-binding &amp; 17016 NP396-binding &amp; 11352
GP66-binding cells<br>
GEX: 22131 GP33-binding &amp; 29572 NP396-binding &amp; 13947
GP66-binding cells</p>
</div>
</div>
<div class="section level3">
<h3 id="vgm_cd8-with-gp33--np396-specific-cd8-t-cells">2.2 VGM_CD8: with GP33- &amp; NP396-specific CD8+ T cells<a class="anchor" aria-label="anchor" href="#vgm_cd8-with-gp33--np396-specific-cd8-t-cells"></a>
</h3>
<div class="section level4">
<h4 id="creating-the-vgm_cd8-object">2.2.1 Creating the VGM_CD8 object<a class="anchor" aria-label="anchor" href="#creating-the-vgm_cd8-object"></a>
</h4>
<p>We integrate the two datasets loaded above (shlesinger2022c,
kuhn2021a), by generating a combined VDJ_GEX_matrix (VGM). The group_id
will help us to distinguish samples from different datasets later on.
Additionally, we extract the full length VDJ sequences using MIXCR
through the function VDJ_call_MIXCR_full. For more details on how this
is done please refer to the ‘Quick Start’ vignette, section
7.3.Extracting full-length sequences from the VDJRegion. This is an
optional step that allows the use of the full length sequences as
features later during modeling. However, classification can be performed
on the already existing sequences of the integrated VGM object.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#integrating the two datasets into one VGM object</span></span>
<span><span class="va">VGM_CD8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_GEX_matrix.html">VDJ_GEX_matrix</a></span><span class="op">(</span>Data.in <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">shlesinger2022c</span>, <span class="va">kuhn2021a</span><span class="op">)</span>,</span>
<span>                                 <span class="fu">parallel.processing</span><span class="op">(</span><span class="st">"mclapply"</span><span class="op">)</span>,</span>
<span>                                 trim.and.align <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                 integration.method <span class="op">=</span> <span class="st">"harmony"</span>,</span>
<span>                                 group.id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add MIXCR columns to VGM[[1]]</span></span>
<span></span>
<span><span class="va">VDJ_MIXCR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VDJ_call_MIXCR_full.html">VDJ_call_MIXCR_full</a></span><span class="op">(</span>VDJ <span class="op">=</span> <span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                 species<span class="op">=</span><span class="st">"mmu"</span>,</span>
<span>                                 platypus.version<span class="op">=</span><span class="st">"v3"</span>,</span>
<span>                                 operating.system<span class="op">=</span><span class="st">"Darwin"</span>,</span>
<span>                                 simplify<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">&lt;-</span> <span class="va">VDJ_MIXCR</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="adding-labels-1">2.2.2 Adding labels<a class="anchor" aria-label="anchor" href="#adding-labels-1"></a>
</h4>
<div class="section level5">
<h5 id="binder-labels">Binder labels<a class="anchor" aria-label="anchor" href="#binder-labels"></a>
</h5>
<p>We add the following binary binder labels to both the VDJ (VGM[[1]])
and the GEX (VGM[[2]]<span class="citation">@meta.data</span>)
object:</p>
<ul>
<li><strong>GP33_binder</strong></li>
<li><strong>NP396_binder</strong></li>
</ul>
<p>1 indicates binder, 0 indicates non-binder. We use the group_id to
distinguish cells from different datasets.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#adding binder information to VDJ object</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP33_binder</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">NP396_binder</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">NP396_binder</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP33_binder</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co">#adding binder information to GEX object</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">GP33_binder</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">NP396_binder</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">NP396_binder</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">GP33_binder</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">meta.data</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="phenotype-lables">Phenotype lables<a class="anchor" aria-label="anchor" href="#phenotype-lables"></a>
</h5>
<p>For the GP33-specific cells from the kuhn2021a dataset we add
phenotype lables to the GEX (VGM[[2]]<span class="citation">@meta.data</span>) object. We use the sample_id to
distinguish cells from different samples. The samples in the kuhn2021a
dataset are the following: s5 &amp; s6 are acute LCMV-infected cells, s7
&amp; s8 are chronic LCMV-infected cells, s9 &amp; s10 are (latent)
MCMV-infected cells.</p>
<p>We add the following binary phenotype labels:</p>
<ul>
<li>
<strong>LCMV_MCMV</strong>: LCMV(1)/MCMV(0) infection</li>
<li>
<strong>acute_chronic_LCMV</strong>: acute(1)/chronic(0) LCMV
infection</li>
<li>
<strong>bio_replicate</strong>: biological replicates
s5(0)/s6(0)</li>
</ul>
<p>The cells for which none of the binary labels applies are labelled
with NA.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#adding phenotype labels to GEX object</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">acute_chronic_LCMV</span> <span class="op">&lt;-</span> <span class="fl">0</span> </span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">acute_chronic_LCMV</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">==</span><span class="st">"s5"</span> <span class="op">|</span> <span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">==</span><span class="st">"s6"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">acute_chronic_LCMV</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">==</span><span class="st">"s9"</span> <span class="op">|</span> <span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">==</span><span class="st">"s10"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">acute_chronic_LCMV</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LCMV_MCMV</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LCMV_MCMV</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">acute_chronic_LCMV</span><span class="op">==</span><span class="fl">1</span> <span class="op">|</span> <span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">acute_chronic_LCMV</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LCMV_MCMV</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">group_id</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">bio_replicate</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">bio_replicate</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">==</span><span class="st">"s5"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">bio_replicate</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sample_id</span><span class="op">==</span><span class="st">"s6"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co">#save VGM</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">VGM_CD8</span>,file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"PlatypusML_classic_VGM_NP396_GP33_labelled_MIXCR.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>NOTE: Here we save the resulting VGM object containing the integrated
data including the full length VDJ region sequences as an RDS file as
its computation is both computationally expensive and time-consuming.
This is recommended to make potential future uses of the object more
efficient.</p>
</div>
</div>
<div class="section level4">
<h4 id="loading-the-vgm_cd8">2.2.2 Loading the VGM_CD8<a class="anchor" aria-label="anchor" href="#loading-the-vgm_cd8"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VGM_CD8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"PlatypusML_classic_VGM_NP396_GP33_labelled_MIXCR.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#testing labels: number of binder-specific cells</span></span>
<span><span class="va">VDJ_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP33_binder</span><span class="op">)</span></span>
<span><span class="va">VDJ_NP396</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">NP396_binder</span><span class="op">)</span></span>
<span><span class="va">GEX_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">GP33_binder</span><span class="op">)</span></span>
<span><span class="va">GEX_NP396</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">NP396_binder</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"VDJ: %s GP33-binding &amp; %s NP396-binding cells"</span>, <span class="va">VDJ_GP33</span>, <span class="va">VDJ_NP396</span><span class="op">)</span>, <span class="st">'  \n'</span>,<span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"GEX: %s GP33-binding &amp; %s NP396-binding cells"</span>, <span class="va">GEX_GP33</span>, <span class="va">GEX_NP396</span><span class="op">)</span>, <span class="st">'  \n'</span><span class="op">)</span></span></code></pre></div>
<p>VDJ: 11263 GP33-binding &amp; 18095 NP396-binding cells<br>
GEX: 22656 GP33-binding &amp; 30263 NP396-binding cells</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#testing labels: number of phenotype-specific cells</span></span>
<span><span class="va">acuteLCMV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">acute_chronic_LCMV</span><span class="op">==</span><span class="fl">1</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">chronicLCMV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">acute_chronic_LCMV</span><span class="op">==</span><span class="fl">0</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">LCMV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LCMV_MCMV</span><span class="op">==</span><span class="fl">1</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">MCMV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">LCMV_MCMV</span><span class="op">==</span><span class="fl">0</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">s5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">bio_replicate</span><span class="op">==</span><span class="fl">1</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">s6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">VGM_CD8</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">bio_replicate</span><span class="op">==</span><span class="fl">0</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"GEX: %s acute &amp; %s chronic LCMV-infected cells"</span>, <span class="va">acuteLCMV</span>, <span class="va">chronicLCMV</span><span class="op">)</span>, <span class="st">'  \n'</span>,<span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"GEX: %s LCMV &amp; %s MCMV-infected cells"</span>, <span class="va">LCMV</span>, <span class="va">MCMV</span><span class="op">)</span>,<span class="st">'  \n'</span>,<span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"GEX: Biological replicates: %s cells in sample s5 &amp; %s cells in sample s6"</span>, <span class="va">s5</span>, <span class="va">s6</span><span class="op">)</span>, <span class="st">'  \n'</span><span class="op">)</span></span></code></pre></div>
<p>GEX: 9235 acute &amp; 4215 chronic LCMV-infected cells<br>
GEX: 13450 LCMV &amp; 9206 MCMV-infected cells<br>
GEX: Biological replicates: 4125 cells in sample s5 &amp; 5110 cells in
sample s6</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="vdj-features-only">3. VDJ features only<a class="anchor" aria-label="anchor" href="#vdj-features-only"></a>
</h2>
<p>We are going to predict binding (binary classification) using VDJ
information only. We are first extracting features and then training
different classification models.</p>
<div class="section level3">
<h3 id="vdj-feature-extraction">VDJ feature extraction<a class="anchor" aria-label="anchor" href="#vdj-feature-extraction"></a>
</h3>
<p>For feature extraction we use the PlatypusML_feature_extraction()
function. There are multiple options for choosing:</p>
<ul>
<li>
<strong>which.features</strong>: which features from the VGM[[1]] to
encode (e.g. full V(D)J nt sequences or V(D)J_cdr3s_nt)</li>
<li>
<strong>which.encoding</strong>: which encoding to use (e.g. one-hot
or kmer) to encode the nt or aa sequences</li>
<li>
<strong>encoding.level</strong>: on which level to extract the
features (e.g. “clone” = one unique sample per clone)</li>
<li>
<strong>problem</strong>: which problem will the features used for:
“classification” or “regression”</li>
<li>
<strong>which.label</strong>: which label to use for the machine
learning problem further downstream</li>
</ul>
<p>We are going to create 3 different feature matrices to be used for
classifications further downstream. In this case, we use the VDJ and VJ
full length sequences encoded using kmer of size 3 (default). There is
an additional option to set the size of the kmer, by setting a value “to
parameter.encoding.nt”. For more details and encoding options, please
refer to the documentation of the function.</p>
</div>
<div class="section level3">
<h3 id="classification">Classification<a class="anchor" aria-label="anchor" href="#classification"></a>
</h3>
<p>The PlatypusML_classification() function takes as input the encoded
features obtained from the PlatypusML_extract_features() function. The
classification function runs cross validation on a specified number of
folds for different classification models (XGBoost, SVM, Random Forest,
Logistic Regression &amp; Gaussian Naive Bayes) and reports the AUC
scores, ROC curve and confusion matrix for each classification
model.</p>
</div>
<div class="section level3">
<h3 id="examples">3.1 Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<div class="section level4">
<h4 id="predicting-gp33-binding">3.1.1 Predicting GP33 binding<a class="anchor" aria-label="anchor" href="#predicting-gp33-binding"></a>
</h4>
<div class="section level5">
<h5 id="using-the-full-vdj-vj-nt-sequences-mixcr-kmer-k3-encoding">using the full VDJ &amp; VJ nt sequences (MIXCR) &amp; kmer (k=3)
encoding<a class="anchor" aria-label="anchor" href="#using-the-full-vdj-vj-nt-sequences-mixcr-kmer-k3-encoding"></a>
</h5>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#feature extraction</span></span>
<span><span class="va">features_mixcr_kmer_clone_GP33</span> <span class="op">&lt;-</span> <span class="fu">PlatypusML_feature_extraction</span><span class="op">(</span></span>
<span>  VDJ <span class="op">=</span> <span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  which.features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_nt_mixcr"</span>, <span class="st">"VJ_nt_mixcr"</span><span class="op">)</span>,</span>
<span>  which.encoding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kmer"</span>, <span class="st">"kmer"</span><span class="op">)</span>,</span>
<span>  encoding.level <span class="op">=</span> <span class="st">"clone"</span>,</span>
<span>  which.label <span class="op">=</span> <span class="st">"GP33_binder"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">features_mixcr_kmer_clone_GP33</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/mixcr_kmer_clone_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_mixcr_kmer_clone_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/mixcr_kmer_clone_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_GP33_mixcr_kmer_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_mixcr_kmer_clone_GP33</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_GP33_mixcr_kmer_clone</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/GP33_mixcr_kmer_clone.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_GP33_mixcr_kmer_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/GP33_mixcr_kmer_clone.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_GP33_mixcr_kmer_clone</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
<p><img src="PlatypusML_classic_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="using-the-vdj-vj-cdr3-nt-sequences-kmer-k3-encoding">using the VDJ &amp; VJ CDR3 nt sequences &amp; kmer (k=3)
encoding<a class="anchor" aria-label="anchor" href="#using-the-vdj-vj-cdr3-nt-sequences-kmer-k3-encoding"></a>
</h5>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#feature extraction</span></span>
<span><span class="va">features_cdr3s_kmer_clone</span> <span class="op">&lt;-</span> <span class="fu">PlatypusML_feature_extraction</span><span class="op">(</span></span>
<span>  VDJ <span class="op">=</span> <span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  which.features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_cdr3s_nt"</span>, <span class="st">"VJ_cdr3s_nt"</span><span class="op">)</span>,</span>
<span>  which.encoding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kmer"</span>, <span class="st">"kmer"</span><span class="op">)</span>,</span>
<span>  encoding.level <span class="op">=</span> <span class="st">"clone"</span>,</span>
<span>  which.label <span class="op">=</span> <span class="st">"GP33_binder"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">features_cdr3s_kmer_clone</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/cdr3s_kmer_clone_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_cdr3s_kmer_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/cdr3s_kmer_clone_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_GP33_cdr3s_kmer_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_cdr3s_kmer_clone</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_GP33_cdr3s_kmer_clone</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/GP33_cdr3s_kmer_clone.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_GP33_cdr3s_kmer_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/GP33_cdr3s_kmer_clone.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_GP33_cdr3s_kmer_clone</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
<p><img src="PlatypusML_classic_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="using-the-vdj-vj-cdr3-nt-sequences-kmer-k234-encoding">using the VDJ &amp; VJ CDR3 nt sequences &amp; kmer (k=234)
encoding<a class="anchor" aria-label="anchor" href="#using-the-vdj-vj-cdr3-nt-sequences-kmer-k234-encoding"></a>
</h5>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#feature extraction</span></span>
<span><span class="va">features_cdr3s_234kmer_clone</span> <span class="op">&lt;-</span> <span class="fu">PlatypusML_feature_extraction</span><span class="op">(</span></span>
<span>  VDJ <span class="op">=</span> <span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  which.features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_cdr3s_nt"</span>, <span class="st">"VJ_cdr3s_nt"</span><span class="op">)</span>,</span>
<span>  which.encoding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kmer"</span>, <span class="st">"kmer"</span><span class="op">)</span>,</span>
<span>  parameters.encoding.nt <span class="op">=</span> <span class="fl">234</span>,</span>
<span>  encoding.level <span class="op">=</span> <span class="st">"clone"</span>,</span>
<span>  which.label <span class="op">=</span> <span class="st">"GP33_binder"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">features_cdr3s_234kmer_clone</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/cdr3s_234kmer_clone_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_cdr3s_234kmer_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/cdr3s_234kmer_clone_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_GP33_cdr3s_234kmer_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_cdr3s_234kmer_clone</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_GP33_cdr3s_234kmer_clone</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/GP33_cdr3s_234kmer_clone.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_GP33_cdr3s_234kmer_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/GP33_cdr3s_234kmer_clone.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_GP33_cdr3s_234kmer_clone</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
<p><img src="PlatypusML_classic_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="using-the-vdj-vj-cdr3-nt-sequences-one-hot-encoding">using the VDJ &amp; VJ CDR3 nt sequences &amp; one-hot encoding<a class="anchor" aria-label="anchor" href="#using-the-vdj-vj-cdr3-nt-sequences-one-hot-encoding"></a>
</h5>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#feature extraction</span></span>
<span><span class="va">features_cdr3s_onehot_clone</span> <span class="op">&lt;-</span> <span class="fu">PlatypusML_feature_extraction</span><span class="op">(</span></span>
<span>  VDJ <span class="op">=</span> <span class="va">VGM</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  which.features <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"VDJ_cdr3s_nt"</span>, <span class="st">"VJ_cdr3s_nt"</span><span class="op">)</span>,</span>
<span>  which.encoding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"onehot"</span>, <span class="st">"onehot"</span><span class="op">)</span>,</span>
<span>  encoding.level <span class="op">=</span> <span class="st">"clone"</span>,</span>
<span>  which.label <span class="op">=</span> <span class="st">"GP33_binder"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">features_cdr3s_onehot_clone</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/cdr3s_onehot_clone_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_cdr3s_onehot_clone_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/cdr3s_onehot_clone_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_GP33_cdr3s_onehot_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_cdr3s_onehot_clone</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_GP33_cdr3s_onehot_clone</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/GP33_cdr3s_onehot_clone.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_GP33_cdr3s_onehot_clone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/GP33_cdr3s_onehot_clone.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_GP33_cdr3s_onehot_clone</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
<p><img src="PlatypusML_classic_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="gex-features-only">4. GEX features only<a class="anchor" aria-label="anchor" href="#gex-features-only"></a>
</h2>
<p>We are going to predict binding or phenotypes (binary classification)
using GEX information only. We are first extracting features (either PCs
or most variable genes) and then training different classification
models.</p>
<div class="section level3">
<h3 id="gex-feature-extraction">GEX feature extraction<a class="anchor" aria-label="anchor" href="#gex-feature-extraction"></a>
</h3>
<p>For GEX feature extraction we are going to use the
PlatypusML_feature_extraction_GEX() function. There are multiple options
for choosing:</p>
<ul>
<li>
<strong>which.features</strong>: which features from the VGM[[2]] to
encode (either the 1000 most variable features obtained by
Seurat::FindVariableFeatures (“varFeatures”), or the top n PCs (“PCs”,
default n=20))</li>
<li>
<strong>encoding.level</strong>: on which level to extract the
features (e.g. “clone” = one unique sample per clone)</li>
<li>
<strong>which.label</strong>: which label to use for the machine
learning problem further downstream</li>
</ul>
</div>
<div class="section level3">
<h3 id="classification-1">Classification<a class="anchor" aria-label="anchor" href="#classification-1"></a>
</h3>
<p>The PlatypusML_classification() function takes as input the encoded
features obtained from the PlatypusML_extract_features() function. The
classification function runs cross validation on a specified number of
folds for different classification models (XGBoost, SVM, Random Forest,
Logistic Regression &amp; Gaussian Naive Bayes) and reports the AUC
scores, ROC curve and confusion matrix for each classification
model.</p>
</div>
<div class="section level3">
<h3 id="examples-1">Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a>
</h3>
<p>Note: In order to reduce training time, we are going to use
encoding.level=“clone” in all examples.</p>
<div class="section level4">
<h4 id="predicting-gp33-binding-1">4.1.1 Predicting GP33 binding<a class="anchor" aria-label="anchor" href="#predicting-gp33-binding-1"></a>
</h4>
<p>To check whether the classifier discriminates CD4+ vs CD8+ T cells
instead of binding specificity, we are going to compare the results from
using a VGM containing both CD4+ and CD8+ T cells (VGM) with the results
from using a VGM containing CD8+ T cells only (VGM_CD8).</p>
<div class="section level5">
<h5 id="encoding-the-1000-most-variable-features">encoding the 1000 most variable features<a class="anchor" aria-label="anchor" href="#encoding-the-1000-most-variable-features"></a>
</h5>
<p><strong>VGM consisting of CD4+ and CD8+ T cells</strong></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#feature extraction</span></span>
<span><span class="va">features_varFeatures_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_feature_extraction_GEX.html">PlatypusML_feature_extraction_GEX</a></span><span class="op">(</span>VGM<span class="op">=</span><span class="va">VGM</span>, </span>
<span>                                                               which.features <span class="op">=</span> <span class="st">"varFeatures"</span>, </span>
<span>                                                               encoding.level <span class="op">=</span> <span class="st">"clone"</span>,</span>
<span>                                                               which.label<span class="op">=</span><span class="st">"GP33_binder"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">features_varFeatures_GP33</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">features_varFeatures_GP33</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_varFeatures_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_varFeatures_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_varFeatures_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_varFeatures_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_varFeatures_GP33</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_varFeatures_GP33</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_varFeatures_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_varFeatures_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_varFeatures_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_varFeatures_GP33</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
<p><strong>VGM_CD8 consisting only of CD8+ T cells</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#feature extraction</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>features_varFeatures_GP33_CD8 <span class="ot">&lt;-</span> <span class="fu">PlatypusML_feature_extraction_GEX</span>(<span class="at">VGM=</span>VGM_CD8, </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                                                               <span class="at">which.features =</span> <span class="st">"varFeatures"</span>, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                                                               <span class="at">encoding.level =</span> <span class="st">"clone"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                                                               <span class="at">which.label=</span><span class="st">"GP33_binder"</span>)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(features_varFeatures_GP33_CD8)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(features_varFeatures_GP33_CD8, <span class="at">file=</span><span class="fu">paste0</span>(filepath,<span class="st">"features/features_varFeatures_GP33_CD8.RDS"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_varFeatures_GP33_CD8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_varFeatures_GP33_CD8.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_varFeatures_GP33_CD8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_varFeatures_GP33_CD8</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_varFeatures_GP33_CD8</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_varFeatures_GP33_CD8.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_varFeatures_GP33_CD8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_varFeatures_GP33_CD8.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_varFeatures_GP33_CD8</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
<p>There is no major difference in the results from the VGM vs VGM_CD8,
indicating that the classifiers are actually picking up information
about the binding specificity and not CD8+ vs CD4+ from the 1000 most
variable features.</p>
</div>
<div class="section level5">
<h5 id="encoding-the-top-20-pcs">encoding the top 20 PCs<a class="anchor" aria-label="anchor" href="#encoding-the-top-20-pcs"></a>
</h5>
<p><strong>VGM consisting of CD4+ and CD8+ T cells</strong></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#feature extraction</span></span>
<span><span class="va">features_PCs_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_feature_extraction_GEX.html">PlatypusML_feature_extraction_GEX</a></span><span class="op">(</span>VGM<span class="op">=</span><span class="va">VGM</span>, </span>
<span>                                                       which.features <span class="op">=</span> <span class="st">"PCs"</span>, </span>
<span>                                                       encoding.level <span class="op">=</span> <span class="st">"clone"</span>,</span>
<span>                                                       which.label<span class="op">=</span><span class="st">"GP33_binder"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">features_PCs_GP33</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">features_PCs_GP33</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_PCs_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_PCs_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_PCs_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_PCs_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_PCs_GP33</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_PCs_GP33</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_PCs_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_PCs_GP33</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_PCs_GP33.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_PCs_GP33</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
<p><strong>VGM_CD8 consisting only of CD8+ T cells</strong></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#feature extraction</span></span>
<span><span class="va">features_PCs_GP33_CD8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_feature_extraction_GEX.html">PlatypusML_feature_extraction_GEX</a></span><span class="op">(</span>VGM<span class="op">=</span><span class="va">VGM_CD8</span>, </span>
<span>                                                       which.features <span class="op">=</span> <span class="st">"PCs"</span>, </span>
<span>                                                       encoding.level <span class="op">=</span> <span class="st">"clone"</span>,</span>
<span>                                                       which.label<span class="op">=</span><span class="st">"GP33_binder"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">features_PCs_GP33_CD8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">features_PCs_GP33_CD8</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_PCs_GP33_CD8.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_PCs_GP33_CD8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_PCs_GP33_CD8.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_PCs_GP33_CD8</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_PCs_GP33_CD8</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_PCs_GP33_CD8</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_PCs_GP33_CD8.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_PCs_GP33_CD8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_PCs_GP33_CD8.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_PCs_GP33_CD8</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
<p>Again, there is no major difference in the results from the VGM vs
VGM_CD8.</p>
</div>
</div>
<div class="section level4">
<h4 id="predicting-lcmv-vs-mcmv-infection">4.1.3 Predicting LCMV vs MCMV infection<a class="anchor" aria-label="anchor" href="#predicting-lcmv-vs-mcmv-infection"></a>
</h4>
<p>Moving away from predicting binding specificity, we next want to
train classifiers for binary classification of LCMV (1) vs MCMV (0)
infection.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#feature extraction</span></span>
<span><span class="va">features_PCs_acute_chronic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_feature_extraction_GEX.html">PlatypusML_feature_extraction_GEX</a></span><span class="op">(</span>VGM<span class="op">=</span><span class="va">VGM_CD8</span>, </span>
<span>                                                       which.features <span class="op">=</span> <span class="st">"PCs"</span>, </span>
<span>                                                       encoding.level <span class="op">=</span> <span class="st">"clone"</span>,</span>
<span>                                                       which.label<span class="op">=</span><span class="st">"LCMV"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">features_PCs_LCMV_MCMV</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_PCs_LCMV_MCMV.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_PCs_acute_chronic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_PCs_LCMV_MCMV.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_PCs_LCMV_MCMV</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_PCs_LCMV_MCMV</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_PCs_LCMV_MCMV</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_PCs_LCMV_MCMV.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_PCs_LCMV_MCMV</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_PCs_LCMV_MCMV.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_PCs_LCMV_MCMV</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="predicting-acute-vs-chronic-lcmv-infection">4.1.4 Predicting acute vs chronic LCMV infection<a class="anchor" aria-label="anchor" href="#predicting-acute-vs-chronic-lcmv-infection"></a>
</h4>
<p>We train classifiers for binary classification of actute (1) vs
chronic (0) LCMV infection.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#feature extraction</span></span>
<span><span class="va">features_PCs_acute_chronic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_feature_extraction_GEX.html">PlatypusML_feature_extraction_GEX</a></span><span class="op">(</span>VGM<span class="op">=</span><span class="va">VGM_CD8</span>, </span>
<span>                                                       which.features <span class="op">=</span> <span class="st">"PCs"</span>, </span>
<span>                                                       encoding.level <span class="op">=</span> <span class="st">"clone"</span>,</span>
<span>                                                       which.label<span class="op">=</span><span class="st">"acuteLCMV"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">features_PCs_acute_chronic</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_PCs_acute_chronic.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_PCs_acute_chronic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_PCs_acute_chronic.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_PCs_acute_chronic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_PCs_acute_chronic</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_PCs_acute_chronic</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_PCs_acute_chronic.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_PCs_acute_chronic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_PCs_acute_chronic.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_PCs_acute_chronic</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="predicting-sample-identity-of-biological-replicates">4.1.5 Predicting sample identity of biological replicates<a class="anchor" aria-label="anchor" href="#predicting-sample-identity-of-biological-replicates"></a>
</h4>
<p>As a sanity check we want to check how well the classifiers are able
to discriminate two biological replicates: sample s5 (1) vs sample s6
(0).</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#feature extraction</span></span>
<span><span class="va">features_PCs_bio_replicate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_feature_extraction_GEX.html">PlatypusML_feature_extraction_GEX</a></span><span class="op">(</span>VGM<span class="op">=</span><span class="va">VGM_CD8</span>, </span>
<span>                                                       which.features <span class="op">=</span> <span class="st">"PCs"</span>, </span>
<span>                                                       encoding.level <span class="op">=</span> <span class="st">"clone"</span>,</span>
<span>                                                       which.label<span class="op">=</span><span class="st">"bio_replicate"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">features_PCs_bio_replicate</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_PCs_bio_replicate.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">features_PCs_bio_replicate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"features/features_PCs_bio_replicate.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#classification</span></span>
<span><span class="va">classifier_PCs_bio_replicate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PlatypusML_classification.html">PlatypusML_classification</a></span><span class="op">(</span><span class="va">features_PCs_bio_replicate</span>,<span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">classifier_PCs_bio_replicate</span>, file<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_PCs_bio_replicate.RDS"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">classifier_PCs_bio_replicate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">filepath</span>,<span class="st">"classifiers/classifier_PCs_bio_replicate.RDS"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">classifier_PCs_bio_replicate</span><span class="op">$</span><span class="va">combined</span></span></code></pre></div>
<p>As expected, the performance of the classifiers only slightly
outperforms a random classifier.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="version-information">Version information<a class="anchor" aria-label="anchor" href="#version-information"></a>
</h2>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.2.1 (2022-06-23 ucrt)</span></span>
<span><span class="co">## Platform: x86_64-w64-mingw32/x64 (64-bit)</span></span>
<span><span class="co">## Running under: Windows 10 x64 (build 19044)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">## [1] LC_COLLATE=German_Germany.utf8  LC_CTYPE=German_Germany.utf8   </span></span>
<span><span class="co">## [3] LC_MONETARY=German_Germany.utf8 LC_NUMERIC=C                   </span></span>
<span><span class="co">## [5] LC_TIME=German_Germany.utf8    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] Platypus_3.4.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] systemfonts_1.0.4     plyr_1.8.7            igraph_1.3.4         </span></span>
<span><span class="co">##   [4] lazyeval_0.2.2        sp_1.5-0              splines_4.2.1        </span></span>
<span><span class="co">##   [7] listenv_0.8.0         scattermore_0.8       ggplot2_3.3.6        </span></span>
<span><span class="co">##  [10] digest_0.6.29         foreach_1.5.2         yulab.utils_0.0.5    </span></span>
<span><span class="co">##  [13] htmltools_0.5.3       fansi_1.0.3           magrittr_2.0.3       </span></span>
<span><span class="co">##  [16] memoise_2.0.1         tensor_1.5            cluster_2.1.3        </span></span>
<span><span class="co">##  [19] ROCR_1.0-11           globals_0.15.1        matrixStats_0.62.0   </span></span>
<span><span class="co">##  [22] pkgdown_2.0.6         spatstat.sparse_2.1-1 colorspace_2.0-3     </span></span>
<span><span class="co">##  [25] ggrepel_0.9.1         textshaping_0.3.6     xfun_0.31            </span></span>
<span><span class="co">##  [28] dplyr_1.0.9           jsonlite_1.8.0        progressr_0.10.1     </span></span>
<span><span class="co">##  [31] spatstat.data_2.2-0   survival_3.3-1        zoo_1.8-10           </span></span>
<span><span class="co">##  [34] iterators_1.0.14      ape_5.6-2             glue_1.6.2           </span></span>
<span><span class="co">##  [37] polyclip_1.10-0       gtable_0.3.0          leiden_0.4.2         </span></span>
<span><span class="co">##  [40] future.apply_1.9.0    abind_1.4-5           scales_1.2.0         </span></span>
<span><span class="co">##  [43] DBI_1.1.3             spatstat.random_2.2-0 miniUI_0.1.1.1       </span></span>
<span><span class="co">##  [46] Rcpp_1.0.9            viridisLite_0.4.0     xtable_1.8-4         </span></span>
<span><span class="co">##  [49] gridGraphics_0.5-1    tidytree_0.3.9        reticulate_1.25      </span></span>
<span><span class="co">##  [52] spatstat.core_2.4-4   htmlwidgets_1.5.4     httr_1.4.3           </span></span>
<span><span class="co">##  [55] RColorBrewer_1.1-3    ellipsis_0.3.2        Seurat_4.1.1         </span></span>
<span><span class="co">##  [58] ica_1.0-3             farver_2.1.1          pkgconfig_2.0.3      </span></span>
<span><span class="co">##  [61] sass_0.4.2            uwot_0.1.11           deldir_1.0-6         </span></span>
<span><span class="co">##  [64] utf8_1.2.2            labeling_0.4.2        ggplotify_0.1.0      </span></span>
<span><span class="co">##  [67] tidyselect_1.1.2      rlang_1.0.4           reshape2_1.4.4       </span></span>
<span><span class="co">##  [70] later_1.3.0           munsell_0.5.0         tools_4.2.1          </span></span>
<span><span class="co">##  [73] cachem_1.0.6          xgboost_1.6.0.1       cli_3.3.0            </span></span>
<span><span class="co">##  [76] generics_0.1.3        ggridges_0.5.3        evaluate_0.15        </span></span>
<span><span class="co">##  [79] stringr_1.4.0         fastmap_1.1.0         yaml_2.3.5           </span></span>
<span><span class="co">##  [82] ragg_1.2.2            goftest_1.2-3         ggtree_3.4.1         </span></span>
<span><span class="co">##  [85] knitr_1.39            fs_1.5.2              fitdistrplus_1.1-8   </span></span>
<span><span class="co">##  [88] purrr_0.3.4           RANN_2.6.1            pbapply_1.5-0        </span></span>
<span><span class="co">##  [91] future_1.27.0         nlme_3.1-157          mime_0.12            </span></span>
<span><span class="co">##  [94] aplot_0.1.6           compiler_4.2.1        rstudioapi_0.13      </span></span>
<span><span class="co">##  [97] plotly_4.10.0         png_0.1-7             spatstat.utils_2.3-1 </span></span>
<span><span class="co">## [100] treeio_1.20.1         tibble_3.1.8          bslib_0.4.0          </span></span>
<span><span class="co">## [103] stringi_1.7.8         highr_0.9             desc_1.4.1           </span></span>
<span><span class="co">## [106] rgeos_0.5-9           lattice_0.20-45       Matrix_1.4-1         </span></span>
<span><span class="co">## [109] vctrs_0.4.1           pillar_1.8.0          lifecycle_1.0.1      </span></span>
<span><span class="co">## [112] spatstat.geom_2.4-0   lmtest_0.9-40         jquerylib_0.1.4      </span></span>
<span><span class="co">## [115] RcppAnnoy_0.0.19      data.table_1.14.2     cowplot_1.1.1        </span></span>
<span><span class="co">## [118] irlba_2.3.5           httpuv_1.6.5          patchwork_1.1.1      </span></span>
<span><span class="co">## [121] R6_2.5.1              promises_1.2.0.1      KernSmooth_2.23-20   </span></span>
<span><span class="co">## [124] gridExtra_2.3         parallelly_1.32.1     codetools_0.2-18     </span></span>
<span><span class="co">## [127] MASS_7.3-57           assertthat_0.2.1      rprojroot_2.0.3      </span></span>
<span><span class="co">## [130] SeuratObject_4.1.0    sctransform_0.3.3     mgcv_1.8-40          </span></span>
<span><span class="co">## [133] parallel_4.2.1        grid_4.2.1            rpart_4.1.16         </span></span>
<span><span class="co">## [136] ggfun_0.0.6           tidyr_1.2.0           rmarkdown_2.14       </span></span>
<span><span class="co">## [139] Rtsne_0.16            pROC_1.18.0           shiny_1.7.2</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Alexander Yermanos.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
