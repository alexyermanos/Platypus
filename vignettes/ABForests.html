<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Chrysa Papadopoulou" />

<meta name="date" content="2021-09-20" />

<title>ABForests vignette</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">ABForests vignette</h1>
<h4 class="author">Chrysa Papadopoulou</h4>
<h4 class="date">2021-09-20</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grid)</span></code></pre></div>
<div id="introduction" class="section level2">
<h2>1. Introduction</h2>
<p>AbNetForests is a novel computational framework, which provides a consesus on how to process high-throughtput scSeq data and integrate the high-dimensional feature space of gene expression to the evolution of B cells. It increases the size of the computational toolbox available to study immunoglobulin repertoires and incorporates additional features for the quantification of B cell clonal selection. Firstly, it can extract and organize B cell data directly from the output alignment of any single-cell technology. The generated data, containing information such as germline gene usage, full-length heavy and light chain sequence and CDR3 sequences can be combined with the transcriptional analysis of the gene expression libraries from the cellranger and subsequently B cells are grouped into clonal lineages, using one of the several clonotyping strategies that have been developed from Platypus (Yermanos et. al, 2021) under default parameters. The generated single-cell immune repertoire sequencing datasets can relate somatic hypermutation and evolution with transcriptional phenotypes. AbNetForests can additionally infer and visualize B cell mutational networks, modeling the extensive diversification of unique full-length variable heavy and variable light chain (<span class="math inline">\(V_H\)</span> + <span class="math inline">\(V_L\)</span>) BCR sequences, integrating immune features such as antibody isotype or transcriptional cluster distribution and clonal expansion. In a last step, a qualitative and quantitative evaluation of the repertoire diversity takes place by computing both local and global summary statistics. Therefore, tree topologies and metrics are compared across one or several repertoires, disregarding whether they come from distinct individuals or organs.</p>
<p>An overview of the previously described workflow is demonstrated in Figure 1.</p>
<p>The user can set various parameters:</p>
<ul>
<li>DAG (TRUE/FALSE): specifies whether a directed acyclic graph will is produced</li>
<li>clonal_frequency (TRUE/FALSE): specifies whether the labeling of vertices in graphs will be based on clonal frequency</li>
<li>scaleByClonalFreq (TRUE/FALSE): specifies whether vertex size will be scaled by clonal frequency of corresponding node</li>
<li>weight (TRUE/FALSE): specifies whether the weights of outgoing edges from Germline node will be set to 1 (FALSE) or elsewhere they will be set to the difference between the number of mutations among sequences in germline and connected nodes(value in the corresponding distance matrix) and the absolute value of the difference between the sequence lengths of germline and corresponding connected nodes</li>
<li>tie_flag (‘rand’, ‘full’, ‘close_to_germ’, ‘far_from_germ’, ‘close_path_to_germ’,‘far_path_from_germ’, ‘most_expanded’,‘least_expanded’): ‘rand’ means random pruning in one of nodes, ‘full’ means keeping all nodes, close_to_germ means pruning of node(s) farthest from germline (based on number of intermediate nodes), ‘far_from_germ’ means pruning of node(s) closest to germline (based on number of intermediate nodes),‘close_path_to_germ’ means pruning of node(s) farthest from germline (based on edge path length), ‘far_path_from_germ’ meams pruning of node(s) closest to germline (based on edge path length),‘most_expanded’ means pruning of node(s) with the lowest B cell count(clonal frequency) and least_expanded, which means pruning of node(s) with the hightest B cell count(clonal frequency)</li>
<li>scaleBybetweenness (TRUE/FALSE): specifies whether the vertex size is scaled by the vertex betweenness centrality</li>
<li>scaleByclocloseness_metr (TRUE/FALSE): specifies whether vertex size is scaled by closeness centrality of vertices in graph</li>
<li>random.seed (interger): a random seed, specified by the user</li>
<li>alg_opt (‘naive’,‘two-step’): specifies the version of the edge selection algorithm that will be used in the construction of networks</li>
<li>cdr3 (0,1,NULL): specifies whether the user desires to select full length sequences (0) or CDR3 sequences (1) [only when the input is a list of csv files] and NULL otherwise</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Program parameters</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>DAG<span class="ot">&lt;-</span><span class="cn">TRUE</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>clonal_frequency<span class="ot">&lt;-</span><span class="cn">TRUE</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>scaleByClonalFreq<span class="ot">&lt;-</span><span class="cn">TRUE</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>weight<span class="ot">&lt;-</span><span class="cn">TRUE</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>tie_flag<span class="ot">&lt;-</span><span class="st">&#39;rand&#39;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>scaleBybetweenness<span class="ot">&lt;-</span><span class="cn">FALSE</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>scaleByclocloseness_metr<span class="ot">&lt;-</span><span class="cn">FALSE</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>topdf<span class="ot">&lt;-</span><span class="cn">TRUE</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>custom_mat<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>random.seed<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>alg_opt<span class="ot">&lt;-</span><span class="st">&#39;naive&#39;</span></span></code></pre></div>
<p>When a user does not want to perform any prior filtering on the input data then he/she can conduct the following flow of commands. For the sake of the example, the isotype information is taken into account. Networks are depicted in tree format with the reference germline set to the root. Nodes in each network are both labeled and scaled by the clonal frequency.</p>
<ol style="list-style-type: lower-alpha">
<li>For the inference of networks:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&quot;new&quot; is an example dataset loaded with the package (See ABForests_sysdata)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>graphs<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(new,<span class="cn">FALSE</span>,<span class="cn">NULL</span>,custom_mat,clonal_frequency,scaleByClonalFreq,weight,tie_flag,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;isotype&quot;</span>,random.seed,alg_opt,<span class="cn">NULL</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>For the visualization of networks:</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AbForests_PlotGraphs</span>(graphs,<span class="cn">NULL</span>,topdf,<span class="st">&quot;Networks&quot;</span>)</span></code></pre></div>
<p>A user may also modify the igraph object graphs himself/herself apart from using the PlotGraphs function of the package.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.01</span><span class="sc">*</span>graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">12</span><span class="sc">+</span>(<span class="fl">1.2</span><span class="sc">*</span>graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant))</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty=</span>graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: lower-alpha">
<li>For calculating metrics on networks:</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>metrics<span class="ot">&lt;-</span><span class="fu">AbForests_ForestMetrics</span>(graphs,DAG,clonal_frequency,scaleByClonalFreq,weight,tie_flag,<span class="st">&quot;isotype&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: lower-alpha">
<li>For visualizing a specific metric: For example, we can inspect the shortest paths in each network (in position 6 of metrics list):</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AbForests_PlotGraphs</span>(metrics,<span class="dv">6</span>,topdf,<span class="st">&quot;Metrics&quot;</span>)</span></code></pre></div>
<p>Similarly, we can infer the networks using the transcriptional cluster information.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>graphs_cluster<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(new,<span class="cn">FALSE</span>,<span class="cn">NULL</span>,custom_mat,clonal_frequency,scaleByClonalFreq,weight,tie_flag,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;cluster&quot;</span>,random.seed,alg_opt,<span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AbForests_PlotGraphs</span>(graphs_cluster,<span class="cn">NULL</span>,topdf,<span class="st">&quot;Networks_cluster&quot;</span>)</span></code></pre></div>
<p>and modify the igraph object according to the user preferences.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.01</span><span class="sc">*</span>graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">12</span><span class="sc">+</span>(<span class="fl">1.2</span><span class="sc">*</span>graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty=</span>graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_cluster[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.35</span>)</span></code></pre></div>
<p>The cluster “Unknown” indicates that the barcodes of cells are not included in the GEX library.</p>
</div>
<div id="dataset-format" class="section level2">
<h2>2. Dataset Format</h2>
<p>To demonstrate the potential of AbNetForests, lineages were inferred using two previously described datasets following either chronic lymphocytic choriomeningitis virus (LCMV) infection or serial protein immunizations with Ovalbumin (Neumeier et al., 2021).</p>
<div id="experimental-dataset-following-lcmv-infection" class="section level3">
<h3>Experimental dataset following LCMV infection</h3>
<p>The single-cell immune repertoire sequencing data from the bone marrow plasma cells of a mouse infected with high dose of LCMV ,from a recently published work (Neumeier et al., 2021), was used to investigate isotype-specific mutational signatures. This dataset was generated by performing single-cell immune repertoire sequencing of murine BM PCs 28 days following chronic LCMV infection. Bone marrow plasma cells were isolated via fluorescence-activated cell sorting (FACS) (CD138+, TACI+, CD19lo, B220lo), which was then used as input for single-cell immune repertoire sequencing using the 10X genomics 5’ V(D)J protocol. This experimental system recovers both gene expression and antibody repertoire sequencing data, relating clonal selection to cell phenotypes. B cells with identical heavy and light chain V and J germline genes, identical complementary determining region 3 sequence lengths for both heavy and light chain variable regions (CDRH3 for <span class="math inline">\(V_H\)</span> and CDRL3 for <span class="math inline">\(V_L\)</span>) and at least 70% sequence homology in the CDR3 regions were grouped together into clonal lineages.The clonal lineage data was generated using the R package Platypus under default parameters (Yermanos et al. 2021).</p>
<p>The dataset consists of a list of repertoires, each consisting of clonal lineages, represented as data.frames, each of which is a 49-column structure.</p>
<p>A subset of a clonal lineage of the dataset is provided for guiding the user in constructing its own data input.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new[[<span class="dv">1</span>]],<span class="dv">3</span>)</span></code></pre></div>
<p>For simplicity of the input, the package can receive a list of clonal lineages, each of which is a two-column structure:</p>
<ul>
<li>Seq: full-length antibody sequences recovered from single cells after clonotyping</li>
<li>Name: isotype or/and transcriptional information for each single cell. The transcriptional clusters are supplied as numbers.The type of information (isotype or cluster), which is utilized in the analysis depends solely on the user’s purposes.</li>
</ul>
<p>During each network reconstruction procedure, from a vast pool of roots produced as a result of V(D)J recombination, a reference germline sequence is added in each clonal lineage. This germline sequence is characterized by the largest occurrence from the set of reference germline heavy and light sequences for each particular clone from the 10x Genomics cellranger.</p>
</div>
<div id="experimental-dataset-following-ova-infection" class="section level3">
<h3>Experimental dataset following OVA infection</h3>
<p>The program is also capable of receiving input from a csv formatted file. Characteristic examples of such files are provided for the user’s convenience (Bcell_sequences_example_tree and Bcell_tree_2) and can assist in constructing its own data if he/she wants to diverge from the previously discussed structure. In such a case, column names can be modified, without altering the structure and the essence of data. These files contain 9 columns:</p>
<ul>
<li>X: Enumeration of cells</li>
<li>HCvgene: The name of heavy chain v-gene segment</li>
<li>LCjgene: The name of light chain j-gene segment</li>
<li>HCjgene: The name of heavy chain j-gene segment</li>
<li>LCvgene: The name of light chain v-gene segment</li>
<li>HCcdr3: The CDR3 sequence in heavy chain</li>
<li>LCcdr3: The CDR3 sequence in light chain</li>
<li>Cluster: The transcriptional cluster in hexadecimal RGB color specification</li>
<li>HCisotype: The isotype information</li>
<li>HCLC: The full-length antibody sequences prior clonotyping</li>
</ul>
<p>A subset of this dataset is provided for reference</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>file1<span class="ot">&lt;-</span><span class="fu">data</span>(<span class="st">&quot;Bcell_sequences_example_tree&quot;</span>, <span class="at">package =</span> <span class="st">&quot;Platypus&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>file1<span class="ot">&lt;-</span><span class="fu">get</span>(file1)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(file1,<span class="dv">3</span>)</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>file2<span class="ot">&lt;-</span><span class="fu">data</span>(Bcell_tree_2, <span class="at">package =</span> <span class="st">&quot;Platypus&quot;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>file2<span class="ot">&lt;-</span><span class="fu">get</span>(file2)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(file2,<span class="dv">3</span>)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>files<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>files<span class="ot">&lt;-</span><span class="fu">append</span>(files,file1)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>files<span class="ot">&lt;-</span><span class="fu">append</span>(files,file2)</span></code></pre></div>
<p>For the inference of networks, without modifying initial input data and using the full-length antibody sequences, we have</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>graphs_csv<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(files,<span class="cn">TRUE</span>,<span class="cn">NULL</span>,custom_mat,clonal_frequency,scaleByClonalFreq,weight,tie_flag,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;isotype&quot;</span>,random.seed,alg_opt,<span class="dv">0</span>) </span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.01</span><span class="sc">*</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">8</span><span class="sc">+</span>(<span class="fl">1.2</span><span class="sc">*</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant))</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
<p>while when we consider only CDRH3 for <span class="math inline">\(V_H\)</span> and CDRL3 for <span class="math inline">\(V_L\)</span> sequences:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>graphs_csv<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(files,<span class="cn">TRUE</span>,<span class="cn">NULL</span>,custom_mat,clonal_frequency,scaleByClonalFreq,weight,tie_flag,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;isotype&quot;</span>,random.seed,alg_opt,<span class="dv">1</span>) </span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.01</span><span class="sc">*</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">8</span><span class="sc">+</span>(<span class="fl">1.2</span><span class="sc">*</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
</div>
</div>
<div id="data-summary-statistics" class="section level2">
<h2>3. Data Summary Statistics</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>total_lineages<span class="ot">&lt;-</span><span class="fu">length</span>(new)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>total_lineages</span></code></pre></div>
<p>The mouse single-cell immune repertoire is composed of 1662 clonal lineages.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_total_lineages <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">total_lineages=</span>total_lineages,<span class="at">colors=</span><span class="fu">c</span>(<span class="st">&#39;black&#39;</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df_total_lineages<span class="sc">$</span>x_values <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;1&quot;</span>,<span class="at">each=</span><span class="fu">nrow</span>(df_total_lineages)))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df_total_lineages<span class="sc">$</span>colors<span class="ot">&lt;-</span><span class="fu">as.factor</span>(df_total_lineages<span class="sc">$</span>colors)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>p_total_lineages<span class="ot">&lt;-</span><span class="fu">ggplot</span>(df_total_lineages, <span class="fu">aes</span>(<span class="at">x =</span> x_values, <span class="at">y =</span>total_lineages ,<span class="at">fill=</span>colors)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Number of clonal lineages&quot;</span>)<span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">coord_cartesian</span>() <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add=</span><span class="fu">c</span>(<span class="fl">0.6</span>,<span class="fl">0.5</span>)))<span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width=</span><span class="fl">0.5</span>,<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span><span class="dv">1</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length=</span><span class="fu">unit</span>(.<span class="dv">3</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>))<span class="sc">+</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">levels</span>(df_total_lineages<span class="sc">$</span>colors))</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>p_total_lineages</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>bcells_per_clonal_lineage<span class="ot">&lt;-</span><span class="fu">unname</span>(<span class="fu">unlist</span>(<span class="fu">sapply</span>(new,<span class="cf">function</span>(z) <span class="fu">nrow</span>(z))))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Combinations=</span><span class="dv">1</span><span class="sc">:</span>total_lineages, <span class="at">Freq=</span>bcells_per_clonal_lineage)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>p_cells_all<span class="ot">&lt;-</span><span class="fu">ggplot</span>(df,<span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&#39;Combinations&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Freq&#39;</span>)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Clonal lineages&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Number of cells&quot;</span>)<span class="sc">+</span><span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">expand =</span> <span class="cn">FALSE</span> )<span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>,<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.length=</span><span class="fu">unit</span>(.<span class="dv">3</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),<span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span> <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Vertex Degrees&quot;</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>p_cells_all</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mean_bcells_per_clonal_lineage<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">mean</span>(bcells_per_clonal_lineage))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>mean_bcells_per_clonal_lineage</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>std_bcells_per_clonal_lineage<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">sd</span>(bcells_per_clonal_lineage))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>std_bcells_per_clonal_lineage </span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>unique_Ab_variants_per_clonal_lineage<span class="ot">&lt;-</span> <span class="fu">AbForests_UniqueAntibodyVariants</span>(new,<span class="st">&quot;isotype&quot;</span>,custom_mat,tie_flag,weight,random.seed,alg_opt,<span class="cn">NULL</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df_t<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">Combinations=</span><span class="dv">1</span><span class="sc">:</span>total_lineages, <span class="at">Freq=</span>unique_Ab_variants_per_clonal_lineage)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>p_variants_all<span class="ot">&lt;-</span><span class="fu">ggplot</span>(df_t,<span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&#39;Combinations&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Freq&#39;</span>)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Clonal lineages&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Number of unique </span><span class="sc">\n</span><span class="st"> antibody variants&quot;</span>)<span class="sc">+</span><span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">expand =</span> <span class="cn">FALSE</span> )<span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>,<span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),<span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">00</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),<span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span> <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Vertex Degrees&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df_mean_cells_variants <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Freq=</span><span class="fu">c</span>(bcells_per_clonal_lineage,unique_Ab_variants_per_clonal_lineage))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df_mean_cells_variants<span class="sc">$</span>sample_name <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;Cells&quot;</span>,<span class="at">each=</span><span class="fu">length</span>(bcells_per_clonal_lineage)),<span class="fu">rep</span>(<span class="st">&quot;Variants&quot;</span>,<span class="at">each=</span><span class="fu">length</span>(unique_Ab_variants_per_clonal_lineage)))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>df_mean_cells_variants<span class="sc">$</span>colors <span class="ot">&lt;-</span><span class="fu">as.vector</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&quot;black&quot;</span>,<span class="at">each=</span><span class="fu">length</span>(bcells_per_clonal_lineage)),<span class="fu">rep</span>(<span class="st">&quot;gray85&quot;</span>,<span class="at">each=</span><span class="fu">length</span>(unique_Ab_variants_per_clonal_lineage))))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>df_mean_cells_variants<span class="sc">$</span>colors<span class="ot">&lt;-</span><span class="fu">as.factor</span>(df_mean_cells_variants<span class="sc">$</span>colors) </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>p_mean_cells_variants<span class="ot">&lt;-</span><span class="fu">ggplot</span>(df_mean_cells_variants, <span class="fu">aes</span>(sample_name, Freq ,<span class="at">fill=</span>colors)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Number per clonal lineage&quot;</span>)<span class="sc">+</span> <span class="fu">coord_cartesian</span>() <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">stat =</span> <span class="st">&quot;summary&quot;</span>, <span class="at">fun.data =</span> <span class="st">&quot;mean_se&quot;</span>, </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">fun.args =</span> <span class="fu">list</span>(<span class="at">mult =</span> <span class="dv">1</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span><span class="st">&quot;dodge&quot;</span>, <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;summary&quot;</span>, <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span>, </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.2</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">name =</span> <span class="st">&quot;sample_name&quot;</span>) <span class="sc">+</span> </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,<span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),<span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.9</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),<span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>))<span class="sc">+</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">levels</span>(df_mean_cells_variants<span class="sc">$</span>colors))</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>p_mean_cells_variants</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>mean_unique_Ab_variants_per_clonal_lineage<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">mean</span>(unique_Ab_variants_per_clonal_lineage))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>mean_unique_Ab_variants_per_clonal_lineage </span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>std_unique_Ab_variants_per_clonal_lineage<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">sd</span>(unique_Ab_variants_per_clonal_lineage))</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>std_unique_Ab_variants_per_clonal_lineage </span></code></pre></div>
<p>Each clonal lineage has approximate on average 4 B cells and 3 clonal variants and considering standard deviation 11 B cells and 5 clonal variants.</p>
<p>From the iput list of clonal lineages, we can identify the clonal lineage, which contains the maximum number of cells:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>pos<span class="ot">&lt;-</span><span class="fu">which</span>(bcells_per_clonal_lineage <span class="sc">==</span> <span class="fu">max</span>(bcells_per_clonal_lineage[bcells_per_clonal_lineage<span class="sc">&gt;</span><span class="dv">0</span>]))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new[[pos]],<span class="dv">3</span>)</span></code></pre></div>
<p>And the clonal lineage, which contains the maximum number of unique antibody variants:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pos<span class="ot">&lt;-</span><span class="fu">which</span>(unique_Ab_variants_per_clonal_lineage <span class="sc">==</span> <span class="fu">max</span>(unique_Ab_variants_per_clonal_lineage[unique_Ab_variants_per_clonal_lineage<span class="sc">&gt;</span><span class="dv">0</span>]))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(new[[pos]],<span class="dv">3</span>)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>p_total_lineages <span class="ot">&lt;-</span> <span class="fu">arrangeGrob</span>(p_total_lineages, <span class="at">top =</span> <span class="fu">textGrob</span>(<span class="st">&quot;A&quot;</span>, <span class="at">x =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;npc&quot;</span>),<span class="at">y=</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">just=</span><span class="fu">c</span>(<span class="st">&quot;left&quot;</span>,<span class="st">&quot;top&quot;</span>),                                 <span class="at">gp=</span><span class="fu">gpar</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">fontsize=</span><span class="dv">12</span>, <span class="at">fontfamily=</span><span class="st">&quot;Times&quot;</span>)))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>p_cells_all <span class="ot">&lt;-</span> <span class="fu">arrangeGrob</span>(p_cells_all, <span class="at">top =</span> <span class="fu">textGrob</span>(<span class="st">&quot;B&quot;</span>, <span class="at">x =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">y =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">just=</span><span class="fu">c</span>(<span class="st">&quot;left&quot;</span>,<span class="st">&quot;top&quot;</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="at">gp=</span><span class="fu">gpar</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">fontsize=</span><span class="dv">12</span>, <span class="at">fontfamily=</span><span class="st">&quot;Times&quot;</span>)))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>p_variants_all <span class="ot">&lt;-</span> <span class="fu">arrangeGrob</span>(p_variants_all, <span class="at">top =</span> <span class="fu">textGrob</span>(<span class="st">&quot;C&quot;</span>, <span class="at">x =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;npc&quot;</span>),<span class="at">y  =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">just=</span><span class="fu">c</span>(<span class="st">&quot;left&quot;</span>,<span class="st">&quot;top&quot;</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="at">gp=</span><span class="fu">gpar</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">fontsize=</span><span class="dv">12</span>, <span class="at">fontfamily=</span><span class="st">&quot;Times&quot;</span>)))</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>p_mean_cells_variants <span class="ot">&lt;-</span> <span class="fu">arrangeGrob</span>(p_mean_cells_variants, <span class="at">top =</span> <span class="fu">textGrob</span>(<span class="st">&quot;D&quot;</span>, <span class="at">x =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">y =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">just=</span><span class="fu">c</span>(<span class="st">&quot;left&quot;</span>,<span class="st">&quot;top&quot;</span>),<span class="at">gp=</span><span class="fu">gpar</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>,<span class="at">fontsize=</span><span class="dv">12</span>, <span class="at">fontfamily=</span><span class="st">&quot;Times&quot;</span>)))</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p_total_lineages,p_cells_all,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>            p_variants_all,p_mean_cells_variants,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="sub-repertoire-analysis" class="section level2">
<h2>4. Sub-repertoire analysis</h2>
<p>To determine whether the evolution of IgG, IgA and IgM clonal lineages underwent distinct selection processes, we classified B cell lineages by majority isotype, defined as the isotype per clonal lineage with the highest number of distinct cell barcodes.</p>
<p>The clonal lineages can be split into 5 subrepertoires. Each subrepertoire is dominated by the following isotypes: IgG, IgA, IgM and other types.</p>
<ul>
<li>In case, there is an equal number of IgA and IgG isotypes in a clonal lineage, a separate category is created</li>
<li>In case there exists a tie in the number of IgA and IgM isotypes in a clonal lineage, this lineage is considered as IgA majority isotype</li>
<li>In case there exists a tie in the number of IgG and IgM isotypes in a clonal lineage, this lineage is considered as IgG majority isotype</li>
</ul>
<p>SubRepertoiresByCells function assigns clonal lineages into sub-repertoires by isotype based on number of B cells.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>repert<span class="ot">&lt;-</span> <span class="fu">AbForests_SubRepertoiresByCells</span>(new)</span></code></pre></div>
<p>The isotype distinction that we assumed is based on the immunological background of the different isotypes. In particular, IgG isotype is the most abundant antibody in the serum and together with IgA isotype are expressed via class switching after antigen challenge. IgM isotype is expressed on naive cells, is present early in the B cell response and is highly reactive to various antigens, without assistance from T cells.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>total_lineages_per_isotype<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">lapply</span>(repert, <span class="cf">function</span>(x) <span class="fu">length</span>(x)))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>total_lineages_per_isotype</span></code></pre></div>
<p>This sub-categorization resulted in 1140 IgG majority clonal lineages, 163 IgA majority clonal lineages and 330 IgM majority clonal lineages.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_clon_lineages_isotype <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Strategies=</span> <span class="fu">c</span>(<span class="st">&quot;IgG&quot;</span>,<span class="st">&quot;IgA&quot;</span>,<span class="st">&quot;IgM&quot;</span>),<span class="at">Freq=</span><span class="fu">unname</span>(total_lineages_per_isotype[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]),<span class="at">colors=</span><span class="fu">c</span>(<span class="st">&quot;green1&quot;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&quot;purple&quot;</span>))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df_clon_lineages_isotype<span class="sc">$</span>colors<span class="ot">&lt;-</span><span class="fu">as.factor</span>(df_clon_lineages_isotype<span class="sc">$</span>colors)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>p_clon_lineages_isotype<span class="ot">&lt;-</span><span class="fu">ggplot</span>(df_clon_lineages_isotype, <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&#39;Strategies&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Freq&#39;</span>, <span class="at">fill=</span><span class="st">&#39;colors&#39;</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;# of clonal lineages </span><span class="sc">\n</span><span class="st"> before filetering&quot;</span>)<span class="sc">+</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width=</span><span class="fl">0.6</span>,<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>()<span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add=</span><span class="fu">c</span>(<span class="fl">0.6</span>,<span class="fl">0.5</span>)))<span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span>  </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="dv">1</span>,<span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),<span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),<span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>))<span class="sc">+</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">levels</span>(df_clon_lineages_isotype<span class="sc">$</span>colors))</span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>list6<span class="ot">&lt;-</span><span class="fu">AbForests_ConvertStructure</span>(repert,<span class="st">&quot;isotype&quot;</span>,<span class="cn">NULL</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>rev_rep<span class="ot">&lt;-</span><span class="fu">AbForests_RemoveNets</span>(list6,<span class="st">&quot;isotype&quot;</span>,custom_mat,tie_flag,weight,<span class="cn">NULL</span>,<span class="dv">6</span>,random.seed,alg_opt)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>remained_lineages_per_isotype<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">lapply</span>(rev_rep, <span class="cf">function</span>(x) <span class="fu">length</span>(x)))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>remained_lineages_per_isotype</span></code></pre></div>
<p>After eliminating the lineages with less than 6 unique cells, only 222, 23 and 30 clonal lineages remained in each of IgG, IgA and IgM sub-repertoires.</p>
<p>Prior to filtering, ConvertStructure function converts input data to the approriate format when the user desires to alter input data. Specifically, the function recovers the isotype/transcriptional cluster information and the full-length antibody sequences.</p>
<p>The filtering of networks with less than 6 unique cells leads to the elimination of those small networks which are less informative and convey a limited potential diversity in the structure of the network. On the other hand, the comparison of multiple identical sized networks consisting of few nodes, allows to extract identical properties among those networks such as path lengths. A valid threshold value in the filtering is often less clear to determine, but increasing the lower bound on the number of unique sequences within a clone increases exponentially the number of distinct possible graph topologies and therefore the likelihood of recognizing meaningful patterns in the graphs.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_clon_lineages_isotype_after <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Strategies=</span><span class="fu">c</span>(<span class="st">&quot;IgG&quot;</span>,<span class="st">&quot;IgA&quot;</span>,<span class="st">&quot;IgM&quot;</span>), <span class="at">Freq=</span><span class="fu">unname</span>(remained_lineages_per_isotype[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]),<span class="at">colors=</span><span class="fu">c</span>(<span class="st">&quot;green1&quot;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&quot;purple&quot;</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>df_clon_lineages_isotype_after<span class="sc">$</span>colors <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(df_clon_lineages_isotype_after<span class="sc">$</span>colors)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>p_clon_lineages_isotype_after<span class="ot">&lt;-</span><span class="fu">ggplot</span>(df_clon_lineages_isotype_after, <span class="fu">aes_string</span>(<span class="at">x =</span> <span class="st">&#39;Strategies&#39;</span>, <span class="at">y =</span> <span class="st">&#39;Freq&#39;</span>,<span class="at">fill=</span><span class="st">&#39;colors&#39;</span>)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;# of clonal lineages </span><span class="sc">\n</span><span class="st"> after filtering&quot;</span>)<span class="sc">+</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width=</span><span class="fl">0.6</span>,<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>()<span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add=</span><span class="fu">c</span>(<span class="fl">0.6</span>,<span class="fl">0.5</span>)))<span class="sc">+</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>, <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),<span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),<span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>))<span class="sc">+</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">levels</span>(df_clon_lineages_isotype_after<span class="sc">$</span>colors))</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>percent_remained<span class="ot">&lt;-</span><span class="fu">unlist</span>(<span class="fu">mapply</span>(<span class="st">&quot;/&quot;</span>,remained_lineages_per_isotype[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],total_lineages_per_isotype[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],<span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>))</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>df_percent_remained <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Strategies=</span><span class="fu">c</span>(<span class="st">&quot;IgG&quot;</span>,<span class="st">&quot;IgA&quot;</span>,<span class="st">&quot;IgM&quot;</span>),<span class="at">Freq=</span><span class="fu">unlist</span>(<span class="fu">unname</span>(percent_remained)),<span class="at">colors=</span><span class="fu">c</span>(<span class="st">&quot;green1&quot;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&quot;purple&quot;</span>))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>df_percent_remained[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(df_percent_remained, <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="fu">is.numeric</span>(x)) x<span class="sc">*</span><span class="dv">100</span> <span class="cf">else</span> x)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>df_percent_remained<span class="sc">$</span>colors <span class="ot">&lt;-</span> <span class="fu">factor</span>(df_percent_remained<span class="sc">$</span>colors, <span class="at">levels =</span> df_percent_remained<span class="sc">$</span>colors)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>p_rem<span class="ot">&lt;-</span><span class="fu">ggplot</span>(df_percent_remained, <span class="fu">aes</span>(<span class="at">x =</span> Strategies, <span class="at">y =</span> Freq, <span class="at">fill=</span> colors)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;% of clonal lineages </span><span class="sc">\n</span><span class="st"> after filtering&quot;</span>)<span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width=</span><span class="fl">0.5</span>,<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position=</span><span class="st">&quot;dodge&quot;</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>()<span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add=</span><span class="fu">c</span>(<span class="fl">0.6</span>,<span class="fl">0.5</span>)))<span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio=</span><span class="dv">1</span>,<span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x=</span><span class="fu">element_blank</span>(),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>,<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>),</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),<span class="at">legend.title=</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>,<span class="at">face=</span><span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">levels</span>(df_percent_remained<span class="sc">$</span>colors))</span></code></pre></div>
<div id="sub-repertoire-statistics" class="section level3">
<h3>Sub-repertoire Statistics</h3>
<p>The subrepertoires statistics are summarized below.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>p_clon_lineages_isotype <span class="ot">&lt;-</span> <span class="fu">arrangeGrob</span>(p_clon_lineages_isotype, <span class="at">top =</span> <span class="fu">textGrob</span>(<span class="st">&quot;A&quot;</span>, <span class="at">x =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">y =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">just=</span><span class="fu">c</span>(<span class="st">&quot;left&quot;</span>,<span class="st">&quot;top&quot;</span>),<span class="at">gp=</span><span class="fu">gpar</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>, <span class="at">fontsize=</span><span class="dv">12</span>, <span class="at">fontfamily=</span><span class="st">&quot;Times&quot;</span>)))</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>p_clon_lineages_isotype_after <span class="ot">&lt;-</span> <span class="fu">arrangeGrob</span>(p_clon_lineages_isotype_after, <span class="at">top =</span> <span class="fu">textGrob</span>(<span class="st">&quot;B&quot;</span>, <span class="at">x =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">y =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">just=</span><span class="fu">c</span>(<span class="st">&quot;left&quot;</span>,<span class="st">&quot;top&quot;</span>), <span class="at">gp=</span><span class="fu">gpar</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>,<span class="at">fontsize=</span><span class="dv">12</span>, <span class="at">fontfamily=</span><span class="st">&quot;Times&quot;</span>)))</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>p_rem <span class="ot">&lt;-</span> <span class="fu">arrangeGrob</span>(p_rem, <span class="at">top =</span> <span class="fu">textGrob</span>(<span class="st">&quot;C&quot;</span>, <span class="at">x =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">&quot;npc&quot;</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>, <span class="at">y =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>), <span class="at">just=</span><span class="fu">c</span>(<span class="st">&quot;left&quot;</span>,<span class="st">&quot;top&quot;</span>),  <span class="at">gp=</span><span class="fu">gpar</span>(<span class="at">col=</span><span class="st">&quot;black&quot;</span>,    <span class="at">fontsize=</span><span class="dv">12</span>, <span class="at">fontfamily=</span><span class="st">&quot;Times&quot;</span>)))</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p_clon_lineages_isotype,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>            p_clon_lineages_isotype_after,p_rem, <span class="at">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<p>Consequently, the categorization of most clonal lineages as IgG majority and the subsequent filtering of networks with less than 6 unique cells, elevated the number of clonal variants in each network only in the IgG and IgA lineages. We were therefore able to demonstrate that class-switched B cells clones underwent further diversification of their unique BCR sequences.</p>
</div>
</div>
<div id="network-inference" class="section level2">
<h2>5. Network inference</h2>
<p>Within a single repertoire, there exists a multitude of co-evolving clonal lineages, each of which consists of B cells descending from an independent V(D)J recombination event and can therefore be modeled into a single network. Each network represents the evolutionary trajectory following somatic hypermutation relative to an unmutated, reference germline. Vertices refer to unique appended full-length variable heavy and variable light chain (<span class="math inline">\(V_H\)</span> + <span class="math inline">\(V_L\)</span>) antibody sequences, which can be either internal or terminal nodes in the network, thereby diverging from the traditional B cell phylogenies. Edges connect clonal variants with the smallest separation similarity, computed by the edit distance under default parameters. The reconstruction of networks is based on 2 node and edge selection algorithms , which maintain the principles of Directed Acyclic Graphs (DAGs), therefore eliminating potential bidirectional cycles.</p>
<div id="naive-algorithm" class="section level3">
<h3>Naive Algorithm</h3>
<p>The default graph construction algorithm initially collapses unique antibody sequences, while preserving pivotal information on properties of the networks such as the clonal expansion of clonal variants, defined as the amount of cells corresponding to each unique antibody, the distribution of isotypes and the length of their antibody sequences. A symmetric distance matrix is then calculated, depicting the number of mutations between all unique antibody sequences and reference germline, within one clonal family. The default method to compute the distance matrix is the Levenshtein distance (Levenshtein, 1966), which counts the number of per letter transformations between strings to quantify their dissimilarity. Edge weights are extracted from the distance matrix apart from the special case of the unmutated germline. Weights of outgoing edges of germline nodes are either set to 1 (weight=FALSE) or to the difference between the corresponding distance from the matrix and the absolute value of the difference between the sequence lengths of germline and corresponding connected nodes (weight=TRUE).</p>
<p>Starting from the germline node, the closest sequences, according to distance matrix calculations, are assigned to the set of already examined nodes in the graph. For each element in the set of current nodes and for all combinations with the remaining nodes, edges with the minimum distance are sequentially added in the graph. This procedure is repeated until all nodes have been examined. Ties between distances are resolved randomly under default parameters, but additionally can be resolved using other immune repertoire features.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>graphs_IGHG<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(<span class="cn">NULL</span>,<span class="cn">FALSE</span>,rev_rep<span class="sc">$</span>list_IGHG,custom_mat,clonal_frequency,scaleByClonalFreq,weight,tie_flag,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;isotype&quot;</span>,random.seed,alg_opt,<span class="cn">NULL</span>)</span></code></pre></div>
<p>The AntibodyForest function apart from the construction of networks, provides essential information on the structure and properties of networks. Such information is summarized below.</p>
<ul>
<li><p>graphs_IGHG<span class="math inline">\([[1][[1]]\)</span> -&gt; network: an igraph object, containing the first network in tree format</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[2]]\)</span> -&gt; legend: contains the legend parameters of the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[3]]\)</span> -&gt; count.rand: contains the number of randomly considered nodes for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[4]]\)</span> -&gt; adj.matrix: contains the adjacency matrix for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[5]]\)</span> -&gt; distance.matrix: contains the distance matrix for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[6]]\)</span> -&gt; cells.per.network: contains the number of cells for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[7]]\)</span> -&gt; variants.per.network: contains the number of variants for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[8]]\)</span> -&gt; variant.sequences: contains the sequences of the variants for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[9]]\)</span> -&gt; cells.per.variant: contains the number of cells per variant (clonal frequency) for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[10]]\)</span> -&gt; cell.indicies.per.variant: the indices of cells per variant for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[11]]\)</span> -&gt; new.variant.names: contains the names of variants for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[12]]\)</span> -&gt; germline.index: contains the index of germline sequence for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[13]]\)</span> -&gt; isotype.per.variant: contains the isotypes corresponding to each variant for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[14]]\)</span> -&gt; transcriptome.cluster.per.variant: contains the transcriptional clusters corresponding to each variant for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[15]]\)</span> -&gt; isotype.per.cell: contains the isotype corresponding to each cell for the first network</p></li>
<li><p>graphs_IGHG<span class="math inline">\([[1]][[16]]\)</span> -&gt; transcriptome.cluster.per.cell: contains the transcriptional cluster corresponding to each cell for the first network</p></li>
</ul>
<p>Example networks are provided, highlighting the complexity of the LCVM dataset. Nodes are both labeled and scaled by the clonal frequency. The scaling of nodes by their relative clonal expansion assists in pinpointing identical antibody sequences produced by multiple B cells.</p>
<ol style="list-style-type: lower-alpha">
<li>This is an example network from the IgG-sub-repertoire that contains highly clonally expanded variants.</li>
</ol>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.0001</span><span class="sc">*</span>graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">17</span><span class="sc">+</span>(<span class="fl">0.8</span><span class="sc">*</span>igraph<span class="sc">::</span><span class="fu">V</span>(graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network)<span class="sc">$</span>size),<span class="at">layout=</span><span class="fl">0.05</span><span class="sc">*</span>graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network<span class="sc">$</span>layout)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty =</span> graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_IGHG[<span class="dv">11</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>This is an example network from the IgG-sub-repertoire that contains multiple dictinct isotypes.</li>
</ol>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.0001</span><span class="sc">*</span>graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">17</span><span class="sc">+</span>(<span class="fl">0.8</span><span class="sc">*</span>igraph<span class="sc">::</span><span class="fu">V</span>(graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network)<span class="sc">$</span>size),<span class="at">layout=</span><span class="fl">0.05</span><span class="sc">*</span>graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network<span class="sc">$</span>layout)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty =</span> graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_IGHG[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: lower-alpha">
<li>This is an example network from the IgM-sub-repertoire that contains highly clonally expanded variants.</li>
</ol>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>graphs_IGHM<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(<span class="cn">NULL</span>,<span class="cn">FALSE</span>,rev_rep<span class="sc">$</span>list_IGHM,custom_mat,clonal_frequency,scaleByClonalFreq,weight,tie_flag,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;isotype&quot;</span>,random.seed,alg_opt,<span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.0001</span><span class="sc">*</span>graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">17</span><span class="sc">+</span>(<span class="fl">0.8</span><span class="sc">*</span>igraph<span class="sc">::</span><span class="fu">V</span>(graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network)<span class="sc">$</span>size),<span class="at">layout=</span><span class="fl">0.05</span><span class="sc">*</span>graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network<span class="sc">$</span>layout)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty =</span> graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_IGHM[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
<p>The package provides additional scaling and labeling options of nodes.</p>
<p>Relating the size of nodes with centrality metrics highlights the importance of certain nodes in the network. The measurement of node importance is of great practical and theoretical significance in identifying how individual nodes influence network structure and functionality, thereby describing the robustness of the network.</p>
<p>Therefore, the size of vertices can also depend on vertex betweenness (computed by counting the number of shortest paths going through a vertex (Freeman, 1979)) and vertex closeness (measured by the number of shortest paths going through each edge (Freeman, 1979)).</p>
<p>Node labeling can be also based on the traversal order of nodes specified by the utilized algorithm. This option facilitates the the detection of modifications in the topology of networks.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Scaling of nodes by vertex betweenness and labeling based on traversal order of nodes in the naive algorithm </span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>graphs_IGHM_new<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(<span class="cn">NULL</span>,<span class="cn">FALSE</span>,rev_rep<span class="sc">$</span>list_IGHM,custom_mat,<span class="at">clonal_frequency=</span><span class="cn">FALSE</span>,<span class="at">scaleByClonalFreq=</span><span class="cn">FALSE</span>,weight,tie_flag,<span class="at">scaleBybetweenness=</span><span class="cn">TRUE</span>,<span class="at">scaleByclocloseness_metr=</span><span class="cn">FALSE</span>,<span class="st">&quot;isotype&quot;</span>,random.seed,alg_opt,<span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.0001</span><span class="sc">*</span>graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">17</span><span class="sc">+</span>(<span class="fl">0.8</span><span class="sc">*</span>igraph<span class="sc">::</span><span class="fu">V</span>(graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network)<span class="sc">$</span>size),<span class="at">layout=</span><span class="fl">0.05</span><span class="sc">*</span>graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network<span class="sc">$</span>layout)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty =</span> graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_IGHM_new[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
</div>
<div id="two-step-algorithm" class="section level3">
<h3>Two-step Algorithm</h3>
<p>The two-step algorithm relies on the same concept, but completes the network construction in a multi-level fashion. Resolving ties in the distance matrix is handled in a second step. Edges rendering nodes with multiple parents are eliminated, forcing each antibody variant to descend from a single parent. Consequently, AbNetForests supports various customizable options that enable the user to select whether mutational load, clonal expansion, random selection or no selection at all dictates graph topology. In case of subsequent ties, a random node is selected.</p>
<ol style="list-style-type: decimal">
<li>“rand” option allows the random selection of one child node</li>
<li>“full” option allows keeping all children nodes</li>
<li>“close_to_germ” and “far_from_germ” options allow the pruning of farthest and closest nodes relative to the germline, respectively, based on the number of intermediate nodes in the path.</li>
<li>“close_path_to_germ” and “far_path_from_germ” options allow the pruning of farthest and closest nodes relative to the germline, respectively, based on the weighted or unweighted edge path length.</li>
<li>“most_expanded” and “least_expanded” options allow the pruning of nodes with the lowest B cell count and the highest B cell count, respectively.</li>
</ol>
<p>Tie resolving options 3 and 4 are utilized to incorporate information regarding deep (a single variant continues to linearly produce new progeny) versus broad (a single variant produces multiple direct progeny) selection, while option 5 resolves ties by assuming that either the most expanded or least expanded clones contribute to new variants. Closeness of a node to germline node, as described in tie case 3, means identifying the minimum number of edges in the path between the node and germline, whereas in tie case 4 the minimum weighted path length between the node and germline.</p>
<p>Therefore, using the 2-step algorithm and preserving the option to resolve ties randomly influnces the topology of networks</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>graphs_IGHG_2<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(<span class="cn">NULL</span>,<span class="cn">FALSE</span>,rev_rep<span class="sc">$</span>list_IGHG,custom_mat,clonal_frequency,scaleByClonalFreq,weight,tie_flag,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;isotype&quot;</span>,random.seed,<span class="at">alg_opt=</span><span class="st">&quot;two-step&quot;</span>,<span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.0001</span><span class="sc">*</span>graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">17</span><span class="sc">+</span>(<span class="fl">0.8</span><span class="sc">*</span>igraph<span class="sc">::</span><span class="fu">V</span>(graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network)<span class="sc">$</span>size),<span class="at">layout=</span><span class="fl">0.05</span><span class="sc">*</span>graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network<span class="sc">$</span>layout)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty =</span> graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_IGHG_2[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
<p>The graph topology can also be altered under different tie resolving cases. For example, changing the option to resolve ties by removing the farthest node(s) from germline (“close_to_germ”) influnces the topology of networks:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>graphs_IGHG_close_germ<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(<span class="cn">NULL</span>,<span class="cn">FALSE</span>,rev_rep<span class="sc">$</span>list_IGHG,custom_mat,clonal_frequency,scaleByClonalFreq,weight,<span class="at">tie_flag=</span><span class="st">&quot;close_to_germ&quot;</span>,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;isotype&quot;</span>,random.seed,<span class="at">alg_opt=</span><span class="st">&quot;two-step&quot;</span>,<span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.0001</span><span class="sc">*</span>graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">17</span><span class="sc">+</span>(<span class="fl">0.8</span><span class="sc">*</span>igraph<span class="sc">::</span><span class="fu">V</span>(graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network)<span class="sc">$</span>size),<span class="at">layout=</span><span class="fl">0.05</span><span class="sc">*</span>graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network<span class="sc">$</span>layout)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty =</span> graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_IGHG_close_germ[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
<p>A user may does not want to add all these biases, thus the package can generate networks without resolving ties. These networks are not directed acyclic any more as they contain bi-directional cycles.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>graphs_IGHG_full<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(<span class="cn">NULL</span>,<span class="cn">FALSE</span>,rev_rep<span class="sc">$</span>list_IGHG,custom_mat,clonal_frequency,scaleByClonalFreq,weight,<span class="at">tie_flag=</span><span class="st">&quot;full&quot;</span>,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;isotype&quot;</span>,random.seed,<span class="at">alg_opt=</span><span class="st">&quot;two-step&quot;</span>,<span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.0001</span><span class="sc">*</span>graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">17</span><span class="sc">+</span>(<span class="fl">0.8</span><span class="sc">*</span>igraph<span class="sc">::</span><span class="fu">V</span>(graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network)<span class="sc">$</span>size),<span class="at">layout=</span><span class="fl">0.05</span><span class="sc">*</span>graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network<span class="sc">$</span>layout)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty =</span> graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_IGHG_full[<span class="dv">104</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
</div>
</div>
<div id="calculation-of-network-metrics" class="section level2">
<h2>6. Calculation of network metrics</h2>
<p>Following the construction of the mutational networks, AbNetForests calculates and visualizes summary statistics, which provides the opportunity for both qualitative and quantitative comparison of the evolutionary relationships among antibodies. The tool extracts the topologies of individual networks within the repertoire and links them with clonal expansion, distance from the reference germline, isotype distribution and transcriptional phenotype. Specifically, the following metrics are computed for all networks:</p>
<ol style="list-style-type: decimal">
<li>weighted/unweighted longest path(s) from germline. Longest path is defined as the path with the maximum length between all shortest paths from the germline node to all other nodes. Shortest path is a path with the minimal number of edges. In case of unweighted graphs, the breadth-first search algorithm is used, while for weighted graphs Dijkstra’s algorithm is utilized</li>
<li>length of weighted/ unweighted longest shortest path from germline</li>
<li>average/standard deviation/minimum/maximum number of daughter cells. These metrics are computed with the aid of the most fundamental graph property, the vertex degree, which is defined as the number of the adjacent edges of the node</li>
<li>weighted vertex degree or strength. It is calculated by summing up the edge weights of the adjacent edges for each vertex (Barrat et al., 2004)</li>
<li>average number of isotypes and/or clusters. For each network, the occurrences of distinct isotypes or clusters are counted and divided by the number of nodes</li>
<li>informative data.frame for isotypes and/or clusters, which contains the type of isotypes/clusters for each pair of nodes in the graph (Parent-Child relationship in the graph)</li>
<li>vertex betweenness centrality</li>
<li>edge betweenness centrality. It is measured by the number of shortest paths going through each edge (Freeman, 1979)</li>
<li>closeness centrality of vertices</li>
<li>global/average clustering coefficient. To compute clustering coefficients, transitivity is measured by specifying the probability of adjacent vertices of a vertex to be connected. Global transitivity is the ratio of triangles and connected triples in the graph, while local transitivity follows the same definition but centered on the vertex level (for directed graphs, the direction of the edges is ignored)</li>
<li>mean clonal expansion. It is calculated as the mean value of clonal frequencies of all vertices in the network</li>
<li>ratios of number of edges from germline to each node divided by the respective clonal frequency of each node</li>
<li>mean ratio of the number of edges from germline to each node divided byclonal frequency (mean ratio of values in metric 12).</li>
<li>mean number of edges from germline for all nodes in the network</li>
<li>ratios of total path length from germline to each node divided by the respective clonal frequency of each node</li>
<li>mean ratio: total path length from germline to each node divided by the respective clonal frequency of each node (mean ratio of values in metric 15)</li>
<li>mean total path length from germline for all nodes in the network</li>
</ol>
<p>The metrics for the IgG subrepertoire are summarized below</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>metrics_igg<span class="ot">&lt;-</span><span class="fu">AbForests_ForestMetrics</span>(graphs_IGHG,DAG,clonal_frequency,scaleByClonalFreq,weight,tie_flag,<span class="st">&quot;isotype&quot;</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>metrics_igg[[<span class="dv">1</span>]]<span class="sc">$</span><span class="st">`</span><span class="at">Mean Total path length from germline</span><span class="st">`</span></span></code></pre></div>
<p>Another example metric is the distribution of distinct isotypes versus their frequency</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>metrics_igg[[<span class="dv">1</span>]]<span class="sc">$</span><span class="st">`</span><span class="at">Plot: Distribution of isotypes</span><span class="st">`</span></span></code></pre></div>
</div>
<div id="comparison-of-networks" class="section level2">
<h2>7. Comparison of networks</h2>
<p>We can also compare the repertoires of distinct B cells. In this case, we compare the IgG and IgM subreperoires using the CompareForests function</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>output<span class="ot">&lt;-</span><span class="fu">AbForests_CompareForests</span>(graphs_IGHG,graphs_IGHM,DAG,clonal_frequency,scaleByClonalFreq,weight,tie_flag,<span class="st">&quot;isotype&quot;</span>)</span></code></pre></div>
<p>CompareForests function has 3 outputs</p>
<ul>
<li>combined_df, a data.frame that summarizes metrics for both repertoires. In particular, each row represents a single network and networks of both repertoires are combined row-wise. It has the following columns:</li>
</ul>
<ol style="list-style-type: decimal">
<li>Weighted.Longest.path.from.germline</li>
<li>Length.of.weighted.longest.shortest.path.from.germline</li>
<li>Unweighted.Longest.path.from.germline</li>
<li>Length.of.unweighted.longest.shortest.path.from.germline</li>
<li>Average.number.of.daughter.cells</li>
<li>Std.number.of.daughter.cells</li>
<li>Min.number.of.daughter.cells</li>
<li>Max.number.of.daughter.cells</li>
<li>Weighted.vertex.degree</li>
<li>Average.number.of.clusters/isotypes</li>
<li>Isotypes/Clusters.info</li>
<li>vertex.betweenness.centrality</li>
<li>edge.betweenness.centrality</li>
<li>closeness.centrality.of.vertices</li>
<li>global.clustering.coefficient</li>
<li>average.clustering.coefficient</li>
<li>Mean.clonal.expansion</li>
</ol>
<p>If the labeling or scaling of nodes in graph is based on clonal frequency (arguments: clonal_frequency==TRUE or scaleByClonalFreq==TRUE), then combined_df contains also:</p>
<ol start="18" style="list-style-type: decimal">
<li>Ratio.Number.of.edges.from.germline.to.each.node.with.clonal.frequency</li>
<li>Mean.Ratio.Number.of.edges.from.germline.to.each.node.with.clonal.frequency</li>
<li>Mean.number.of.edges.from.germline</li>
<li>Ratio.Total.path.length.from.germline.to.each.node.with.clonal.frequency</li>
<li>Mean.Ratio.Total.path.length.from.germline.to.each.node.with.clonal.frequency</li>
<li>Mean.Total.path.length.from.germline</li>
<li>Repertoire.id</li>
<li>Number.of.sequences</li>
</ol>
<ul>
<li>isotype_info_rep1, a data.frame that summarizes the isotype/cluster info for the IgG sub-repertoire</li>
<li>isotype_info_rep2, a data.frame that summarizes the isotype/cluster info for the IgM sub-repertoire</li>
</ul>
</div>
<div id="custom-node-coloring" class="section level2">
<h2>8. Custom node coloring</h2>
<p>For visualization purposes only, AbNetForests can color network nodes not only based on isotype or transcriptional cluster information, but also based on any data column. This is achieved by allowing the user to specify the name of the column of interest. The possibility of custom coloring is supported for both possible input formats either as a list of dfs or a list of csv files.</p>
<p>For the lcmv dataset, if we want to color nodes based on VDJ_jgene, then</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>graphs_custom<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(new,<span class="cn">FALSE</span>,<span class="cn">NULL</span>,custom_mat,clonal_frequency,scaleByClonalFreq,weight,tie_flag,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;VDJ_jgene&quot;</span>,random.seed,alg_opt,<span class="cn">NULL</span>)</span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.0001</span><span class="sc">*</span>graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">17</span><span class="sc">+</span>(<span class="fl">0.8</span><span class="sc">*</span>igraph<span class="sc">::</span><span class="fu">V</span>(graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network)<span class="sc">$</span>size),<span class="at">layout=</span><span class="fl">0.05</span><span class="sc">*</span>graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network<span class="sc">$</span>layout)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty =</span> graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_custom[<span class="dv">14</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
<p>For the csv files, we can color based on LCvgene</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>graphs_csv<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(files,<span class="cn">TRUE</span>,<span class="cn">NULL</span>,custom_mat,clonal_frequency,scaleByClonalFreq,weight,tie_flag,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;LCvgene&quot;</span>,random.seed,alg_opt,<span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.0001</span><span class="sc">*</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">17</span><span class="sc">+</span>(<span class="fl">0.8</span><span class="sc">*</span>igraph<span class="sc">::</span><span class="fu">V</span>(graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network)<span class="sc">$</span>size),<span class="at">layout=</span><span class="fl">0.05</span><span class="sc">*</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network<span class="sc">$</span>layout)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty =</span> graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_csv[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.7</span>)</span></code></pre></div>
</div>
<div id="other-package-functionality" class="section level2">
<h2>9. Other package functionality</h2>
<p>In case the user wants to perform changes in the input data, for a list of csvs as input, similar to the provided data, the CsvToDf function is first used to transform the input list to a list of data.frames, with the appropriate format.</p>
<p>In addition, there is the option to split a single cell immune repertoire into sub-repertoires by isotype based on the number of unique sequences instead of the number of B cells, using the SubRepertoiresByUniqueSeq function.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>repert<span class="ot">&lt;-</span><span class="fu">AbForests_SubRepertoiresByUniqueSeq</span>(new,<span class="st">&quot;isotype&quot;</span>,custom_mat,tie_flag,weight,random.seed,alg_opt,<span class="dv">0</span>)</span></code></pre></div>
<p>We can also filter those networks with less than N unique sequences apart from the elimination of networks with less than C unique cells.</p>
<p>In PlotGraphs function, parameter topdf=FALSE would enable the user to print the network in the console (This parameter option is not advised for large input lists).</p>
<p>The previously additional functionality of the package is summarized below, taking into account the transcriptional cluster information and removing the networks with less than 4 unique BCR sequences.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>list_scv<span class="ot">&lt;-</span><span class="fu">AbForests_CsvToDf</span>(files) </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>list6<span class="ot">&lt;-</span><span class="fu">AbForests_ConvertStructure</span>(list_scv,<span class="st">&quot;cluster&quot;</span>,<span class="dv">0</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>rev_rep<span class="ot">&lt;-</span><span class="fu">AbForests_RemoveNets</span>(list6,<span class="st">&quot;cluster&quot;</span>,custom_mat,tie_flag,weight,<span class="dv">4</span>,<span class="cn">NULL</span>,random.seed,alg_opt)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>graphs_csv_less_4<span class="ot">&lt;-</span><span class="fu">AbForests_AntibodyForest</span>(<span class="cn">NULL</span>,<span class="cn">FALSE</span>,rev_rep,custom_mat,clonal_frequency,scaleByClonalFreq,weight,tie_flag,scaleBybetweenness,scaleByclocloseness_metr,<span class="st">&quot;cluster&quot;</span>,random.seed,alg_opt,<span class="dv">0</span>)</span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>igraph<span class="sc">::</span><span class="fu">plot.igraph</span>(graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network,<span class="at">vertex.label.cex=</span><span class="dv">1</span><span class="sc">+</span>(<span class="fl">0.0001</span><span class="sc">*</span>graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>cells.per.variant),<span class="at">vertex.size=</span><span class="dv">17</span><span class="sc">+</span>(<span class="fl">0.8</span><span class="sc">*</span>igraph<span class="sc">::</span><span class="fu">V</span>(graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network)<span class="sc">$</span>size),<span class="at">layout=</span><span class="fl">0.05</span><span class="sc">*</span>graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>network<span class="sc">$</span>layout)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">1</span>]],<span class="at">bty =</span> graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">2</span>]],<span class="at">legend=</span>graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">3</span>]],<span class="at">fill=</span>graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">4</span>]],<span class="at">border=</span>graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">5</span>]],<span class="at">inset=</span>graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">6</span>]],<span class="at">xpd=</span>graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">7</span>]],<span class="at">title=</span>graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend<span class="sc">$</span>title,<span class="at">cex=</span>graphs_csv_less_4[<span class="dv">1</span>][[<span class="dv">1</span>]]<span class="sc">$</span>legend[[<span class="dv">10</span>]]<span class="sc">*</span><span class="fl">0.26</span>)</span></code></pre></div>
</div>
<div id="custom-distance-matrix" class="section level2">
<h2>10. Custom distance matrix</h2>
<p>AbNetForests allows the investigation of other mutational models, more appropriate for antibodies, apart from the previously considered one, receiving as input a custom distance matrix per each network. The user is responsible for providing a distance matrix with the appropriate dimensions.</p>
</div>
<div id="converting-phylogenetic-tree-to-custom-distance-matrix" class="section level2">
<h2>11. Converting phylogenetic tree to custom distance matrix</h2>
<p>Finally, there is the option to convert a previously existing phylogenetic tree to a corresonding distance matrix, utilizing the cophenetic distance.</p>
<p>Given an example phylogenetic tree in Newick format, we can extract the distance matrix</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AbForests_PlyloToMatrix</span>(<span class="st">&quot;example.tree&quot;</span>)</span></code></pre></div>
</div>
<div id="references" class="section level2">
<h2>10. References</h2>
<ul>
<li><p>“Platypus: an open-access software for integrating lymphocyte single-cell immune repertoires with transcriptomes” Yermanos, Alexander; Agrafiotis, Andreas; Kuhn, Raphael; Robbiani, Damiano; Yates, Josephine; Papadopoulou, Chrysa; Han, Jiami; Sandu, Ioana; Weber, Cédric; Bieberich, Florian; Vazquez-Lombardi, Rodrigo; Neumeier, Daniel ; Oxenius, Annette; Reddy, Sai(2021). <a href="https://doi.org/10.1093/nargab/lqab023" class="uri">https://doi.org/10.1093/nargab/lqab023</a></p></li>
<li><p>&quot;Single-cell sequencing reveals clonally expanded plasma cells during chronic viral infection produce virus-specific and cross-reactive antibodies.Neumeier Daniel, Pedrioli Alessandro, Genovese Alessandro, Sandu Ioana, Ehling Roy, Hong Kai-Lin, Papadopoulou Chrysa, Agrafiotis Andreas, Kuhn Raphael, Robbiani Damiano, Han Jiami, Hauri Laura, Csepregi Lucia, Greiff Victor, ,Merkler Doron, Reddy Sai, Oxenius Annette, Yermanos Alexander (2021). bioRxiv doi: <a href="https://doi.org/10.1101/2021.01.29.428852" class="uri">https://doi.org/10.1101/2021.01.29.428852</a></p></li>
<li><p>Levenshtein, V. (1966) Binary Codes capable of correcting deletions, insertions, and reversals. Solviet Physics Doklady 10 (8): 707-710</p></li>
<li><p>Freeman, L.C. (1979). Centrality in Social Networks I: Conceptual Clarification. Social Networks, 1, 215-239.</p></li>
<li><p>Barrat Alain, Barthelemy Marc, Pastor-Satorras Romualdo, Vespignani Alessandro. (2004). The architecture of complex weighted networks. Proc. Natl. Acad. Sci. USA 101, 3747.</p></li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
